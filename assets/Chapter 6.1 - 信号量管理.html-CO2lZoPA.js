import{_ as s,c as a,a as e,o as p}from"./app-BeHGwf2X.js";const t={};function l(i,n){return p(),a("div",null,n[0]||(n[0]=[e(`<h1 id="chapter-6-1-信号量管理" tabindex="-1"><a class="header-anchor" href="#chapter-6-1-信号量管理"><span>Chapter 6.1 - 信号量管理</span></a></h1><p>Created by : Mr Dk.</p><p>2019 / 11 / 20 09:12</p><p>Nanjing, Jiangsu, China</p><hr><h2 id="_6-1-1-概述" tabindex="-1"><a class="header-anchor" href="#_6-1-1-概述"><span>6.1.1 概述</span></a></h2><p>信号量可以使任务或中断服务向另一个任务发送一个变量。使用信号量之前，必须先建立信号量。信号量由两个部分组成：</p><ul><li>信号量计数值 <ul><li>表示事件发生 - 初始值取 0 (暂时没有事件发生)</li><li>用于共享资源的访问 - 初始值取 1 (二值信号量) 或 n (多个相同资源)</li></ul></li><li>等待信号量的任务组成的等待任务列表</li></ul><p>信号量函数可以在编译前剪裁。</p><h2 id="_6-1-2-建立信号量-ossemcreate-函数" tabindex="-1"><a class="header-anchor" href="#_6-1-2-建立信号量-ossemcreate-函数"><span>6.1.2 建立信号量 - OSSemCreate() 函数</span></a></h2><p>建立一个信号量，并对信号量赋予初始计数值。调用者显然是任务或启动代码，是使用任何其它信号量函数的前提。</p><p>原理：</p><ul><li>从空闲 ECB 链表中取一个 ECB</li><li>初始化 ECB 中的变量</li><li>将 ECB 的等待任务列表清 0</li><li>返回 ECB 指针</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c" data-title="c"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*                                           CREATE A SEMAPHORE</span>
<span class="line">*</span>
<span class="line">* Description: This function creates a semaphore.</span>
<span class="line">*</span>
<span class="line">* Arguments  : cnt           is the initial value for the semaphore.  If the value is 0, no resource is</span>
<span class="line">*                            available (or no event has occurred).  You initialize the semaphore to a</span>
<span class="line">*                            non-zero value to specify how many resources are available (e.g. if you have</span>
<span class="line">*                            10 resources, you would initialize the semaphore to 10).</span>
<span class="line">*</span>
<span class="line">* Returns    : != (void *)0  is a pointer to the event control block (OS_EVENT) associated with the</span>
<span class="line">*                            created semaphore</span>
<span class="line">*              == (void *)0  if no event control blocks were available</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*/</span></span>
<span class="line"></span>
<span class="line">OS_EVENT  <span class="token operator">*</span><span class="token function">OSSemCreate</span> <span class="token punctuation">(</span>INT16U cnt<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    OS_EVENT  <span class="token operator">*</span>pevent<span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_CRITICAL_METHOD <span class="token operator">==</span> <span class="token number">3u</span>                               </span><span class="token comment">/* Allocate storage for CPU status register */</span></span></span>
<span class="line">    OS_CPU_SR  cpu_sr <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">OS_SAFETY_CRITICAL_IEC61508</span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>OSSafetyCriticalStartFlag <span class="token operator">==</span> OS_TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">OS_SAFETY_CRITICAL_EXCEPTION</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>OSIntNesting <span class="token operator">&gt;</span> <span class="token number">0u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                               <span class="token comment">/* See if called from ISR ...               */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">/* ... can&#39;t CREATE from an ISR             */</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">OS_ENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    pevent <span class="token operator">=</span> OSEventFreeList<span class="token punctuation">;</span>                              <span class="token comment">/* Get next free event control block        */</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>OSEventFreeList <span class="token operator">!=</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">/* See if pool of free ECB pool was empty   */</span></span>
<span class="line">        OSEventFreeList <span class="token operator">=</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span>OSEventFreeList<span class="token operator">-&gt;</span>OSEventPtr<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent <span class="token operator">!=</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                         <span class="token comment">/* Get an event control block               */</span></span>
<span class="line">        pevent<span class="token operator">-&gt;</span>OSEventType    <span class="token operator">=</span> OS_EVENT_TYPE_SEM<span class="token punctuation">;</span></span>
<span class="line">        pevent<span class="token operator">-&gt;</span>OSEventCnt     <span class="token operator">=</span> cnt<span class="token punctuation">;</span>                      <span class="token comment">/* Set semaphore value                      */</span></span>
<span class="line">        pevent<span class="token operator">-&gt;</span>OSEventPtr     <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>                <span class="token comment">/* Unlink from ECB free list                */</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_EVENT_NAME_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">        pevent<span class="token operator">-&gt;</span>OSEventName    <span class="token operator">=</span> <span class="token punctuation">(</span>INT8U <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line">        <span class="token function">OS_EventWaitListInit</span><span class="token punctuation">(</span>pevent<span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">/* Initialize to &#39;nobody waiting&#39; on sem.   */</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>pevent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_6-1-3-删除信号量-ossemdel-函数" tabindex="-1"><a class="header-anchor" href="#_6-1-3-删除信号量-ossemdel-函数"><span>6.1.3 删除信号量 - OSSemDel() 函数</span></a></h2><p>删除一个信号量，调用者只能是任务。删除信号量时指定条件选项：</p><ul><li><code>OS_DEL_NO_PEND</code> - 已经没有任何任务等待该信号量时，才删除信号量</li><li><code>OS_DEL_ALWAYS</code> - 不管有无等待任务，立刻删除信号量；所有等待该信号量的任务立刻就绪</li></ul><p>如果删除成功返回 <code>NULL</code>，删除不成功则返回原 ECB，并能通过错误代码查明原因。</p><p>原理：将 ECB 恢复空闲原始状态，归还给空闲链表。</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c" data-title="c"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*                                         DELETE A SEMAPHORE</span>
<span class="line">*</span>
<span class="line">* Description: This function deletes a semaphore and readies all tasks pending on the semaphore.</span>
<span class="line">*</span>
<span class="line">* Arguments  : pevent        is a pointer to the event control block associated with the desired</span>
<span class="line">*                            semaphore.</span>
<span class="line">*</span>
<span class="line">*              opt           determines delete options as follows:</span>
<span class="line">*                            opt == OS_DEL_NO_PEND   Delete semaphore ONLY if no task pending</span>
<span class="line">*                            opt == OS_DEL_ALWAYS    Deletes the semaphore even if tasks are waiting.</span>
<span class="line">*                                                    In this case, all the tasks pending will be readied.</span>
<span class="line">*</span>
<span class="line">*              perr          is a pointer to an error code that can contain one of the following values:</span>
<span class="line">*                            OS_ERR_NONE             The call was successful and the semaphore was deleted</span>
<span class="line">*                            OS_ERR_DEL_ISR          If you attempted to delete the semaphore from an ISR</span>
<span class="line">*                            OS_ERR_INVALID_OPT      An invalid option was specified</span>
<span class="line">*                            OS_ERR_TASK_WAITING     One or more tasks were waiting on the semaphore</span>
<span class="line">*                            OS_ERR_EVENT_TYPE       If you didn&#39;t pass a pointer to a semaphore</span>
<span class="line">*                            OS_ERR_PEVENT_NULL      If &#39;pevent&#39; is a NULL pointer.</span>
<span class="line">*</span>
<span class="line">* Returns    : pevent        upon error</span>
<span class="line">*              (OS_EVENT *)0 if the semaphore was successfully deleted.</span>
<span class="line">*</span>
<span class="line">* Note(s)    : 1) This function must be used with care.  Tasks that would normally expect the presence of</span>
<span class="line">*                 the semaphore MUST check the return code of OSSemPend().</span>
<span class="line">*              2) OSSemAccept() callers will not know that the intended semaphore has been deleted unless</span>
<span class="line">*                 they check &#39;pevent&#39; to see that it&#39;s a NULL pointer.</span>
<span class="line">*              3) This call can potentially disable interrupts for a long time.  The interrupt disable</span>
<span class="line">*                 time is directly proportional to the number of tasks waiting on the semaphore.</span>
<span class="line">*              4) Because ALL tasks pending on the semaphore will be readied, you MUST be careful in</span>
<span class="line">*                 applications where the semaphore is used for mutual exclusion because the resource(s)</span>
<span class="line">*                 will no longer be guarded by the semaphore.</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*/</span></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_SEM_DEL_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">OS_EVENT  <span class="token operator">*</span><span class="token function">OSSemDel</span> <span class="token punctuation">(</span>OS_EVENT  <span class="token operator">*</span>pevent<span class="token punctuation">,</span></span>
<span class="line">                     INT8U      opt<span class="token punctuation">,</span></span>
<span class="line">                     INT8U     <span class="token operator">*</span>perr<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    BOOLEAN    tasks_waiting<span class="token punctuation">;</span></span>
<span class="line">    OS_EVENT  <span class="token operator">*</span>pevent_return<span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_CRITICAL_METHOD <span class="token operator">==</span> <span class="token number">3u</span>                               </span><span class="token comment">/* Allocate storage for CPU status register */</span></span></span>
<span class="line">    OS_CPU_SR  cpu_sr <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">OS_SAFETY_CRITICAL</span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>perr <span class="token operator">==</span> <span class="token punctuation">(</span>INT8U <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">OS_SAFETY_CRITICAL_EXCEPTION</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_ARG_CHK_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent <span class="token operator">==</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                         <span class="token comment">/* Validate &#39;pevent&#39;                        */</span></span>
<span class="line">        <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_PEVENT_NULL<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>pevent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventType <span class="token operator">!=</span> OS_EVENT_TYPE_SEM<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">/* Validate event block type                */</span></span>
<span class="line">        <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_EVENT_TYPE<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>pevent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>OSIntNesting <span class="token operator">&gt;</span> <span class="token number">0u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                               <span class="token comment">/* See if called from ISR ...               */</span></span>
<span class="line">        <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_DEL_ISR<span class="token punctuation">;</span>                            <span class="token comment">/* ... can&#39;t DELETE from an ISR             */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>pevent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">OS_ENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventGrp <span class="token operator">!=</span> <span class="token number">0u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">/* See if any tasks waiting on semaphore    */</span></span>
<span class="line">        tasks_waiting <span class="token operator">=</span> OS_TRUE<span class="token punctuation">;</span>                           <span class="token comment">/* Yes                                      */</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        tasks_waiting <span class="token operator">=</span> OS_FALSE<span class="token punctuation">;</span>                          <span class="token comment">/* No                                       */</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>opt<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> OS_DEL_NO_PEND<span class="token operator">:</span>                               <span class="token comment">/* Delete semaphore only if no task waiting */</span></span>
<span class="line">             <span class="token keyword">if</span> <span class="token punctuation">(</span>tasks_waiting <span class="token operator">==</span> OS_FALSE<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_EVENT_NAME_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">                 pevent<span class="token operator">-&gt;</span>OSEventName    <span class="token operator">=</span> <span class="token punctuation">(</span>INT8U <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line">                 pevent<span class="token operator">-&gt;</span>OSEventType    <span class="token operator">=</span> OS_EVENT_TYPE_UNUSED<span class="token punctuation">;</span></span>
<span class="line">                 pevent<span class="token operator">-&gt;</span>OSEventPtr     <span class="token operator">=</span> OSEventFreeList<span class="token punctuation">;</span> <span class="token comment">/* Return Event Control Block to free list  */</span></span>
<span class="line">                 pevent<span class="token operator">-&gt;</span>OSEventCnt     <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span></span>
<span class="line">                 OSEventFreeList        <span class="token operator">=</span> pevent<span class="token punctuation">;</span>          <span class="token comment">/* Get next free event control block        */</span></span>
<span class="line">                 <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                 <span class="token operator">*</span>perr                  <span class="token operator">=</span> OS_ERR_NONE<span class="token punctuation">;</span></span>
<span class="line">                 pevent_return          <span class="token operator">=</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">/* Semaphore has been deleted               */</span></span>
<span class="line">             <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                 <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                 <span class="token operator">*</span>perr                  <span class="token operator">=</span> OS_ERR_TASK_WAITING<span class="token punctuation">;</span></span>
<span class="line">                 pevent_return          <span class="token operator">=</span> pevent<span class="token punctuation">;</span></span>
<span class="line">             <span class="token punctuation">}</span></span>
<span class="line">             <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">case</span> OS_DEL_ALWAYS<span class="token operator">:</span>                                <span class="token comment">/* Always delete the semaphore              */</span></span>
<span class="line">             <span class="token keyword">while</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventGrp <span class="token operator">!=</span> <span class="token number">0u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">/* Ready ALL tasks waiting for semaphore    */</span></span>
<span class="line">                 <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token function">OS_EventTaskRdy</span><span class="token punctuation">(</span>pevent<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">,</span> OS_STAT_SEM<span class="token punctuation">,</span> OS_STAT_PEND_OK<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_EVENT_NAME_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">             pevent<span class="token operator">-&gt;</span>OSEventName    <span class="token operator">=</span> <span class="token punctuation">(</span>INT8U <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line">             pevent<span class="token operator">-&gt;</span>OSEventType    <span class="token operator">=</span> OS_EVENT_TYPE_UNUSED<span class="token punctuation">;</span></span>
<span class="line">             pevent<span class="token operator">-&gt;</span>OSEventPtr     <span class="token operator">=</span> OSEventFreeList<span class="token punctuation">;</span>     <span class="token comment">/* Return Event Control Block to free list  */</span></span>
<span class="line">             pevent<span class="token operator">-&gt;</span>OSEventCnt     <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span></span>
<span class="line">             OSEventFreeList        <span class="token operator">=</span> pevent<span class="token punctuation">;</span>              <span class="token comment">/* Get next free event control block        */</span></span>
<span class="line">             <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token keyword">if</span> <span class="token punctuation">(</span>tasks_waiting <span class="token operator">==</span> OS_TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token comment">/* Reschedule only if task(s) were waiting  */</span></span>
<span class="line">                 <span class="token function">OS_Sched</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                               <span class="token comment">/* Find highest priority task ready to run  */</span></span>
<span class="line">             <span class="token punctuation">}</span></span>
<span class="line">             <span class="token operator">*</span>perr                  <span class="token operator">=</span> OS_ERR_NONE<span class="token punctuation">;</span></span>
<span class="line">             pevent_return          <span class="token operator">=</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">/* Semaphore has been deleted               */</span></span>
<span class="line">             <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">             <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token operator">*</span>perr                  <span class="token operator">=</span> OS_ERR_INVALID_OPT<span class="token punctuation">;</span></span>
<span class="line">             pevent_return          <span class="token operator">=</span> pevent<span class="token punctuation">;</span></span>
<span class="line">             <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>pevent_return<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-1-4-等待信号量-ossempend-函数" tabindex="-1"><a class="header-anchor" href="#_6-1-4-等待信号量-ossempend-函数"><span>6.1.4 等待信号量 - OSSemPend() 函数</span></a></h2><p>请求信号量，直到其它任务或中断置位信号量，或信号量超出等待的预期时间。若超时时间内信号量被置为，则最高优先级的任务取得信号量并转入就绪。一个被 <code>OSTaskSuspend()</code> 挂起的任务也可以接受信号量，但这个任务还是会保持挂起状态。该函数只能被任务调用，并给定一个超时时间。0 则表示无限期等待。调用时，如果信号量的值大于 0，则递减信号量并直接返回；否则将任务加入等待任务队列，并挂起任务。</p><p>原理：从 ECB 中获取成员变量</p><ul><li>如果大于 0，则得到信号量</li><li>如果等于 0，则挂起任务</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c" data-title="c"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*                                           PEND ON SEMAPHORE</span>
<span class="line">*</span>
<span class="line">* Description: This function waits for a semaphore.</span>
<span class="line">*</span>
<span class="line">* Arguments  : pevent        is a pointer to the event control block associated with the desired</span>
<span class="line">*                            semaphore.</span>
<span class="line">*</span>
<span class="line">*              timeout       is an optional timeout period (in clock ticks).  If non-zero, your task will</span>
<span class="line">*                            wait for the resource up to the amount of time specified by this argument.</span>
<span class="line">*                            If you specify 0, however, your task will wait forever at the specified</span>
<span class="line">*                            semaphore or, until the resource becomes available (or the event occurs).</span>
<span class="line">*</span>
<span class="line">*              perr          is a pointer to where an error message will be deposited.  Possible error</span>
<span class="line">*                            messages are:</span>
<span class="line">*</span>
<span class="line">*                            OS_ERR_NONE         The call was successful and your task owns the resource</span>
<span class="line">*                                                or, the event you are waiting for occurred.</span>
<span class="line">*                            OS_ERR_TIMEOUT      The semaphore was not received within the specified</span>
<span class="line">*                                                &#39;timeout&#39;.</span>
<span class="line">*                            OS_ERR_PEND_ABORT   The wait on the semaphore was aborted.</span>
<span class="line">*                            OS_ERR_EVENT_TYPE   If you didn&#39;t pass a pointer to a semaphore.</span>
<span class="line">*                            OS_ERR_PEND_ISR     If you called this function from an ISR and the result</span>
<span class="line">*                                                would lead to a suspension.</span>
<span class="line">*                            OS_ERR_PEVENT_NULL  If &#39;pevent&#39; is a NULL pointer.</span>
<span class="line">*                            OS_ERR_PEND_LOCKED  If you called this function when the scheduler is locked</span>
<span class="line">*</span>
<span class="line">* Returns    : none</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*/</span></span>
<span class="line"><span class="token comment">/*$PAGE*/</span>\f</span>
<span class="line"><span class="token keyword">void</span>  <span class="token function">OSSemPend</span> <span class="token punctuation">(</span>OS_EVENT  <span class="token operator">*</span>pevent<span class="token punctuation">,</span></span>
<span class="line">                 INT32U     timeout<span class="token punctuation">,</span></span>
<span class="line">                 INT8U     <span class="token operator">*</span>perr<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_CRITICAL_METHOD <span class="token operator">==</span> <span class="token number">3u</span>                          </span><span class="token comment">/* Allocate storage for CPU status register      */</span></span></span>
<span class="line">    OS_CPU_SR  cpu_sr <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">OS_SAFETY_CRITICAL</span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>perr <span class="token operator">==</span> <span class="token punctuation">(</span>INT8U <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">OS_SAFETY_CRITICAL_EXCEPTION</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_ARG_CHK_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent <span class="token operator">==</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">/* Validate &#39;pevent&#39;                             */</span></span>
<span class="line">        <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_PEVENT_NULL<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventType <span class="token operator">!=</span> OS_EVENT_TYPE_SEM<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">/* Validate event block type                     */</span></span>
<span class="line">        <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_EVENT_TYPE<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>OSIntNesting <span class="token operator">&gt;</span> <span class="token number">0u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                          <span class="token comment">/* See if called from ISR ...                    */</span></span>
<span class="line">        <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_PEND_ISR<span class="token punctuation">;</span>                      <span class="token comment">/* ... can&#39;t PEND from an ISR                    */</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>OSLockNesting <span class="token operator">&gt;</span> <span class="token number">0u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                         <span class="token comment">/* See if called with scheduler locked ...       */</span></span>
<span class="line">        <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_PEND_LOCKED<span class="token punctuation">;</span>                   <span class="token comment">/* ... can&#39;t PEND when locked                    */</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">OS_ENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventCnt <span class="token operator">&gt;</span> <span class="token number">0u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">/* If sem. is positive, resource available ...   */</span></span>
<span class="line">        pevent<span class="token operator">-&gt;</span>OSEventCnt<span class="token operator">--</span><span class="token punctuation">;</span>                         <span class="token comment">/* ... decrement semaphore only if positive.     */</span></span>
<span class="line">        <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_NONE<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">                                                      <span class="token comment">/* Otherwise, must wait until event occurs       */</span></span>
<span class="line">    OSTCBCur<span class="token operator">-&gt;</span>OSTCBStat     <span class="token operator">|=</span> OS_STAT_SEM<span class="token punctuation">;</span>           <span class="token comment">/* Resource not available, pend on semaphore     */</span></span>
<span class="line">    OSTCBCur<span class="token operator">-&gt;</span>OSTCBStatPend  <span class="token operator">=</span> OS_STAT_PEND_OK<span class="token punctuation">;</span></span>
<span class="line">    OSTCBCur<span class="token operator">-&gt;</span>OSTCBDly       <span class="token operator">=</span> timeout<span class="token punctuation">;</span>               <span class="token comment">/* Store pend timeout in TCB                     */</span></span>
<span class="line">    <span class="token function">OS_EventTaskWait</span><span class="token punctuation">(</span>pevent<span class="token punctuation">)</span><span class="token punctuation">;</span>                         <span class="token comment">/* Suspend task until event or timeout occurs    */</span></span>
<span class="line">    <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">OS_Sched</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                       <span class="token comment">/* Find next highest priority task ready         */</span></span>
<span class="line">    <span class="token function">OS_ENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>OSTCBCur<span class="token operator">-&gt;</span>OSTCBStatPend<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">/* See if we timed-out or aborted                */</span></span>
<span class="line">        <span class="token keyword">case</span> OS_STAT_PEND_OK<span class="token operator">:</span></span>
<span class="line">             <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_NONE<span class="token punctuation">;</span></span>
<span class="line">             <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">case</span> OS_STAT_PEND_ABORT<span class="token operator">:</span></span>
<span class="line">             <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_PEND_ABORT<span class="token punctuation">;</span>               <span class="token comment">/* Indicate that we aborted                      */</span></span>
<span class="line">             <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">case</span> OS_STAT_PEND_TO<span class="token operator">:</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">             <span class="token function">OS_EventTaskRemove</span><span class="token punctuation">(</span>OSTCBCur<span class="token punctuation">,</span> pevent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token operator">*</span>perr <span class="token operator">=</span> OS_ERR_TIMEOUT<span class="token punctuation">;</span>                  <span class="token comment">/* Indicate that we didn&#39;t get event within TO   */</span></span>
<span class="line">             <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    OSTCBCur<span class="token operator">-&gt;</span>OSTCBStat          <span class="token operator">=</span>  OS_STAT_RDY<span class="token punctuation">;</span>      <span class="token comment">/* Set   task  status to ready                   */</span></span>
<span class="line">    OSTCBCur<span class="token operator">-&gt;</span>OSTCBStatPend      <span class="token operator">=</span>  OS_STAT_PEND_OK<span class="token punctuation">;</span>  <span class="token comment">/* Clear pend  status                            */</span></span>
<span class="line">    OSTCBCur<span class="token operator">-&gt;</span>OSTCBEventPtr      <span class="token operator">=</span> <span class="token punctuation">(</span>OS_EVENT  <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">/* Clear event pointers                          */</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>OS_EVENT_MULTI_EN <span class="token operator">&gt;</span> <span class="token number">0u</span><span class="token punctuation">)</span></span></span></span>
<span class="line">    OSTCBCur<span class="token operator">-&gt;</span>OSTCBEventMultiPtr <span class="token operator">=</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line">    <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-1-5-发送信号量-ossempost-函数" tabindex="-1"><a class="header-anchor" href="#_6-1-5-发送信号量-ossempost-函数"><span>6.1.5 发送信号量 - OSSemPost() 函数</span></a></h2><p>用于置位 (发送) 信号量，使信号量的计数值 <code>+1</code>。如果有任务在等待信号量，则最高优先级任务将得到信号量而就绪。</p><ul><li>从任务中被调用，将进行任务调度或切换</li><li>从中断中被调用，不发生任务切换——所有嵌套中断都退出后，才会发生任务切换</li></ul><p>原理：</p><ul><li>查询 ECB 的等待列表</li><li>如果有任务在等待信号量，则将优先级最高的任务置为就绪，并重新调度</li><li>如果没有，则将信号量计数器 +1</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c" data-title="c"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*                                         POST TO A SEMAPHORE</span>
<span class="line">*</span>
<span class="line">* Description: This function signals a semaphore</span>
<span class="line">*</span>
<span class="line">* Arguments  : pevent        is a pointer to the event control block associated with the desired</span>
<span class="line">*                            semaphore.</span>
<span class="line">*</span>
<span class="line">* Returns    : OS_ERR_NONE         The call was successful and the semaphore was signaled.</span>
<span class="line">*              OS_ERR_SEM_OVF      If the semaphore count exceeded its limit.  In other words, you have</span>
<span class="line">*                                  signalled the semaphore more often than you waited on it with either</span>
<span class="line">*                                  OSSemAccept() or OSSemPend().</span>
<span class="line">*              OS_ERR_EVENT_TYPE   If you didn&#39;t pass a pointer to a semaphore</span>
<span class="line">*              OS_ERR_PEVENT_NULL  If &#39;pevent&#39; is a NULL pointer.</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*/</span></span>
<span class="line"></span>
<span class="line">INT8U  <span class="token function">OSSemPost</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span>pevent<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_CRITICAL_METHOD <span class="token operator">==</span> <span class="token number">3u</span>                          </span><span class="token comment">/* Allocate storage for CPU status register      */</span></span></span>
<span class="line">    OS_CPU_SR  cpu_sr <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_ARG_CHK_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent <span class="token operator">==</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">/* Validate &#39;pevent&#39;                             */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>OS_ERR_PEVENT_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventType <span class="token operator">!=</span> OS_EVENT_TYPE_SEM<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">/* Validate event block type                     */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>OS_ERR_EVENT_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">OS_ENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventGrp <span class="token operator">!=</span> <span class="token number">0u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token comment">/* See if any task waiting for semaphore         */</span></span>
<span class="line">                                                      <span class="token comment">/* Ready HPT waiting on event                    */</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token function">OS_EventTaskRdy</span><span class="token punctuation">(</span>pevent<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">,</span> OS_STAT_SEM<span class="token punctuation">,</span> OS_STAT_PEND_OK<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">OS_Sched</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                   <span class="token comment">/* Find HPT ready to run                         */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>OS_ERR_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventCnt <span class="token operator">&lt;</span> <span class="token number">65535u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">/* Make sure semaphore will not overflow         */</span></span>
<span class="line">        pevent<span class="token operator">-&gt;</span>OSEventCnt<span class="token operator">++</span><span class="token punctuation">;</span>                         <span class="token comment">/* Increment semaphore count to register event   */</span></span>
<span class="line">        <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>OS_ERR_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                               <span class="token comment">/* Semaphore value has reached its maximum       */</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>OS_ERR_SEM_OVF<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-1-6-无等待地获取信号量-ossemaccept-函数" tabindex="-1"><a class="header-anchor" href="#_6-1-6-无等待地获取信号量-ossemaccept-函数"><span>6.1.6 无等待地获取信号量 - OSSemAccept() 函数</span></a></h2><p>查看资源是否可用或事件是否发生，不挂起任务，立即返回。调用者可以是任务，也可以是中断。</p><p>原理：</p><ul><li>直接查询 ECB 中的 <code>OSEventCnt</code> 实现信号量的查询</li><li>如果信号量的值大于 0，则返回信号量的值，将将信号量的值 -1</li><li>如果信号量的值小于 0，则返回 0</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c" data-title="c"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*                                           ACCEPT SEMAPHORE</span>
<span class="line">*</span>
<span class="line">* Description: This function checks the semaphore to see if a resource is available or, if an event</span>
<span class="line">*              occurred.  Unlike OSSemPend(), OSSemAccept() does not suspend the calling task if the</span>
<span class="line">*              resource is not available or the event did not occur.</span>
<span class="line">*</span>
<span class="line">* Arguments  : pevent     is a pointer to the event control block</span>
<span class="line">*</span>
<span class="line">* Returns    : &gt;  0       if the resource is available or the event did not occur the semaphore is</span>
<span class="line">*                         decremented to obtain the resource.</span>
<span class="line">*              == 0       if the resource is not available or the event did not occur or,</span>
<span class="line">*                         if &#39;pevent&#39; is a NULL pointer or,</span>
<span class="line">*                         if you didn&#39;t pass a pointer to a semaphore</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*/</span></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_SEM_ACCEPT_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">INT16U  <span class="token function">OSSemAccept</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span>pevent<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    INT16U     cnt<span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_CRITICAL_METHOD <span class="token operator">==</span> <span class="token number">3u</span>                          </span><span class="token comment">/* Allocate storage for CPU status register      */</span></span></span>
<span class="line">    OS_CPU_SR  cpu_sr <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_ARG_CHK_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent <span class="token operator">==</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">/* Validate &#39;pevent&#39;                             */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0u</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventType <span class="token operator">!=</span> OS_EVENT_TYPE_SEM<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">/* Validate event block type                     */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0u</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">OS_ENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    cnt <span class="token operator">=</span> pevent<span class="token operator">-&gt;</span>OSEventCnt<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">&gt;</span> <span class="token number">0u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                   <span class="token comment">/* See if resource is available                  */</span></span>
<span class="line">        pevent<span class="token operator">-&gt;</span>OSEventCnt<span class="token operator">--</span><span class="token punctuation">;</span>                         <span class="token comment">/* Yes, decrement semaphore and notify caller    */</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">;</span>                                     <span class="token comment">/* Return semaphore count                        */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-1-7-查询信号量的当前状态-ossemquery-函数" tabindex="-1"><a class="header-anchor" href="#_6-1-7-查询信号量的当前状态-ossemquery-函数"><span>6.1.7 查询信号量的当前状态 - OSSemQuery() 函数</span></a></h2><p>查询信号量的信息。确切地说，需要提前申请一个 <code>OS_SEM_DATA</code> 类型结构体的内存，然后将 ECB 中某几个域的信息复制到这个结构体中。</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c" data-title="c"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*                                          QUERY A SEMAPHORE</span>
<span class="line">*</span>
<span class="line">* Description: This function obtains information about a semaphore</span>
<span class="line">*</span>
<span class="line">* Arguments  : pevent        is a pointer to the event control block associated with the desired</span>
<span class="line">*                            semaphore</span>
<span class="line">*</span>
<span class="line">*              p_sem_data    is a pointer to a structure that will contain information about the</span>
<span class="line">*                            semaphore.</span>
<span class="line">*</span>
<span class="line">* Returns    : OS_ERR_NONE         The call was successful and the message was sent</span>
<span class="line">*              OS_ERR_EVENT_TYPE   If you are attempting to obtain data from a non semaphore.</span>
<span class="line">*              OS_ERR_PEVENT_NULL  If &#39;pevent&#39;     is a NULL pointer.</span>
<span class="line">*              OS_ERR_PDATA_NULL   If &#39;p_sem_data&#39; is a NULL pointer</span>
<span class="line">*********************************************************************************************************</span>
<span class="line">*/</span></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_SEM_QUERY_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">INT8U  <span class="token function">OSSemQuery</span> <span class="token punctuation">(</span>OS_EVENT     <span class="token operator">*</span>pevent<span class="token punctuation">,</span></span>
<span class="line">                   OS_SEM_DATA  <span class="token operator">*</span>p_sem_data<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    INT8U       i<span class="token punctuation">;</span></span>
<span class="line">    OS_PRIO    <span class="token operator">*</span>psrc<span class="token punctuation">;</span></span>
<span class="line">    OS_PRIO    <span class="token operator">*</span>pdest<span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_CRITICAL_METHOD <span class="token operator">==</span> <span class="token number">3u</span>                               </span><span class="token comment">/* Allocate storage for CPU status register */</span></span></span>
<span class="line">    OS_CPU_SR   cpu_sr <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">OS_ARG_CHK_EN <span class="token operator">&gt;</span> <span class="token number">0u</span></span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent <span class="token operator">==</span> <span class="token punctuation">(</span>OS_EVENT <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                         <span class="token comment">/* Validate &#39;pevent&#39;                        */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>OS_ERR_PEVENT_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>p_sem_data <span class="token operator">==</span> <span class="token punctuation">(</span>OS_SEM_DATA <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token comment">/* Validate &#39;p_sem_data&#39;                    */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>OS_ERR_PDATA_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pevent<span class="token operator">-&gt;</span>OSEventType <span class="token operator">!=</span> OS_EVENT_TYPE_SEM<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">/* Validate event block type                */</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>OS_ERR_EVENT_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">OS_ENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    p_sem_data<span class="token operator">-&gt;</span>OSEventGrp <span class="token operator">=</span> pevent<span class="token operator">-&gt;</span>OSEventGrp<span class="token punctuation">;</span>           <span class="token comment">/* Copy message mailbox wait list           */</span></span>
<span class="line">    psrc                   <span class="token operator">=</span> <span class="token operator">&amp;</span>pevent<span class="token operator">-&gt;</span>OSEventTbl<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    pdest                  <span class="token operator">=</span> <span class="token operator">&amp;</span>p_sem_data<span class="token operator">-&gt;</span>OSEventTbl<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> OS_EVENT_TBL_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">*</span>pdest<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>psrc<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    p_sem_data<span class="token operator">-&gt;</span>OSCnt <span class="token operator">=</span> pevent<span class="token operator">-&gt;</span>OSEventCnt<span class="token punctuation">;</span>                <span class="token comment">/* Get semaphore count                      */</span></span>
<span class="line">    <span class="token function">OS_EXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>OS_ERR_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>总体上这一块还是比较简单的，各个函数的功能也都简洁明了。需要注意的是，所有会将自己挂起的函数，在中断中不能被调用，只能在任务中被调用。</p>`,42)]))}const o=s(t,[["render",l],["__file","Chapter 6.1 - 信号量管理.html.vue"]]),r=JSON.parse('{"path":"/uc-os-ii-code-notes/Chapter%206.1%20-%20%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%AE%A1%E7%90%86.html","title":"Chapter 6.1 - 信号量管理","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"6.1.1 概述","slug":"_6-1-1-概述","link":"#_6-1-1-概述","children":[]},{"level":2,"title":"6.1.2 建立信号量 - OSSemCreate() 函数","slug":"_6-1-2-建立信号量-ossemcreate-函数","link":"#_6-1-2-建立信号量-ossemcreate-函数","children":[]},{"level":2,"title":"6.1.3 删除信号量 - OSSemDel() 函数","slug":"_6-1-3-删除信号量-ossemdel-函数","link":"#_6-1-3-删除信号量-ossemdel-函数","children":[]},{"level":2,"title":"6.1.4 等待信号量 - OSSemPend() 函数","slug":"_6-1-4-等待信号量-ossempend-函数","link":"#_6-1-4-等待信号量-ossempend-函数","children":[]},{"level":2,"title":"6.1.5 发送信号量 - OSSemPost() 函数","slug":"_6-1-5-发送信号量-ossempost-函数","link":"#_6-1-5-发送信号量-ossempost-函数","children":[]},{"level":2,"title":"6.1.6 无等待地获取信号量 - OSSemAccept() 函数","slug":"_6-1-6-无等待地获取信号量-ossemaccept-函数","link":"#_6-1-6-无等待地获取信号量-ossemaccept-函数","children":[]},{"level":2,"title":"6.1.7 查询信号量的当前状态 - OSSemQuery() 函数","slug":"_6-1-7-查询信号量的当前状态-ossemquery-函数","link":"#_6-1-7-查询信号量的当前状态-ossemquery-函数","children":[]},{"level":2,"title":"Summary","slug":"summary","link":"#summary","children":[]}],"git":{},"filePathRelative":"uc-os-ii-code-notes/Chapter 6.1 - 信号量管理.md"}');export{o as comp,r as data};
