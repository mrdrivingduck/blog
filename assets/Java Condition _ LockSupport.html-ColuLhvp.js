import{_ as s,c as a,a as e,o as p}from"./app-BeHGwf2X.js";const t={};function l(c,n){return p(),a("div",null,n[0]||(n[0]=[e(`<h1 id="java-condition-and-locksupport" tabindex="-1"><a class="header-anchor" href="#java-condition-and-locksupport"><span>Java - Condition and LockSupport</span></a></h1><p>Created by : Mr Dk.</p><p>2020 / 10 / 31 13:43</p><p>Nanjing, Jiangsu, China</p><hr><p>è¯» JDK æºä»£ç æ—¶é‡åˆ°äº† <code>java.util.concurrent.locks.Condition</code> ç±»ï¼Œä¸å¾—å…¶è§£ã€‚</p><h2 id="monitor-object" tabindex="-1"><a class="header-anchor" href="#monitor-object"><span>Monitor Object</span></a></h2><p>æ¯ä¸€ä¸ª Java å¯¹è±¡éƒ½æœ‰ä¸€ç»„ç›‘è§†å™¨å‡½æ•°ï¼Œç”¨äºä¸å¯¹è±¡é”å’Œ <code>synchronized</code> å…³é”®å­—é…åˆï¼Œå®ç°ç­‰å¾… / é€šçŸ¥æ¨¡å¼ã€‚ä½¿ç”¨ç­‰å¾… / é€šçŸ¥æ¨¡å¼æ—¶ï¼Œå‰ææ˜¯éœ€è¦é€šè¿‡ <code>synchronized</code> å…³é”®å­—è·å¾—å¯¹è±¡çš„é”ï¼Œæ²¡æœ‰è·å¾—åˆ°å¯¹è±¡é”çš„çº¿ç¨‹å°†é˜»å¡åœ¨ <strong>åŒæ­¥é˜Ÿåˆ—</strong> ä¸Šã€‚è°ƒç”¨ <code>wait()</code> å‡½æ•°æ—¶ï¼Œçº¿ç¨‹å°†è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒåŠ å…¥åˆ°ä¸€ä¸ª <strong>ç­‰å¾…é˜Ÿåˆ—</strong> ä¸­ï¼Œå¹¶é‡Šæ”¾é”ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºé”è¢«é‡Šæ”¾ï¼ŒåŒæ­¥é˜Ÿåˆ—ä¸Šçš„å…¶å®ƒçº¿ç¨‹å¾—ä»¥é€šè¿‡ç«äº‰è·å¾—å¯¹è±¡é”ï¼Œå¹¶è¿›å…¥ä¸´ç•ŒåŒºã€‚å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>notify()</code> ç³»åˆ—å‡½æ•°ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">    obj<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨ <code>notify()</code> ç³»åˆ—å‡½æ•°åï¼Œä¼šå°†ç­‰å¾…é˜Ÿåˆ—ä¸Š (ä¸€ä¸ªæˆ–å¤šä¸ª) ç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹ç§»å…¥åŒæ­¥é˜Ÿåˆ—ä¸Šé˜»å¡ï¼Œé‡æ–°å‚ä¸å¯¹è±¡é”çš„ç«äº‰ã€‚åœ¨çº¿ç¨‹äº‰å–åˆ°å¯¹è±¡é”åï¼Œä» <code>wait()</code> å‡½æ•°å¤„è¿”å›ã€‚</p><h2 id="comparison" tabindex="-1"><a class="header-anchor" href="#comparison"><span>Comparison</span></a></h2><p>ä¸ <code>synchronized</code> + <code>wait()</code> / <code>notify()</code> æœºåˆ¶ç±»ä¼¼ï¼Œå¯¹äºå®ç° <code>Lock</code> æ¥å£çš„ JDK é”å¯¹è±¡ï¼Œä¹Ÿæä¾›äº†ç›¸åº”çš„ Condition å¯¹è±¡å®ç°ç­‰å¾… / é€šçŸ¥æ¨¡å¼ã€‚å…·ä½“çš„ä½¿ç”¨æ–¹å¼ç±»ä¼¼ï¼Œé‡ç‚¹åœ¨äº Condition å¯¹è±¡æ˜¯ç”± Lock å¯¹è±¡å¾—åˆ°çš„ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">conditionWait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span></span>
<span class="line">    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å æœ‰é”</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¡®ä¿é”è¢«é‡Šæ”¾</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">conditionSignal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span></span>
<span class="line">    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        condition<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¯¹è±¡å æœ‰é”å¹¶è°ƒç”¨ <code>condition.await()</code> åï¼Œå°†ä¼šé‡Šæ”¾é”å¹¶è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼›å½“å¦ä¸€ä¸ªå¯¹è±¡å æœ‰é”å¹¶è°ƒç”¨ <code>condition.signal()</code> åï¼Œæ­£åœ¨ç­‰å¾…ä¸­çš„çº¿ç¨‹å°† <strong>é‡æ–°è¿›å…¥é”ç«äº‰çŠ¶æ€</strong>ï¼Œå½“å†æ¬¡å æœ‰é”åï¼Œå°†ä» <code>condition.await()</code> è¿”å›ã€‚</p><p>ä¸¤ç§ç­‰å¾… / é€šçŸ¥çš„å®ç°æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><table><thead><tr><th>Items</th><th>Object Monitor</th><th>Condition</th></tr></thead><tbody><tr><td>å‰ç½®æ¡ä»¶</td><td>å æ®å¯¹è±¡é”</td><td>è°ƒç”¨ <code>Lock.newCondition()</code> è·å– Condition å¯¹è±¡ï¼›è°ƒç”¨ <code>Lock.lock()</code> è·å–é”</td></tr><tr><td>è°ƒç”¨æ–¹å¼</td><td><code>obj.wait()</code></td><td><code>condition.await()</code></td></tr><tr><td>ç­‰å¾…é˜Ÿåˆ—ä¸ªæ•°</td><td>ä¸€ä¸ª</td><td>å¤šä¸ª (ä¸€ä¸ª Condition å¯¹è±¡ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ª Lock å¯ä»¥äº§ç”Ÿå¤šä¸ª Condition å¯¹è±¡)</td></tr><tr><td>çº¿ç¨‹é‡Šæ”¾é”å¹¶ç­‰å¾…</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>çº¿ç¨‹é‡Šæ”¾é”å¹¶ç­‰å¾…ï¼Œç­‰å¾…æ—¶ä¸å“åº”ä¸­æ–­</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>çº¿ç¨‹é‡Šæ”¾é”å¹¶è¶…æ—¶ç­‰å¾…</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>çº¿ç¨‹é‡Šæ”¾é”å¹¶ç­‰å¾…åˆ°å°†æ¥æŸä¸ªæ—¶é—´</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å…¨éƒ¨çº¿ç¨‹</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr></tbody></table><h2 id="implementation" tabindex="-1"><a class="header-anchor" href="#implementation"><span>Implementation</span></a></h2><p>æ¯ä¸ª Condition å¯¹è±¡å†…éƒ½åŒ…å«ä¸€ä¸ª <strong>ç­‰å¾…é˜Ÿåˆ—</strong>ã€‚ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ª FIFO é˜Ÿåˆ—ï¼Œæ¯ä¸ªç»“ç‚¹ä¿å­˜äº†çº¿ç¨‹å¼•ç”¨ï¼ŒåŒæ—¶ä¹Ÿç»´æŠ¤ç€å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹ã€‚å½“çº¿ç¨‹è°ƒç”¨ <code>Condition.await()</code> å‡½æ•°æ—¶ï¼Œå‘ç”Ÿä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p><ol><li>é‡Šæ”¾é”</li><li>å°†å½“å‰çº¿ç¨‹æ„é€ ä¸ºç»“ç‚¹å¹¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</li><li>çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€</li></ol><p>å…¶ä¸­ï¼Œ<code>await()</code> å‡½æ•°ä¸­ç§»å…¥é˜Ÿåˆ—çš„æ“ä½œå¹¶ä¸éœ€è¦ CAS æ“ä½œï¼Œå› ä¸ºè°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹å¿…å®šå·²ç»è·å–äº†é”ï¼Œæ‰€ä»¥ç”±é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><p>Object ç›‘è§†å™¨æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡åŒ…å«ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œ <strong>ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—</strong>ï¼›è€Œ JUC ä¸­çš„ Lock æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œ <strong>å¤šä¸ªç­‰å¾…é˜Ÿåˆ—</strong>ã€‚</p><p>ä»é˜Ÿåˆ—çš„è§’åº¦æ¥çœ‹ï¼Œå½“è°ƒç”¨ <code>Condition.await()</code> å‡½æ•°æ—¶ï¼Œç›¸å½“äºåŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ç§»å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Implements interruptible condition wait.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> If current thread is interrupted, throw InterruptedException.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> Save lock state returned by <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">getState</span></span><span class="token punctuation">}</span>.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> Invoke <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">release</span></span><span class="token punctuation">}</span> with saved state as argument,</span>
<span class="line"> *      throwing IllegalMonitorStateException if it fails.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> Block until signalled or interrupted.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> Reacquire by invoking specialized version of</span>
<span class="line"> *      <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">acquire</span></span><span class="token punctuation">}</span> with saved state as argument.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> If interrupted while blocked in step 4, throw InterruptedException.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Node</span> node <span class="token operator">=</span> <span class="token function">addConditionWaiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> savedState <span class="token operator">=</span> <span class="token function">fullyRelease</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> interruptMode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isOnSyncQueue</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>interruptMode <span class="token operator">=</span> <span class="token function">checkInterruptWhileWaiting</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">acquireQueued</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> savedState<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> interruptMode <span class="token operator">!=</span> <span class="token constant">THROW_IE</span><span class="token punctuation">)</span></span>
<span class="line">        interruptMode <span class="token operator">=</span> <span class="token constant">REINTERRUPT</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>nextWaiter <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// clean up if cancelled</span></span>
<span class="line">        <span class="token function">unlinkCancelledWaiters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>interruptMode <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">reportInterruptAfterWait</span><span class="token punctuation">(</span>interruptMode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨ <code>Condition.signal()</code> æ—¶ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´æœ€ä¹…çš„ç»“ç‚¹å°†ä¼šè¢«ç§»å…¥åŒæ­¥é˜Ÿåˆ—ä¸­å¹¶å”¤é†’ã€‚åŒæ—¶ï¼Œå‡½æ•°è¿˜ä¼šæ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦è·å¾—é”çš„å‰ææ¡ä»¶ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Moves the longest-waiting thread, if one exists, from the</span>
<span class="line"> * wait queue for this condition to the wait queue for the</span>
<span class="line"> * owning lock.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IllegalMonitorStateException</span></span> if <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">isHeldExclusively</span></span><span class="token punctuation">}</span></span>
<span class="line"> *         returns <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token boolean">false</span></span></span><span class="token punctuation">}</span></span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isHeldExclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalMonitorStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Node</span> first <span class="token operator">=</span> firstWaiter<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">doSignal</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¢«å”¤é†’åçš„çº¿ç¨‹ (å·²ç»åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­) å°†ä¼šåŠ å…¥åˆ°è·å–åŒæ­¥çŠ¶æ€çš„ç«äº‰ä¸­ã€‚<code>Condition.signal()</code> ä¸ <code>Condition.signalAll()</code> çš„åŒºåˆ«åœ¨äºï¼Œ<code>signalAll()</code> ç›¸å½“äºå¯¹ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªç»“ç‚¹éƒ½è°ƒç”¨ä¸€æ¬¡ <code>signal()</code>ã€‚å¸¦æ¥çš„æ•ˆæœæ˜¯ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ç»“ç‚¹è¢«ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶å”¤é†’åŸæ¥åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹ã€‚</p><h2 id="lock-support" tabindex="-1"><a class="header-anchor" href="#lock-support"><span>Lock Support</span></a></h2><p><code>java.util.concurrent.locks.LockSupport</code> ä¸­å®šä¹‰äº†ä¸€ç»„å…¬å…±é™æ€å‡½æ•°ï¼Œæä¾›äº†åŸºæœ¬çš„çº¿ç¨‹é˜»å¡ / å”¤é†’åŠŸèƒ½ã€‚æ ¹æ®æºç ï¼ŒåŸºæœ¬æ˜¯é€šè¿‡ <code>Unsafe</code> ç±»è°ƒç”¨äº† native JVM å‡½æ•°å®ç°çš„ã€‚</p><p>ä»¥ä¸‹å‡½æ•°ä½¿å½“å‰çº¿ç¨‹ä¼‘çœ  (ä¸è¢«çº¿ç¨‹è°ƒåº¦å™¨è°ƒåº¦)ï¼Œå‡½æ•°å°†ä¸ä¼šè¿”å›ï¼Œç›´åˆ°ä»¥ä¸‹æ¡ä»¶å‘ç”Ÿï¼š</p><ol><li>å¦ä¸€ä¸ªçº¿ç¨‹å¯¹å½“å‰çº¿ç¨‹è°ƒç”¨äº† <code>unpark()</code></li><li>å¦ä¸€ä¸ªçº¿ç¨‹å¯¹å½“å‰çº¿ç¨‹å‘å‡ºäº†ä¸­æ–­ä¿¡å·</li><li>è°ƒç”¨æ²¡ç†ç”±åœ°è¿”å›äº† ğŸ˜“</li></ol><p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆé€šè¿‡ <code>UNSAFE</code> ç±»å°†é˜»å¡ç›®æ ‡è®¾ç½®åˆ°äº† <em>HotSpot</em> ä¸­å½“å‰çº¿ç¨‹çš„ <code>parkBlocker</code> åŸŸä¸Šã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setBlocker</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Even though volatile, hotspot doesn&#39;t need a write barrier here.</span></span>
<span class="line">    <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> parkBlockerOffset<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Disables the current thread for thread scheduling purposes unless the</span>
<span class="line"> * permit is available.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>If the permit is available then it is consumed and the call returns</span>
<span class="line"> * immediately; otherwise</span>
<span class="line"> * the current thread becomes disabled for thread scheduling</span>
<span class="line"> * purposes and lies dormant until one of three things happens:</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Some other thread invokes <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">unpark</span></span> unpark<span class="token punctuation">}</span> with the</span>
<span class="line"> * current thread as the target; or</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Some other thread <span class="token punctuation">{</span><span class="token keyword">@linkplain</span> <span class="token reference"><span class="token class-name">Thread</span><span class="token punctuation">#</span><span class="token field">interrupt</span></span> interrupts<span class="token punctuation">}</span></span>
<span class="line"> * the current thread; or</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>The call spuriously (that is, for no reason) returns.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This method does <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>not<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> report which of these caused the</span>
<span class="line"> * method to return. Callers should re-check the conditions which caused</span>
<span class="line"> * the thread to park in the first place. Callers may also determine,</span>
<span class="line"> * for example, the interrupt status of the thread upon return.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">blocker</span> the synchronization object responsible for this</span>
<span class="line"> *        thread parking</span>
<span class="line"> * <span class="token keyword">@since</span> 1.6</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">park</span><span class="token punctuation">(</span><span class="token class-name">Object</span> blocker<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> blocker<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦å¤–è¿˜æœ‰è¶…æ—¶ç‰ˆæœ¬å’Œ DDL ç‰ˆæœ¬ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Disables the current thread for thread scheduling purposes, for up to</span>
<span class="line"> * the specified waiting time, unless the permit is available.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>If the permit is available then it is consumed and the call</span>
<span class="line"> * returns immediately; otherwise the current thread becomes disabled</span>
<span class="line"> * for thread scheduling purposes and lies dormant until one of four</span>
<span class="line"> * things happens:</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Some other thread invokes <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">unpark</span></span> unpark<span class="token punctuation">}</span> with the</span>
<span class="line"> * current thread as the target; or</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Some other thread <span class="token punctuation">{</span><span class="token keyword">@linkplain</span> <span class="token reference"><span class="token class-name">Thread</span><span class="token punctuation">#</span><span class="token field">interrupt</span></span> interrupts<span class="token punctuation">}</span></span>
<span class="line"> * the current thread; or</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>The specified waiting time elapses; or</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>The call spuriously (that is, for no reason) returns.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This method does <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>not<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> report which of these caused the</span>
<span class="line"> * method to return. Callers should re-check the conditions which caused</span>
<span class="line"> * the thread to park in the first place. Callers may also determine,</span>
<span class="line"> * for example, the interrupt status of the thread, or the elapsed time</span>
<span class="line"> * upon return.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">blocker</span> the synchronization object responsible for this</span>
<span class="line"> *        thread parking</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">nanos</span> the maximum number of nanoseconds to wait</span>
<span class="line"> * <span class="token keyword">@since</span> 1.6</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">parkNanos</span><span class="token punctuation">(</span><span class="token class-name">Object</span> blocker<span class="token punctuation">,</span> <span class="token keyword">long</span> nanos<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>nanos <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> blocker<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> nanos<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Disables the current thread for thread scheduling purposes, until</span>
<span class="line"> * the specified deadline, unless the permit is available.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>If the permit is available then it is consumed and the call</span>
<span class="line"> * returns immediately; otherwise the current thread becomes disabled</span>
<span class="line"> * for thread scheduling purposes and lies dormant until one of four</span>
<span class="line"> * things happens:</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Some other thread invokes <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">unpark</span></span> unpark<span class="token punctuation">}</span> with the</span>
<span class="line"> * current thread as the target; or</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Some other thread <span class="token punctuation">{</span><span class="token keyword">@linkplain</span> <span class="token reference"><span class="token class-name">Thread</span><span class="token punctuation">#</span><span class="token field">interrupt</span></span> interrupts<span class="token punctuation">}</span> the</span>
<span class="line"> * current thread; or</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>The specified deadline passes; or</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>The call spuriously (that is, for no reason) returns.</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This method does <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>not<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> report which of these caused the</span>
<span class="line"> * method to return. Callers should re-check the conditions which caused</span>
<span class="line"> * the thread to park in the first place. Callers may also determine,</span>
<span class="line"> * for example, the interrupt status of the thread, or the current time</span>
<span class="line"> * upon return.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">blocker</span> the synchronization object responsible for this</span>
<span class="line"> *        thread parking</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">deadline</span> the absolute time, in milliseconds from the Epoch,</span>
<span class="line"> *        to wait until</span>
<span class="line"> * <span class="token keyword">@since</span> 1.6</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">parkUntil</span><span class="token punctuation">(</span><span class="token class-name">Object</span> blocker<span class="token punctuation">,</span> <span class="token keyword">long</span> deadline<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> blocker<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> deadline<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“å¦ä¸€ä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªå·²ç»é˜»å¡çš„çº¿ç¨‹è°ƒç”¨äº† <code>unpark()</code> åï¼Œé˜»å¡çš„çº¿ç¨‹å°†æ¢å¤è¢«è°ƒåº¦ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Makes available the permit for the given thread, if it</span>
<span class="line"> * was not already available.  If the thread was blocked on</span>
<span class="line"> * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">park</span></span><span class="token punctuation">}</span> then it will unblock.  Otherwise, its next call</span>
<span class="line"> * to <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">park</span></span><span class="token punctuation">}</span> is guaranteed not to block. This operation</span>
<span class="line"> * is not guaranteed to have any effect at all if the given</span>
<span class="line"> * thread has not been started.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">thread</span> the thread to unpark, or <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>, in which case</span>
<span class="line"> *        this operation has no effect</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">unpark</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> thread<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>thread <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>`,39)]))}const o=s(t,[["render",l],["__file","Java Condition _ LockSupport.html.vue"]]),u=JSON.parse('{"path":"/notes/Java/Java%20Condition%20_%20LockSupport.html","title":"Java - Condition and LockSupport","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Monitor Object","slug":"monitor-object","link":"#monitor-object","children":[]},{"level":2,"title":"Comparison","slug":"comparison","link":"#comparison","children":[]},{"level":2,"title":"Implementation","slug":"implementation","link":"#implementation","children":[]},{"level":2,"title":"Lock Support","slug":"lock-support","link":"#lock-support","children":[]}],"git":{},"filePathRelative":"notes/Java/Java Condition & LockSupport.md"}');export{o as comp,u as data};
