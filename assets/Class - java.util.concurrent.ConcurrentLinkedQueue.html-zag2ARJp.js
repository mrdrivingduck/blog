import{_ as s,c as a,a as e,o as p}from"./app-BeHGwf2X.js";const t={};function l(c,n){return p(),a("div",null,n[0]||(n[0]=[e(`<h1 id="class-java-util-concurrent-concurrentlinkedqueue" tabindex="-1"><a class="header-anchor" href="#class-java-util-concurrent-concurrentlinkedqueue"><span>Class - java.util.concurrent.ConcurrentLinkedQueue</span></a></h1><p>Created by : Mr Dk.</p><p>2020 / 10 / 24 ğŸ‘¨â€ğŸ’» 13:56</p><p>Nanjing, Jiangsu, China</p><hr><h2 id="definition" tabindex="-1"><a class="header-anchor" href="#definition"><span>Definition</span></a></h2><p>åŸºäºé“¾ç»“ç‚¹å®ç°çš„å¹¶å‘éé˜»å¡ FIFO é˜Ÿåˆ—ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * An unbounded thread-safe <span class="token punctuation">{</span><span class="token keyword">@linkplain</span> <span class="token reference"><span class="token class-name">Queue</span></span> queue<span class="token punctuation">}</span> based on linked nodes.</span>
<span class="line"> * This queue orders elements FIFO (first-in-first-out).</span>
<span class="line"> * The <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>head<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> of the queue is that element that has been on the</span>
<span class="line"> * queue the longest time.</span>
<span class="line"> * The <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>tail<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> of the queue is that element that has been on the</span>
<span class="line"> * queue the shortest time. New elements</span>
<span class="line"> * are inserted at the tail of the queue, and the queue retrieval</span>
<span class="line"> * operations obtain elements at the head of the queue.</span>
<span class="line"> * A <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">ConcurrentLinkedQueue</span></span></span><span class="token punctuation">}</span> is an appropriate choice when</span>
<span class="line"> * many threads will share access to a common collection.</span>
<span class="line"> * Like most other concurrent collection implementations, this class</span>
<span class="line"> * does not permit the use of <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span> elements.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This implementation employs an efficient <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>non-blocking<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * algorithm based on one described in <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span></span>
<span class="line"> <span class="token attr-name">*</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.cs.rochester.edu/u/michael/PODC96.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> Simple,</span>
<span class="line"> * Fast, and Practical Non-Blocking and Blocking Concurrent Queue</span>
<span class="line"> * Algorithms<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> by Maged M. Michael and Michael L. Scott.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Iterators are <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span>weakly consistent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>, returning elements</span>
<span class="line"> * reflecting the state of the queue at some point at or since the</span>
<span class="line"> * creation of the iterator.  They do <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>not<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> throw <span class="token punctuation">{</span><span class="token keyword">@link</span></span>
<span class="line"> * <span class="token reference"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ConcurrentModificationException</span></span><span class="token punctuation">}</span>, and may proceed concurrently</span>
<span class="line"> * with other operations.  Elements contained in the queue since the creation</span>
<span class="line"> * of the iterator will be returned exactly once.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Beware that, unlike in most collections, the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">size</span></span><span class="token punctuation">}</span> method</span>
<span class="line"> * is <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>NOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> a constant-time operation. Because of the</span>
<span class="line"> * asynchronous nature of these queues, determining the current number</span>
<span class="line"> * of elements requires a traversal of the elements, and so may report</span>
<span class="line"> * inaccurate results if this collection is modified during traversal.</span>
<span class="line"> * Additionally, the bulk operations <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">addAll</span></span><span class="token punctuation">}</span>,</span>
<span class="line"> * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">removeAll</span></span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">retainAll</span></span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">containsAll</span></span><span class="token punctuation">}</span>,</span>
<span class="line"> * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">equals</span></span><span class="token punctuation">}</span>, and <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">toArray</span></span><span class="token punctuation">}</span> are <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>not<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> guaranteed</span>
<span class="line"> * to be performed atomically. For example, an iterator operating</span>
<span class="line"> * concurrently with an <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">addAll</span></span><span class="token punctuation">}</span> operation might view only some</span>
<span class="line"> * of the added elements.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This class and its iterator implement all of the <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>optional<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * methods of the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Queue</span></span><span class="token punctuation">}</span> and <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Iterator</span></span><span class="token punctuation">}</span> interfaces.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Memory consistency effects: As with other concurrent</span>
<span class="line"> * collections, actions in a thread prior to placing an object into a</span>
<span class="line"> * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">ConcurrentLinkedQueue</span></span></span><span class="token punctuation">}</span></span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>package-summary.html#MemoryVisibility<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span>happen-before<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * actions subsequent to the access or removal of that element from</span>
<span class="line"> * the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">ConcurrentLinkedQueue</span></span></span><span class="token punctuation">}</span> in another thread.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This class is a member of the</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{@docRoot}/../technotes/guides/collections/index.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * Java Collections Framework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@since</span> 1.5</span>
<span class="line"> * <span class="token keyword">@author</span> Doug Lea</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>E<span class="token punctuation">&gt;</span></span> the type of elements held in this collection</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token keyword">implements</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">196745693267521676L</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="node-definition" tabindex="-1"><a class="header-anchor" href="#node-definition"><span>Node Definition</span></a></h2><p>é“¾ç»“ç‚¹çš„å®šä¹‰åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><code>item</code> ä¸ºç»“ç‚¹çš„å€¼</li><li><code>next</code> ä¸ºé“¾è¡¨æŒ‡é’ˆ</li></ul><p>å…¶ä¸­ï¼Œä¸º <code>item</code> å’Œ <code>next</code> æä¾›äº† CAS çš„èµ‹å€¼å‡½æ•°ï¼Œä¸º <code>next</code> æä¾›äº†éçº¿ç¨‹å®‰å…¨çš„èµ‹å€¼å‡½æ•° (ç”¨äºä¸€äº›ä¸ä¼šå‘ç”Ÿç«äº‰çš„åœºåˆ)ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">volatile</span> <span class="token class-name">E</span> item<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">volatile</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * Constructs a new node.  Uses relaxed write because item can</span>
<span class="line">     * only be seen after publication via casNext.</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token class-name">E</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> itemOffset<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">boolean</span> <span class="token function">casItem</span><span class="token punctuation">(</span><span class="token class-name">E</span> cmp<span class="token punctuation">,</span> <span class="token class-name">E</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">compareAndSwapObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> itemOffset<span class="token punctuation">,</span> cmp<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">lazySetNext</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">putOrderedObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> nextOffset<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">boolean</span> <span class="token function">casNext</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> cmp<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">compareAndSwapObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> nextOffset<span class="token punctuation">,</span> cmp<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Unsafe mechanics</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Unsafe</span> <span class="token constant">UNSAFE</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> itemOffset<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> nextOffset<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">static</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">UNSAFE</span> <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Unsafe</span><span class="token punctuation">.</span><span class="token function">getUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> k <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span></span>
<span class="line">            itemOffset <span class="token operator">=</span> <span class="token constant">UNSAFE</span><span class="token punctuation">.</span>objectFieldOffset</span>
<span class="line">                <span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            nextOffset <span class="token operator">=</span> <span class="token constant">UNSAFE</span><span class="token punctuation">.</span>objectFieldOffset</span>
<span class="line">                <span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;next&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fields" tabindex="-1"><a class="header-anchor" href="#fields"><span>Fields</span></a></h2><p>åˆ†åˆ«è®¾ç½®äº†å¤´å°¾æŒ‡é’ˆï¼Œç”± <code>transient</code> å’Œ <code>volatile</code> å…³é”®å­—ä¿®é¥°ã€‚</p><blockquote><p><code>transient</code> ä¼šä½¿å¯¹è±¡è¢« serialization åºåˆ—åŒ–æ—¶å¿½ç•¥è¿™ä¸ªå­—æ®µï¼Œç”Ÿå‘½å‘¨æœŸä»…å­˜åœ¨äºå†…å­˜ã€‚é™æ€å˜é‡ä¹Ÿä¸ä¼šè¢«åºåˆ—åŒ–ã€‚</p></blockquote><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * A node from which the first live (non-deleted) node (if any)</span>
<span class="line"> * can be reached in O(1) time.</span>
<span class="line"> * Invariants:</span>
<span class="line"> * - all live nodes are reachable from head via succ()</span>
<span class="line"> * - head != null</span>
<span class="line"> * - (tmp = head).next != tmp || tmp != head</span>
<span class="line"> * Non-invariants:</span>
<span class="line"> * - head.item may or may not be null.</span>
<span class="line"> * - it is permitted for tail to lag behind head, that is, for tail</span>
<span class="line"> *   to not be reachable from head!</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> head<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * A node from which the last node on list (that is, the unique</span>
<span class="line"> * node with node.next == null) can be reached in O(1) time.</span>
<span class="line"> * Invariants:</span>
<span class="line"> * - the last node is always reachable from tail via succ()</span>
<span class="line"> * - tail != null</span>
<span class="line"> * Non-invariants:</span>
<span class="line"> * - tail.item may or may not be null.</span>
<span class="line"> * - it is permitted for tail to lag behind head, that is, for tail</span>
<span class="line"> *   to not be reachable from head!</span>
<span class="line"> * - tail.next may or may not be self-pointing to tail.</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> tail<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="constructor" tabindex="-1"><a class="header-anchor" href="#constructor"><span>Constructor</span></a></h2><p>æ„é€ å‡½æ•°è´Ÿè´£åˆå§‹åŒ–å¤´ã€å°¾ç»“ç‚¹ã€‚å¯ä»¥é€‰æ‹©åœ¨æ„é€ è¿‡ç¨‹ä¸­æ˜¯å¦ä¼ å…¥ä¸€ä¸ªåˆå§‹é›†åˆã€‚å¯ä»¥çœ‹åˆ°ï¼Œç”±äºåˆå§‹åŒ–æ—¶ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ‰€ä»¥å¯¹ç»“ç‚¹çš„ <code>next</code> æŒ‡é’ˆè¿›è¡Œèµ‹å€¼æ—¶ä½¿ç”¨çš„æ˜¯ <code>lazySetNext()</code>ï¼Œè€Œä¸æ˜¯ <code>casNext()</code>ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Creates a <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">ConcurrentLinkedQueue</span></span></span><span class="token punctuation">}</span> that is initially empty.</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    head <span class="token operator">=</span> tail <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Creates a <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">ConcurrentLinkedQueue</span></span></span><span class="token punctuation">}</span></span>
<span class="line"> * initially containing the elements of the given collection,</span>
<span class="line"> * added in traversal order of the collection&#39;s iterator.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">c</span> the collection of elements to initially contain</span>
<span class="line"> * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">NullPointerException</span></span> if the specified collection or any</span>
<span class="line"> *         of its elements are null</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> h <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> t <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">E</span> e <span class="token operator">:</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">checkNotNull</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¡®ä¿å…ƒç´ ä¸ä¸º null</span></span>
<span class="line">        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–°ç»“ç‚¹</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">            h <span class="token operator">=</span> t <span class="token operator">=</span> newNode<span class="token punctuation">;</span> <span class="token comment">// æ–°ç»“ç‚¹æˆä¸ºé˜Ÿåˆ—ä¸­é¦–ä¸ªå…ƒç´ </span></span>
<span class="line">        <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// t ä¸ºå·²å…¥é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªç»“ç‚¹</span></span>
<span class="line">            t<span class="token punctuation">.</span><span class="token function">lazySetNext</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// t é“¾ä¸Šæ–°ç»“ç‚¹</span></span>
<span class="line">            t <span class="token operator">=</span> newNode<span class="token punctuation">;</span> <span class="token comment">// æ–°ç»“ç‚¹æˆä¸ºé˜Ÿåˆ—ä¸­çš„æœ€åä¸€ä¸ªç»“ç‚¹</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">        h <span class="token operator">=</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é›†åˆä¸ºç©ºï¼Œåˆå§‹åŒ–ç©ºçš„å¤´å°¾ç»“ç‚¹</span></span>
<span class="line">    head <span class="token operator">=</span> h<span class="token punctuation">;</span></span>
<span class="line">    tail <span class="token operator">=</span> t<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="input-operations" tabindex="-1"><a class="header-anchor" href="#input-operations"><span>Input Operations</span></a></h2><p>å…¥é˜Ÿæ“ä½œæœ¬è´¨ä¸Šè¦åšçš„äº‹æƒ…æœ‰ä¸¤ä»¶ï¼š</p><ol><li>å°†æ–°ç»“ç‚¹è®¾ç½®ä¸ºå½“å‰é˜Ÿå°¾ç»“ç‚¹çš„ <code>next</code> åŸŸä¸­</li><li>æ›´æ–°é˜Ÿåˆ—çš„ <code>tail</code> æŒ‡é’ˆ</li></ol><p>è€Œç”±äºç±»çš„å®ç°ä¸­æ²¡æœ‰é”ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæœ¬èº«æ˜¯åŸå­çš„ï¼Œä½†æ— æ³•ä¿è¯è¿™ä¸¤ä¸ªæ“ä½œçš„æ•´ä½“åŸå­æ€§ã€‚å› æ­¤ï¼Œ<code>tail</code> æŒ‡é’ˆå¹¶ä¸æ€»æ˜¯æŒ‡å‘å½“å‰é˜Ÿåˆ—ä¸­çš„æœ€åä¸€ä¸ªæŒ‡é’ˆã€‚é¦–å…ˆï¼Œéœ€è¦ä» <code>tail</code> å¼€å§‹å®šä½åˆ°çœŸæ­£çš„é˜Ÿå°¾ç»“ç‚¹ï¼Œå¹¶é€šè¿‡ CAS æ“ä½œå°†å…¥é˜Ÿç»“ç‚¹è®¾ç½®ä¸ºé˜Ÿå°¾ç»“ç‚¹çš„ <code>next</code>ã€‚å¦‚æœ CAS å¤±è´¥ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°ä» <code>tail</code> å¼€å§‹å®šä½é˜Ÿåˆ—çœŸæ­£çš„é˜Ÿå°¾ç»“ç‚¹ã€‚</p><p>å¦‚æœè¦ä¿è¯ <code>tail</code> æ°¸è¿œæ˜¯é˜Ÿåˆ—çš„å°¾ç»“ç‚¹ï¼Œéœ€è¦ä½¿ç”¨ CAS + å¾ªç¯çš„æ–¹å¼å®ç°ã€‚è¿™æ ·é€»è¾‘æ¯”è¾ƒæ¸…æ¥šï¼Œä½†æ˜¯ä¼šå¯¼è‡´è¾ƒå¤šæ¬¡æ•°çš„ CAS æ“ä½œã€‚ç›®å‰çš„å®ç°é€šè¿‡ hop æ¥æ§åˆ¶å‡å°‘ <code>tail</code> çš„æ›´æ–°é¢‘ç‡ï¼šè¯¥å˜é‡çš„å«ä¹‰æ˜¯å½“å‰ <code>tail</code> æŒ‡é’ˆä¸å®é™…é˜Ÿå°¾ä¹‹é—´çš„è·ç¦»ã€‚åªæœ‰å½“è¿™ä¸ªè·ç¦»å¤§äºç­‰äº 1 æ—¶æ‰ä¼šæ›´æ–° <code>tail</code> ç»“ç‚¹ï¼Œä»è€Œé¿å…äº†é˜Ÿå°¾ä¸€æ›´æ–°å°±æ›´æ–° <code>tail</code>ã€‚è¿™ç§å®ç°å‡å°‘äº† CAS æ›´æ–° <code>tail</code> çš„æ¬¡æ•°ï¼Œè´Ÿé¢å½±å“æ˜¯ä½¿å¾—å…¥é˜Ÿæ—¶å¯èƒ½éœ€è¦ä» <code>tail</code> å¼€å§‹å‘åå¯»æ‰¾ä»¥å®šä½çœŸæ­£çš„é˜Ÿå°¾ç»“ç‚¹ï¼šhop çš„å€¼è¶Šå¤§ï¼Œæ¯æ¬¡å®šä½é˜Ÿå°¾éœ€è¦å¾ªç¯çš„æ¬¡æ•°è¶Šå¤šï¼Œä½†è¿™æ ·ä»ç„¶æé«˜äº†æ•ˆç‡ã€‚è¿™æ˜¯å› ä¸ºé€šè¿‡å¢åŠ å¯¹ <code>volatile</code> å˜é‡çš„è¯»æ“ä½œå‡å°‘äº†å¯¹ <code>volatile</code> å˜é‡çš„å†™æ“ä½œ (x86 å¹³å°ä¸‹åªä¼šå¯¹ <code>volatile</code> å†™æ“ä½œé™„åŠ  Store-Load å†…å­˜å±éšœæŒ‡ä»¤)ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Inserts the specified element at the tail of this queue.</span>
<span class="line"> * As the queue is unbounded, this method will never throw</span>
<span class="line"> * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation">}</span> or return <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token boolean">false</span></span></span><span class="token punctuation">}</span>.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@return</span> <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token boolean">true</span></span></span><span class="token punctuation">}</span> (as specified by <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Collection</span><span class="token punctuation">#</span><span class="token field">add</span></span><span class="token punctuation">}</span>)</span>
<span class="line"> * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">NullPointerException</span></span> if the specified element is null</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">offer</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Inserts the specified element at the tail of this queue.</span>
<span class="line"> * As the queue is unbounded, this method will never return <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token boolean">false</span></span></span><span class="token punctuation">}</span>.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@return</span> <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token boolean">true</span></span></span><span class="token punctuation">}</span> (as specified by <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Queue</span><span class="token punctuation">#</span><span class="token field">offer</span></span><span class="token punctuation">}</span>)</span>
<span class="line"> * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">NullPointerException</span></span> if the specified element is null</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offer</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">checkNotNull</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> t <span class="token operator">=</span> tail<span class="token punctuation">,</span> p <span class="token operator">=</span> t<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> q <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>q <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// p is last node</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">casNext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> newNode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// Successful CAS is the linearization point</span></span>
<span class="line">                <span class="token comment">// for e to become an element of this queue,</span></span>
<span class="line">                <span class="token comment">// and for newNode to become &quot;live&quot;.</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> t<span class="token punctuation">)</span> <span class="token comment">// hop two nodes at a time</span></span>
<span class="line">                    <span class="token function">casTail</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Failure is OK.</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">// Lost CAS race to another thread; re-read next</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> q<span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// We have fallen off list.  If tail is unchanged, it</span></span>
<span class="line">            <span class="token comment">// will also be off-list, in which case we need to</span></span>
<span class="line">            <span class="token comment">// jump to head, from which all live nodes are always</span></span>
<span class="line">            <span class="token comment">// reachable.  Else the new tail is a better bet.</span></span>
<span class="line">            p <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token punctuation">(</span>t <span class="token operator">=</span> tail<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> t <span class="token operator">:</span> head<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">            <span class="token comment">// Check for tail updates after two hops.</span></span>
<span class="line">            p <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> t <span class="token operator">&amp;&amp;</span> t <span class="token operator">!=</span> <span class="token punctuation">(</span>t <span class="token operator">=</span> tail<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> t <span class="token operator">:</span> q<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="output-operations" tabindex="-1"><a class="header-anchor" href="#output-operations"><span>Output Operations</span></a></h2><p>å‡ºé˜Ÿæ“ä½œæœ¬è´¨ä¸Šè¦åšçš„äº‹ä¹Ÿæœ‰ä¸¤ä»¶ï¼š</p><ol><li>å°†ç»“ç‚¹çš„ <code>item</code> ç½®ä¸º <code>null</code> (æ¸…ç©ºç»“ç‚¹å¯¹å…ƒç´ çš„å¼•ç”¨)</li><li>æ›´æ–°é˜Ÿåˆ— <code>head</code> æŒ‡é’ˆ</li></ol><p>é¦–å…ˆä» <code>head</code> æŒ‡é’ˆæ‰€æŒ‡çš„ç»“ç‚¹å¼€å§‹æœç´ ï¼ŒæŸ¥çœ‹ç»“ç‚¹çš„ <code>item</code>ï¼š</p><ul><li>å¦‚æœç»“ç‚¹çš„ <code>item</code> ä¸ºç©ºï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªç»“ç‚¹å·²ç»æˆåŠŸè¿›è¡Œäº†å‡ºé˜Ÿæ“ä½œ</li><li>å¦‚æœç»“ç‚¹çš„ <code>item</code> ä¸ä¸ºç©ºï¼Œåˆ™è¯•å›¾ CAS å°†å…¶ç½®ä¸º <code>null</code><ul><li>å¦‚æœ CAS æˆåŠŸï¼Œé‚£ä¹ˆè¿”å› <code>item</code>ï¼Œå¹¶å°è¯•æ›´æ–° <code>head</code></li><li>å¦‚æœ CAS å¤±è´¥ï¼Œé‚£ä¹ˆè¯´æ˜å¦ä¸€ä¸ªçº¿ç¨‹å·²ç»è¿›è¡Œå‡ºé˜Ÿæ“ä½œå¹¶æ›´æ–°äº† <code>head</code>ï¼Œæ‰€ä»¥è¦é‡æ–°å®šä½é˜Ÿå¤´ç»“ç‚¹</li></ul></li></ul><p>ç±»ä¼¼åœ°ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡å‡ºé˜Ÿéƒ½ä¼šæ›´æ–° <code>head</code>ã€‚å½“ <code>head</code> ä¸­æœ‰å…ƒç´ æ—¶ï¼Œåˆ™ç›´æ¥å¼¹å‡ºé‡Œé¢çš„å…ƒç´ ï¼Œè€Œä¸æ›´æ–° <code>head</code> åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚å½“ <code>head</code> æŒ‡å‘çš„ç»“ç‚¹ä¸­æ²¡æœ‰å…ƒç´ æ—¶ï¼Œæ‰ä¼šæ›´æ–° <code>head</code> æŒ‡é’ˆã€‚å®é™…ä¸Šä¹Ÿæ˜¯é€šè¿‡ hop æ¥å‡å°‘ CAS æ›´æ–° <code>head</code> çš„é¢‘ç‡ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    restartFromHead<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> h <span class="token operator">=</span> head<span class="token punctuation">,</span> p <span class="token operator">=</span> h<span class="token punctuation">,</span> q<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">E</span> item <span class="token operator">=</span> p<span class="token punctuation">.</span>item<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span><span class="token function">casItem</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// Successful CAS is the linearization point</span></span>
<span class="line">                <span class="token comment">// for item to be removed from this queue.</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> h<span class="token punctuation">)</span> <span class="token comment">// hop two nodes at a time</span></span>
<span class="line">                    <span class="token function">updateHead</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>q <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> q <span class="token operator">:</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> item<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>q <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">updateHead</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> q<span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">continue</span> restartFromHead<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">else</span></span>
<span class="line">                p <span class="token operator">=</span> q<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­æ›´æ–° <code>head</code> æŒ‡é’ˆçš„ <code>updateHead()</code> å‡½æ•°ä¼šå°† <code>head</code> é€šè¿‡ CAS è®¾ç½®ä¸ºæ–°çš„ç»“ç‚¹ <code>p</code>ï¼ŒæˆåŠŸåè®©è€ç»“ç‚¹çš„ <code>next</code> æŒ‡å‘è‡ªå·±ï¼Œä»è€Œè„±ç¦»é“¾è¡¨ã€‚ä¸è®© <code>next</code> ç­‰äº <code>null</code> çš„åŸå› åœ¨äºï¼Œå…¶å®ƒè®¿é—®è¿™ä¸ªç»“ç‚¹çš„çº¿ç¨‹ä¼šè¯¯ä»¥ä¸ºè¿™ä¸ªç»“ç‚¹æ˜¯ <code>tail</code>ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Tries to CAS head to p. If successful, repoint old head to itself</span>
<span class="line"> * as sentinel for succ(), below.</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">updateHead</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> h<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">!=</span> p <span class="token operator">&amp;&amp;</span> <span class="token function">casHead</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        h<span class="token punctuation">.</span><span class="token function">lazySetNext</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Peek æ“ä½œæœ¬è´¨ä¸Šåªæ˜¯æƒ³æŸ¥çœ‹é˜Ÿå¤´å…ƒç´ ï¼Œè€Œä¸è¿›è¡Œå‡ºé˜Ÿæ“ä½œï¼Œæ‰€ä»¥æ²¡æœ‰ CAS æ“ä½œï¼Œå¤§è‡´æµç¨‹ç±»ä¼¼ã€‚é¦–å…ˆä» <code>head</code> å¼€å§‹æœç´ ï¼š</p><ul><li>å¦‚æœ <code>item</code> ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥è¿”å› <code>item</code> çš„å¼•ç”¨ï¼Œå¹¶æ›´æ–° <code>head</code></li><li>å¦‚æœ <code>item</code> ä¸ºç©ºï¼Œè¯´æ˜æœ‰çº¿ç¨‹å·²ç»æˆåŠŸè¿›è¡Œäº†å‡ºé˜Ÿæ“ä½œå¹¶ä¿®æ”¹äº† <code>head</code>ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°å®šä½é˜Ÿå¤´ç»“ç‚¹</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    restartFromHead<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> h <span class="token operator">=</span> head<span class="token punctuation">,</span> p <span class="token operator">=</span> h<span class="token punctuation">,</span> q<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">E</span> item <span class="token operator">=</span> p<span class="token punctuation">.</span>item<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>q <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">updateHead</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> item<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> q<span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">continue</span> restartFromHead<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">else</span></span>
<span class="line">                p <span class="token operator">=</span> q<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="size" tabindex="-1"><a class="header-anchor" href="#size"><span>Size</span></a></h2><p>åœ¨è¿™é‡Œè·å– size å®é™…ä¸Šæ˜¯ä¸ç²¾ç¡®çš„ï¼Œå› ä¸º size çš„ç»Ÿè®¡éœ€è¦éå†æ‰€æœ‰çš„é“¾ç»“ç‚¹ï¼Œç”±äºæ²¡æœ‰é”ï¼Œå¯èƒ½å­˜åœ¨å¹¶å‘çš„å…¥é˜Ÿæˆ–å‡ºé˜Ÿæ“ä½œï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Returns the number of elements in this queue.  If this queue</span>
<span class="line"> * contains more than <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span></span></span><span class="token punctuation">}</span> elements, returns</span>
<span class="line"> * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span></span></span><span class="token punctuation">}</span>.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Beware that, unlike in most collections, this method is</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>NOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> a constant-time operation. Because of the</span>
<span class="line"> * asynchronous nature of these queues, determining the current</span>
<span class="line"> * number of elements requires an O(n) traversal.</span>
<span class="line"> * Additionally, if elements are added or removed during execution</span>
<span class="line"> * of this method, the returned result may be inaccurate.  Thus,</span>
<span class="line"> * this method is typically not very useful in concurrent</span>
<span class="line"> * applications.</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@return</span> the number of elements in this queue</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> p <span class="token operator">=</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> p <span class="token operator">=</span> <span class="token function">succ</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>item <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// Collection.size() spec says to max out</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count <span class="token operator">==</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> count<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºéå†æ“ä½œéœ€è¦è·å–ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œåˆ†åˆ«å¯¹è¿™ä¸¤ä¸ªæ“ä½œå®ç°äº†å­å‡½æ•°ï¼š</p><ul><li><code>first()</code> å‡½æ•°ä¸ <code>peek()</code> çš„åŸç†ä¸€è‡´ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯ç»“ç‚¹è€Œä¸æ˜¯ç»“ç‚¹ä¸­çš„ <code>item</code></li><li><code>succ()</code> è¿”å›ä¸‹ä¸€ä¸ªç»“ç‚¹</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Returns the first live (non-deleted) node on list, or null if none.</span>
<span class="line"> * This is yet another variant of poll/peek; here returning the</span>
<span class="line"> * first node, not element.  We could make peek() a wrapper around</span>
<span class="line"> * first(), but that would cost an extra volatile read of item,</span>
<span class="line"> * and the need to add a retry loop to deal with the possibility</span>
<span class="line"> * of losing a race to a concurrent poll().</span>
<span class="line"> */</span></span>
<span class="line"><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    restartFromHead<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> h <span class="token operator">=</span> head<span class="token punctuation">,</span> p <span class="token operator">=</span> h<span class="token punctuation">,</span> q<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">boolean</span> hasItem <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>item <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>hasItem <span class="token operator">||</span> <span class="token punctuation">(</span>q <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">updateHead</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> hasItem <span class="token operator">?</span> p <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> q<span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">continue</span> restartFromHead<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">else</span></span>
<span class="line">                p <span class="token operator">=</span> q<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœç»“ç‚¹çš„ <code>next</code> æŒ‡å‘è‡ªèº«ï¼Œè¯´æ˜å½“å‰ç»“ç‚¹æ˜¯å¤´ç»“ç‚¹ï¼›å¦åˆ™æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Returns the successor of p, or the head node if p.next has been</span>
<span class="line"> * linked to self, which will only be true if traversing with a</span>
<span class="line"> * stale pointer that is now off the list.</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">succ</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> next <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> next<span class="token punctuation">)</span> <span class="token operator">?</span> head <span class="token operator">:</span> next<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="references" tabindex="-1"><a class="header-anchor" href="#references"><span>References</span></a></h2><p><a href="https://zhuanlan.zhihu.com/p/266610706" target="_blank" rel="noopener noreferrer">çŸ¥ä¹ä¸“æ  - Java å¹¶å‘ ConcurrentLinkedQueue æºç å­¦ä¹ ä¸æ€»ç»“</a></p><p><a href="https://developer.ibm.com/zh/articles/j-lo-concurrent/" target="_blank" rel="noopener noreferrer">éé˜»å¡ç®—æ³•åœ¨å¹¶å‘å®¹å™¨ä¸­çš„å®ç°</a></p><hr>`,52)]))}const i=s(t,[["render",l],["__file","Class - java.util.concurrent.ConcurrentLinkedQueue.html.vue"]]),u=JSON.parse('{"path":"/jdk-source-code-analysis/java.util.concurrent/Class%20-%20java.util.concurrent.ConcurrentLinkedQueue.html","title":"Class - java.util.concurrent.ConcurrentLinkedQueue","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Definition","slug":"definition","link":"#definition","children":[]},{"level":2,"title":"Node Definition","slug":"node-definition","link":"#node-definition","children":[]},{"level":2,"title":"Fields","slug":"fields","link":"#fields","children":[]},{"level":2,"title":"Constructor","slug":"constructor","link":"#constructor","children":[]},{"level":2,"title":"Input Operations","slug":"input-operations","link":"#input-operations","children":[]},{"level":2,"title":"Output Operations","slug":"output-operations","link":"#output-operations","children":[]},{"level":2,"title":"Size","slug":"size","link":"#size","children":[]},{"level":2,"title":"References","slug":"references","link":"#references","children":[]}],"git":{},"filePathRelative":"jdk-source-code-analysis/java.util.concurrent/Class - java.util.concurrent.ConcurrentLinkedQueue.md"}');export{i as comp,u as data};
