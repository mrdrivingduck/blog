import{_ as n,c as a,a as e,o as l}from"./app-BeHGwf2X.js";const i="/blog/assets/antlr-gen-kFD5D7XW.png",p="/blog/assets/antlr-test-rule-DpsO8EHy.png",t="/blog/assets/antlr-preview-DT28kA48.png",c={};function o(r,s){return l(),a("div",null,s[0]||(s[0]=[e(`<h1 id="antlr-basic" tabindex="-1"><a class="header-anchor" href="#antlr-basic"><span>ANTLR - Basic</span></a></h1><p>Created by : Mr Dk.</p><p>2020 / 01 / 14 17:25</p><p>Nanjing, Jiangsu, China</p><hr><p><strong>ANTLR (ANother Tool for Language Recognition)</strong> æ˜¯ä¸€å¥—è®¡ç®—æœºè¯­è¨€å¤„ç†æ¡†æ¶ï¼Œå¯ç”¨äºå¯¹ç‰¹å®šè¯­æ³•çš„è¯­è¨€è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­æ³•æ ‘æ„å»ºã€‚æœ€æ–°çš„ ANTLR v4 è§„å®šäº†ä¸€å¥— <strong>g4</strong> è¯­æ³•ã€‚g4 è¯­æ³•å¯ä»¥é’ˆå¯¹å¯¹è±¡è¯­è¨€è¿›è¡Œç±»ä¼¼ <em>å·´å…‹æ–¯èŒƒå¼ (Backus-Naur From, BNF)</em> çš„æè¿°ã€‚ANTLR å¯ä»¥å°† g4 è¯­æ³•æ–‡ä»¶ç›´æ¥è½¬æ¢ä¸ºè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æçš„ Java ä»£ç  (æˆ–å…¶å®ƒå®ç°è¯­è¨€)ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ª Java å®ç°çš„è¯­è¨€è¯†åˆ«å™¨ï¼Œæ¯”å¦‚ï¼š</p><ul><li>SQL è¯†åˆ«å™¨</li><li>JSON è¯†åˆ«å™¨</li></ul><p>é™¤äº†ç”¨äºè‡ªåŠ¨ç”Ÿæˆ Java ä»£ç ï¼ŒANTLR è¿˜æä¾›ä¸€ä¸ª <a href="https://github.com/antlr/antlr4" target="_blank" rel="noopener noreferrer">Runtime å·¥å…·</a>ï¼Œç”¨äºä¸ºè‡ªåŠ¨ç”Ÿæˆçš„ Java ä»£ç çš„æ‰§è¡Œæä¾›æ”¯æŒã€‚Runtime éœ€è¦ä½œä¸ºä¾èµ– (å¦‚ Maven) å¼•å…¥ã€‚å¯¹äºæµè¡Œé€šç”¨çš„ç¼–ç¨‹è¯­è¨€ã€æ ¼å¼ï¼Œå¼€æºç¤¾åŒºéƒ½å·²ç»æä¾›äº† <a href="https://github.com/antlr/grammars-v4" target="_blank" rel="noopener noreferrer">ç°æˆçš„ g4 è¯­æ³•æ–‡ä»¶</a> ğŸ¤</p><p>æœ¬æ–‡ä»¥ç”Ÿæˆä¸€ä¸ª Java ç‰ˆæœ¬çš„ JSON è§£æå™¨ä½œä¸º ğŸŒ°ã€‚</p><h2 id="example" tabindex="-1"><a class="header-anchor" href="#example"><span>Example</span></a></h2><p>ä»¥ä¸‹æ˜¯ <em>grammars-v4</em> ä¸­æä¾›çš„ JSON è¯­æ³•æ–‡ä»¶ <code>JSON.g4</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">/** Taken from &quot;The Definitive ANTLR 4 Reference&quot; by Terence Parr */</span>
<span class="line"></span>
<span class="line">// Derived from http://json.org</span>
<span class="line">grammar JSON;</span>
<span class="line"></span>
<span class="line">json</span>
<span class="line">   : value</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line">obj</span>
<span class="line">   : &#39;{&#39; pair (&#39;,&#39; pair)* &#39;}&#39;</span>
<span class="line">   | &#39;{&#39; &#39;}&#39;</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line">pair</span>
<span class="line">   : STRING &#39;:&#39; value</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line">array</span>
<span class="line">   : &#39;[&#39; value (&#39;,&#39; value)* &#39;]&#39;</span>
<span class="line">   | &#39;[&#39; &#39;]&#39;</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line">value</span>
<span class="line">   : STRING</span>
<span class="line">   | NUMBER</span>
<span class="line">   | obj</span>
<span class="line">   | array</span>
<span class="line">   | &#39;true&#39;</span>
<span class="line">   | &#39;false&#39;</span>
<span class="line">   | &#39;null&#39;</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">STRING</span>
<span class="line">   : &#39;&quot;&#39; (ESC | SAFECODEPOINT)* &#39;&quot;&#39;</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">fragment ESC</span>
<span class="line">   : &#39;\\\\&#39; ([&quot;\\\\/bfnrt] | UNICODE)</span>
<span class="line">   ;</span>
<span class="line">fragment UNICODE</span>
<span class="line">   : &#39;u&#39; HEX HEX HEX HEX</span>
<span class="line">   ;</span>
<span class="line">fragment HEX</span>
<span class="line">   : [0-9a-fA-F]</span>
<span class="line">   ;</span>
<span class="line">fragment SAFECODEPOINT</span>
<span class="line">   : ~ [&quot;\\\\\\u0000-\\u001F]</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">NUMBER</span>
<span class="line">   : &#39;-&#39;? INT (&#39;.&#39; [0-9] +)? EXP?</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">fragment INT</span>
<span class="line">   : &#39;0&#39; | [1-9] [0-9]*</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line">// no leading zeros</span>
<span class="line"></span>
<span class="line">fragment EXP</span>
<span class="line">   : [Ee] [+\\-]? INT</span>
<span class="line">   ;</span>
<span class="line"></span>
<span class="line">// \\- since - means &quot;range&quot; inside [...]</span>
<span class="line"></span>
<span class="line">WS</span>
<span class="line">   : [ \\t\\n\\r] + -&gt; skip</span>
<span class="line">   ;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰äº†è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥å€ŸåŠ© ANTLR çš„å·¥å…·ç›´æ¥ç”Ÿæˆè¯†åˆ« JSON çš„ Java ä»£ç ã€‚</p><p>ANTLR æä¾›å‘½ä»¤è¡Œç‰ˆæœ¬çš„å·¥å…·ï¼Œä½†æ›´æ–¹ä¾¿çš„è¿˜æ˜¯é›†æˆåœ¨ IDEA ä¸­çš„æ’ä»¶ï¼š</p><img src="`+i+`" alt="antlr-gen" style="zoom:50%;"><p>å¯¹è¯­æ³•æ–‡ä»¶è¿›è¡Œ <code>Generate ANTLR Recognizer</code> åï¼Œå¯ä»¥çœ‹åˆ°è‡ªåŠ¨ç”Ÿæˆäº†ä¸€äº›æ–‡ä»¶ã€‚å…¶ä¸­æ ¸å¿ƒçš„æ–‡ä»¶æ˜¯ï¼š</p><ul><li><code>JSONLexer.java</code>ï¼šè¯æ³•åˆ†æä»£ç </li><li><code>JSONParser.java</code>ï¼šè¯­æ³•åˆ†æä»£ç </li></ul><p>ç”Ÿæˆçš„å…¶å®ƒçš„æ–‡ä»¶æ¥ä¸‹æ¥å†ä½œè§£é‡Šã€‚æ¥ä¸‹æ¥ï¼Œåœ¨é¡¹ç›®ä¸­å¼•å…¥ ANTLR Runtime ä¾èµ–ã€‚ç”± ANTLR Runtime æ”¯æŒï¼Œè¿™äº›ç±»å°±å¯ä»¥è¢«å®ä¾‹åŒ–äº†ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">CharStream</span> input <span class="token operator">=</span> <span class="token class-name">CharStreams</span><span class="token punctuation">.</span><span class="token function">fromString</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">JSONLexer</span> lexer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONLexer</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">CommonTokenStream</span> tokens <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommonTokenStream</span><span class="token punctuation">(</span>lexer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">JSONParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONParser</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œè¯¥ç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°æŒ‡å®šçš„è¾“å…¥æ˜¯å¦å¯ä»¥è¢«è¯¥è¯†åˆ«å™¨æ‰€æ¥å—ã€‚</p><p>æ­¤å¤–ï¼Œæ’ä»¶è¿˜å¸¦æœ‰è¯­æ³•æ ‘é¢„è§ˆçš„åŠŸèƒ½ï¼Œåœ¨è¯­æ³•æ–‡ä»¶çš„ <em>top-level rule (é¡¶å±‚è¯­æ³•è§„åˆ™)</em> å³å‡» <code>Test Rule &lt;rule_name&gt;</code>ï¼š</p><img src="`+p+'" alt="antlr-test-rule" style="zoom:50%;"><p>ä»æ–‡æœ¬æ¡†æˆ–æ–‡ä»¶æ¥æ”¶æµ‹è¯•è¾“å…¥åï¼Œå°±èƒ½çœ‹åˆ°é¢„è§ˆçš„ ASTï¼š</p><p><img src="'+t+`" alt="antlr-preview"></p><h2 id="listener-visitor" tabindex="-1"><a class="header-anchor" href="#listener-visitor"><span>Listener &amp;&amp; Visitor</span></a></h2><p>ä½¿ç”¨ ANTLR æ¡†æ¶çš„æ›´å¤šéœ€æ±‚æ˜¯ï¼Œå½“è¿›å…¥æˆ–é€€å‡ºæŸæ¡è¯­æ³•è§„åˆ™çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚åœ¨ AST ä¸Šåšä¸€å®šçš„è½¬æ¢ã€‚ANTLR å…è®¸æˆ‘ä»¬åœ¨è¯­æ³•æ ‘ä¸Šæ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå¹¶æä¾›äº†ä¸¤ç§éå†æ–¹å¼ - listener å’Œ visitorã€‚</p><h3 id="listener" tabindex="-1"><a class="header-anchor" href="#listener"><span>Listener</span></a></h3><p>ä½¿ç”¨ ANTLR çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå¾—åˆ°äº†ä¸€ä¸ª <code>JSONListener.java</code>ã€‚è¿™æ˜¯ä¸€ä¸ªæ¥å£æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº† <strong>è¿›å…¥</strong> å’Œ <strong>é€€å‡º</strong> æ¯ä¸€æ¡è¯­æ³•è§„åˆ™çš„å‡½æ•°ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">JSONListener</span> <span class="token keyword">extends</span> <span class="token class-name">ParseTreeListener</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * Enter a parse tree produced by <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">JSONParser</span><span class="token punctuation">#</span><span class="token field">json</span></span><span class="token punctuation">}</span>.</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">ctx</span> the parse tree</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">enterJson</span><span class="token punctuation">(</span><span class="token class-name">JSONParser<span class="token punctuation">.</span>JsonContext</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * Exit a parse tree produced by <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">JSONParser</span><span class="token punctuation">#</span><span class="token field">json</span></span><span class="token punctuation">}</span>.</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">ctx</span> the parse tree</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">exitJson</span><span class="token punctuation">(</span><span class="token class-name">JSONParser<span class="token punctuation">.</span>JsonContext</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * Enter a parse tree produced by the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">AnObject</span></span></span><span class="token punctuation">}</span></span>
<span class="line">     * labeled alternative in <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">JSONParser</span><span class="token punctuation">#</span><span class="token field">obj</span></span><span class="token punctuation">}</span>.</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">ctx</span> the parse tree</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">enterAnObject</span><span class="token punctuation">(</span><span class="token class-name">JSONParser<span class="token punctuation">.</span>AnObjectContext</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * Exit a parse tree produced by the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">AnObject</span></span></span><span class="token punctuation">}</span></span>
<span class="line">     * labeled alternative in <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">JSONParser</span><span class="token punctuation">#</span><span class="token field">obj</span></span><span class="token punctuation">}</span>.</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">ctx</span> the parse tree</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">exitAnObject</span><span class="token punctuation">(</span><span class="token class-name">JSONParser<span class="token punctuation">.</span>AnObjectContext</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…ä¸Šå†…éƒ¨ç»§æ‰¿äº† ANTLR Runtime çš„ <code>ParseTreeListener</code> ç±»ã€‚åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªå¸Œæœ›æŒ‡å®šæŸå‡ ä¸ªè§„åˆ™çš„è¡Œä¸ºï¼Œå…¶å®ƒçš„ä»€ä¹ˆä¹Ÿä¸åšã€‚</p><p>ANTLR å·²ç»è‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ª <code>JSONBaseListener.java</code>ï¼Œè¯¥ç±»å®ç°äº†ä¸Šè¿°æ¥å£ä¸­å®šä¹‰çš„æ¯ä¸€ä¸ª <code>enter</code> / <code>exit</code> å‡½æ•°ï¼Œä½†æ¯ä¸ªå‡½æ•°çš„å®ç°éƒ½æ˜¯ç©ºçš„ã€‚æˆ‘ä»¬åªéœ€æ–°å»ºä¸€ä¸ªç»§æ‰¿è‡ª <code>JSONBaseListener</code> çš„ Classï¼Œå¹¶åªéœ€è¦ override æˆ‘ä»¬æƒ³è¦æ“ä½œçš„é‚£å‡ æ¡è§„åˆ™å¯¹åº”çš„å‡½æ•°å³å¯ã€‚</p><ul><li>å¦‚æœ override <code>enter</code> å‡½æ•°ï¼Œåˆ™æ˜¯ä¸€ç§å…ˆåºéå†çš„é€»è¾‘</li><li>å¦‚æœ override <code>exit</code> å‡½æ•°ï¼Œåˆ™æ˜¯ä¸€ç§ååºéå†çš„é€»è¾‘</li></ul><p>éå†çš„å…·ä½“è¿‡ç¨‹ï¼š</p><ol><li>éå†åˆ°ä¸€ä¸ªç»“ç‚¹æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ <code>enter</code> å‡½æ•°</li><li>è‡ªåŠ¨éå†æ‰€æœ‰çš„å­ç»“ç‚¹</li><li>å­ç»“ç‚¹éå†å®Œæ¯•åï¼Œè‡ªåŠ¨è°ƒç”¨ <code>exit</code> å‡½æ•°</li></ol><p>åœ¨éå†åˆ°æŸä¸€ç»“ç‚¹æ—¶ï¼Œå¯ä»¥é€šè¿‡å‚æ•°ä¸­çš„ context å–å¾—ç»“ç‚¹ä¸Šçš„ä¿¡æ¯ã€‚</p><p>éå†çš„åŸºæœ¬ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// ç”¨ä¹‹å‰å®ä¾‹åŒ–çš„ parserï¼Œå®ä¾‹åŒ–ä»é¡¶å±‚è§„åˆ™å¼€å§‹çš„è¯­æ³•æ ‘ (json æ˜¯é¡¶å±‚è§„åˆ™)</span></span>
<span class="line"><span class="token class-name">ParseTree</span> tree <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// å®ä¾‹åŒ–ä¸€ä¸ª listener</span></span>
<span class="line"><span class="token class-name">JSON2XML<span class="token punctuation">.</span>XMLEmitter</span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSON2XML<span class="token punctuation">.</span>XMLEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// å®ä¾‹åŒ– walker</span></span>
<span class="line"><span class="token class-name">ParseTreeWalker</span> walker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParseTreeWalker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// é€šè¿‡ walkerï¼Œå‘è¯­æ³•æ ‘ä¸Šæ³¨å†Œ listener å¹¶éå†</span></span>
<span class="line">walker<span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> tree<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="visitor" tabindex="-1"><a class="header-anchor" href="#visitor"><span>Visitor</span></a></h3><p>ANTLR çš„ä»£ç ç”Ÿæˆå·¥å…·ä¹Ÿè‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ª <code>JSONVisitor.java</code>ã€‚è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢å®šä¹‰äº†è®¿é—®åˆ°æ¯ä¸€æ¡è¯­æ³•è§„åˆ™å¯¹åº”ç»“ç‚¹çš„å‡½æ•°ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">JSONVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">ParseTreeVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * Visit a parse tree produced by <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">JSONParser</span><span class="token punctuation">#</span><span class="token field">json</span></span><span class="token punctuation">}</span>.</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">ctx</span> the parse tree</span>
<span class="line">	 * <span class="token keyword">@return</span> the visitor result</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token class-name">T</span> <span class="token function">visitJson</span><span class="token punctuation">(</span><span class="token class-name">JSONParser<span class="token punctuation">.</span>JsonContext</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * Visit a parse tree produced by the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">AnObject</span></span></span><span class="token punctuation">}</span></span>
<span class="line">	 * labeled alternative in <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">JSONParser</span><span class="token punctuation">#</span><span class="token field">obj</span></span><span class="token punctuation">}</span>.</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">ctx</span> the parse tree</span>
<span class="line">	 * <span class="token keyword">@return</span> the visitor result</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token class-name">T</span> <span class="token function">visitAnObject</span><span class="token punctuation">(</span><span class="token class-name">JSONParser<span class="token punctuation">.</span>AnObjectContext</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ listener çš„åŒºåˆ«åœ¨äºï¼Œ<code>visit</code> å‡½æ•°åœ¨è®¿é—®åˆ°æŸä¸ªç»“ç‚¹æ—¶è¢«è§¦å‘ã€‚å¦‚æœè¿˜æƒ³ç»§ç»­è®¿é—®å­ç»“ç‚¹ï¼Œéœ€è¦æ˜¾å¼è°ƒç”¨ <code>visitChild()</code> å‡½æ•°ã€‚å¦åˆ™ï¼Œéå†æ·±åº¦å°±åœ¨è¯¥ç»“ç‚¹ä¸­æ­¢ã€‚</p><p>åŒæ ·ï¼Œä»£ç ç”Ÿæˆå·¥å…·ç”Ÿæˆäº† <code>JSONBaseVisitor.java</code>ï¼Œè¯¥ç±»å®ç°äº†æ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰å‡½æ•°ï¼Œå¹¶åœ¨æ¯ä¸ªå‡½æ•°ä¸­é»˜è®¤è°ƒç”¨äº† <code>visitChild()</code> å‡½æ•°ä»¥ç»§ç»­è¿›è¡Œéå†ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token punctuation">{</span><span class="token keyword">@inheritDoc</span><span class="token punctuation">}</span></span>
<span class="line"> *</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>The default implementation returns the result of calling</span>
<span class="line"> * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">visitChildren</span></span><span class="token punctuation">}</span> on <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">ctx</span></span><span class="token punctuation">}</span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">visitJson</span><span class="token punctuation">(</span><span class="token class-name">JSONParser<span class="token punctuation">.</span>JsonContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">visitChildren</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœéœ€è¦è‡ªå®šä¹‰å®ç°é€»è¾‘ï¼Œåªéœ€æ–°å»ºä¸€ä¸ªç»§æ‰¿è‡ª <code>JSONBaseVisitor</code> çš„ Classï¼Œå¹¶ override å¯¹åº”å‡½æ•°å³å¯ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">JSONBaseVisitor</span> visitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONBaseVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®ä¾‹åŒ– visitorï¼Œå¹¶ visit è¯­æ³•æ ‘</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="label" tabindex="-1"><a class="header-anchor" href="#label"><span>Label</span></a></h3><p>å¯¹äºæŸä¸€æ¡è¯­æ³•è§„åˆ™ï¼Œå¦‚æœæƒ³ç”Ÿæˆæ›´åŠ ç»†ç²’åº¦çš„å‡½æ•°è¿›è¡Œåˆ†åˆ«å¤„ç†è¯¥æ€ä¹ˆåšï¼Ÿ</p><p>æ¯”å¦‚ï¼Œå¯¹äº JSON ä¸­ value çš„å–å€¼ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">value</span>
<span class="line">   : STRING</span>
<span class="line">   | NUMBER</span>
<span class="line">   | obj</span>
<span class="line">   | array</span>
<span class="line">   | &#39;true&#39;</span>
<span class="line">   | &#39;false&#39;</span>
<span class="line">   | &#39;null&#39;</span>
<span class="line">   ;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æƒ³å¯¹æ•°å­— (<code>NUMBER</code>)ã€å¸ƒå°”å€¼ (<code>true</code> / <code>false</code>)ã€ç©ºå€¼ (<code>null</code>) ä½œç‰¹æ®Šå¤„ç†ï¼Œè€Œå¯¹å…¶å®ƒçš„ä¸ä½œã€‚æŒ‰ç…§é»˜è®¤çš„æ¨¡å¼ï¼Œåº”å½“åªä¼šç”Ÿæˆ <code>enterValue()</code> / <code>exitValue()</code> / <code>visitValue()</code>ï¼Œæ— æ³•æ»¡è¶³è¿™ä¸€éœ€æ±‚ã€‚é‚£ä¹ˆå¯ä»¥åœ¨è¯­æ³•æ–‡ä»¶ä¸­åŠ å…¥ labelï¼Œç»†åŒ–è¦äº§ç”Ÿçš„å‡½æ•°ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">value</span>
<span class="line">   : STRING  # String</span>
<span class="line">   | NUMBER  # Atom</span>
<span class="line">   | obj     # ObjectValue</span>
<span class="line">   | array   # ArrayValue</span>
<span class="line">   | &#39;true&#39;  # Atom</span>
<span class="line">   | &#39;false&#39; # Atom</span>
<span class="line">   | &#39;null&#39;  # Atom</span>
<span class="line">   ;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ³¨æ„ï¼Œlabel åœ¨ä¸€æ¡è§„åˆ™ä¸­è¦ä¹ˆå…¨åŠ ï¼Œè¦ä¹ˆå…¨ä¸åŠ </p></blockquote><p>ç„¶åé‡æ–°ä½¿ç”¨ ANTLR çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥çœ‹åˆ°é¢å¤–äº§ç”Ÿäº†å››ç»„å‡½æ•°ï¼š</p><ul><li><code>enterString()</code> / <code>exitString()</code> / <code>visitString()</code></li><li><code>enterObjectValue()</code> / <code>exitObjectValue()</code> / <code>visitObjectValue()</code></li><li><code>enterArrayValue()</code> / <code>exitArrayValue()</code> / <code>visitArrayValue()</code></li><li><code>enterAtom()</code> / <code>exitAtom()</code> / <code>visitAtom()</code></li></ul><p>è¿™æ ·ï¼Œå°±å¯ä»¥æŒ‰ç±»åˆ«åˆ†åˆ«å®ç°è‡ªå®šä¹‰æ“ä½œäº†ã€‚</p><h2 id="case-insensitive-lexing" tabindex="-1"><a class="header-anchor" href="#case-insensitive-lexing"><span>Case-Insensitive Lexing</span></a></h2><p>å¯¹äº SQL ç­‰ä¸€äº› (å…³é”®å­—ä»¥å¤–) å¤§å°å†™ä¸æ•æ„Ÿçš„è¯­è¨€çš„å¤„ç†æ–¹å¼ï¼š</p><ul><li><a href="https://github.com/antlr/antlr4/blob/master/doc/case-insensitive-lexing.md#custom-character-streams-approach" target="_blank" rel="noopener noreferrer">Case-Insensitive Lexing</a></li></ul><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>è¿™å¥—å·¥å…·ç”±æ—§é‡‘å±±å¤§å­¦çš„ <a href="https://github.com/parrt" target="_blank" rel="noopener noreferrer">Terence Parr</a> æ•™æˆå¼€å‘ã€‚æˆ‘æœ¬äººå¾ˆä½©æœè¿™å¥—æ¡†æ¶çš„å®šä½ï¼šç±»ä¼¼äº LLVM ç¼–è¯‘å™¨çš„å‰åç«¯è§£è€¦ï¼ŒANTLR å®ç°äº†è¯­æ³•å’Œåº”ç”¨é€»è¾‘çš„è§£è€¦ï¼Œä½¿æˆ‘ä»¬åœ¨å¤§éƒ¨åˆ†åº”ç”¨åœºæ™¯ä¸‹ï¼Œä¸ç”¨å¤ªå…³å¿ƒè¯­æ³•çš„å…·ä½“ç»†èŠ‚ï¼Œä¸å†éœ€è¦ä¸“é—¨å®ç°è¯­æ³•çš„è§£æé€»è¾‘ï¼Œå› ä¸º ANTLR å¸®æˆ‘ä»¬å®Œæˆäº†æœ€å¤æ‚çš„ <strong>è¯­æ³• â†’ åº”ç”¨ç¨‹åº</strong> çš„è‡ªåŠ¨è½¬æ¢ã€‚(å®é™…ä¸Šä¹Ÿå°±æ˜¯è¯æ³•ã€è¯­æ³•åˆ†æä»£ç çš„è‡ªåŠ¨ç”Ÿæˆ)</p><p>æ­¤å¤–ï¼Œå…·ä½“çš„è¯­æ³•ç»†èŠ‚ç”±ç›¸å…³æ–¹é¢çš„ä¸“å®¶ä»£ä¸ºå®Œæˆï¼Œæœ‰äº†è¿™å¥—æ¡†æ¶ï¼Œå¼€å‘ä¸è¯­è¨€ç›¸å…³çš„åº”ç”¨å°†æ›´ä¸ºå®¹æ˜“ã€‚</p>`,61)]))}const u=n(c,[["render",o],["__file","ANTLR Basic.html.vue"]]),v=JSON.parse('{"path":"/notes/Compiler/ANTLR%20Basic.html","title":"ANTLR - Basic","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Example","slug":"example","link":"#example","children":[]},{"level":2,"title":"Listener && Visitor","slug":"listener-visitor","link":"#listener-visitor","children":[{"level":3,"title":"Listener","slug":"listener","link":"#listener","children":[]},{"level":3,"title":"Visitor","slug":"visitor","link":"#visitor","children":[]},{"level":3,"title":"Label","slug":"label","link":"#label","children":[]}]},{"level":2,"title":"Case-Insensitive Lexing","slug":"case-insensitive-lexing","link":"#case-insensitive-lexing","children":[]},{"level":2,"title":"Summary","slug":"summary","link":"#summary","children":[]}],"git":{},"filePathRelative":"notes/Compiler/ANTLR Basic.md"}');export{u as comp,v as data};
