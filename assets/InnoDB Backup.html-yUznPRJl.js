import{_ as a,c as i,a as e,o as c}from"./app-7eKjwDat.js";const n={};function p(o,l){return c(),i("div",null,l[0]||(l[0]=[e('<h1 id="innodb-backup" tabindex="-1"><a class="header-anchor" href="#innodb-backup"><span>InnoDB - Backup</span></a></h1><p>Created by : Mr Dk.</p><p>2020 / 10 / 18 23:52</p><p>Nanjing, Jiangsu, China</p><hr><h2 id="classification" tabindex="-1"><a class="header-anchor" href="#classification"><span>Classification</span></a></h2><p>按照备份的方法，可以分为：</p><ul><li>Hot Backup - 在数据库运行中直接备份，对正在运行的数据操作没有任何影响</li><li>Cold Backup - 在数据库停止的情况下备份</li><li>Warm Backup - 在数据库运行中备份，但对当前数据库操作有影响</li></ul><p>按照备份后文件的内容，可分为：</p><ul><li>逻辑备份 - 备份出的文件内容是可读的，但需要恢复的时间较长</li><li>裸文件备份 - 直接复制数据库的物理文件，恢复时间短</li></ul><p>按照备份数据库的内容来分：</p><ul><li>完全备份 - 对整个数据库进行完整备份</li><li>增量备份 - 在上次完整备份的基础上对更改的数据进行备份</li><li>日志备份 - 对 MySQL 的二进制日志备份并 redo</li></ul><h2 id="cold-backup" tabindex="-1"><a class="header-anchor" href="#cold-backup"><span>Cold Backup</span></a></h2><p>冷备份只需要备份 MySQL 的 frm 文件、共享表空间文件、独立表空间文件、redo log 文件。</p><ul><li>备份简单，只需要复制文件</li><li>备份文件可跨平台</li><li>恢复简单且速度快</li><li>冷备文件比逻辑文件大很多</li></ul><h2 id="logical-backup" tabindex="-1"><a class="header-anchor" href="#logical-backup"><span>Logical Backup</span></a></h2><h3 id="mysqldump" tabindex="-1"><a class="header-anchor" href="#mysqldump"><span>mysqldump</span></a></h3><p>备份出的文件内容是表结构和数据，由 SQL 语句表示。</p><ul><li><code>--single-transaction</code> 参数用于备份 InnoDB 存储引擎 - 在备份开始前，执行一次 <code>START TRANSACTION</code>，但需要确保没有其它 DDL 语句执行</li><li><code>--lock-tables</code> - 依次锁住每个架构 (存储引擎) 下的所有表，只能保证部分表的一致性</li><li><code>--lock-all-tables</code> - 对所有架构中的所有表上锁，保证所有表的一致性</li></ul><p>在恢复时，只需要执行导出的 SQL 语句即可。</p><blockquote><p>通过 mysqldump 备份数据库时，并不能导出视图 - 需要手动完成。</p></blockquote><h3 id="select-into-outfile" tabindex="-1"><a class="header-anchor" href="#select-into-outfile"><span>SELECT...INTO OUTFILE</span></a></h3><p>使用 <code>LOAD DATA INFILE</code> 导入备份数据。其命令行接口为 mysqlimport 工具。</p><h2 id="binary-log-backup" tabindex="-1"><a class="header-anchor" href="#binary-log-backup"><span>Binary Log Backup</span></a></h2><p>MySQL 默认不启用二进制日志，需要通过配置文件开启。另外，还需要启用一些其它参数保证二进制日志的安全记录。通过 mysqlbinlog 工具，可以使用二进制日志恢复数据库。</p><h2 id="hot-backup" tabindex="-1"><a class="header-anchor" href="#hot-backup"><span>Hot Backup</span></a></h2><h3 id="ibbackup" tabindex="-1"><a class="header-anchor" href="#ibbackup"><span>ibbackup</span></a></h3><p>工作原理：</p><ul><li>记录备份开始时 redo log 检查点的 LSN</li><li>复制共享表空间和独立表空间的文件</li><li>记录复制完毕后 redo log 检查点的 LSN</li><li>复制两个 LSN 中间的 redo log</li></ul><p>数据恢复的步骤：</p><ol><li>恢复表空间文件</li><li>应用 redo log</li></ol><p>优点：</p><ul><li>在线备份，不阻塞任何 SQL 语句</li><li>备份性能好，支持压缩，且跨平台支持</li></ul><h3 id="xtrabackup" tabindex="-1"><a class="header-anchor" href="#xtrabackup"><span>XtraBackup</span></a></h3><p>XtraBackup 能够对 InnoDB 存储引擎实现增量备份：</p><ol><li>首先完成一次完全备份，并记录此时 checkpoint 的 LSN</li><li>增量备份时，比较表空间中每个页的 LSN 是否大于上次备份的 LSN，如果是，则备份并记录当前检查点 LSN</li></ol><h2 id="replication" tabindex="-1"><a class="header-anchor" href="#replication"><span>Replication</span></a></h2><p>MySQL 数据库提供了高可用高性能的主从模式：</p><ol><li>主服务器将数据更改记录到二进制日志中</li><li>从服务器将主服务器的二进制日志复制到自身的 relay log 中</li><li>从服务器 redo relay log，把更改应用到自身上，保证主从一致性</li></ol><p>复制的原理实际上是完全备份 + 二进制日志备份的还原。但是复制并不是完全实时的，而是异步实时，主从服务器之间可能会存在延时。</p><hr>',41)]))}const s=a(n,[["render",p],["__file","InnoDB Backup.html.vue"]]),r=JSON.parse('{"path":"/notes/MySQL/InnoDB%20Backup.html","title":"InnoDB - Backup","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Classification","slug":"classification","link":"#classification","children":[]},{"level":2,"title":"Cold Backup","slug":"cold-backup","link":"#cold-backup","children":[]},{"level":2,"title":"Logical Backup","slug":"logical-backup","link":"#logical-backup","children":[{"level":3,"title":"mysqldump","slug":"mysqldump","link":"#mysqldump","children":[]},{"level":3,"title":"SELECT...INTO OUTFILE","slug":"select-into-outfile","link":"#select-into-outfile","children":[]}]},{"level":2,"title":"Binary Log Backup","slug":"binary-log-backup","link":"#binary-log-backup","children":[]},{"level":2,"title":"Hot Backup","slug":"hot-backup","link":"#hot-backup","children":[{"level":3,"title":"ibbackup","slug":"ibbackup","link":"#ibbackup","children":[]},{"level":3,"title":"XtraBackup","slug":"xtrabackup","link":"#xtrabackup","children":[]}]},{"level":2,"title":"Replication","slug":"replication","link":"#replication","children":[]}],"git":{},"filePathRelative":"notes/MySQL/InnoDB Backup.md"}');export{s as comp,r as data};
