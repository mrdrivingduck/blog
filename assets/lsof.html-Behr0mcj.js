import{_ as n,c as a,a as e,o as p}from"./app-7eKjwDat.js";const t={};function l(o,s){return p(),a("div",null,s[0]||(s[0]=[e(`<h1 id="lsof" tabindex="-1"><a class="header-anchor" href="#lsof"><span>lsof</span></a></h1><p>Created by : Mr Dk.</p><p>2022 / 12 / 22 23:30 🐑</p><p>Hangzhou, Zhejiang, China</p><hr><h2 id="background" tabindex="-1"><a class="header-anchor" href="#background"><span>Background</span></a></h2><p><code>lsof</code>（list open files）用于查看已打开的 <strong>文件</strong>。由于 Linux 中一切皆文件，所以它将输出一切形式的已打开文件：</p><ul><li>常规文件、目录</li><li>字符设备、块设备</li><li>管道</li><li>...</li></ul><h2 id="usage" tabindex="-1"><a class="header-anchor" href="#usage"><span>Usage</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">lsof</span> <span class="token parameter variable">-h</span></span>
<span class="line"><span class="token function">lsof</span> <span class="token number">4.93</span>.2</span>
<span class="line"> latest revision: https://github.com/lsof-org/lsof</span>
<span class="line"> latest FAQ: https://github.com/lsof-org/lsof/blob/master/00FAQ</span>
<span class="line"> latest <span class="token punctuation">(</span>non-formatted<span class="token punctuation">)</span> <span class="token function">man</span> page: https://github.com/lsof-org/lsof/blob/master/Lsof.8</span>
<span class="line"> usage: <span class="token punctuation">[</span>-?abhKlnNoOPRtUvVX<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token operator">|</span>-c c<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token operator">|</span>-d s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+D D<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token operator">|</span>-E<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token operator">|</span>-e s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token operator">|</span>-f<span class="token punctuation">[</span>gG<span class="token punctuation">]</span><span class="token punctuation">]</span></span>
<span class="line"> <span class="token punctuation">[</span>-F <span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-g <span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-i <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token operator">|</span>-L <span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>+m <span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token operator">|</span>-M<span class="token punctuation">]</span> <span class="token punctuation">[</span>-o <span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-p s<span class="token punctuation">]</span></span>
<span class="line"> <span class="token punctuation">[</span>+<span class="token operator">|</span>-r <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-s <span class="token punctuation">[</span>p:s<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-S <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-T <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-u s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token operator">|</span>-w<span class="token punctuation">]</span> <span class="token punctuation">[</span>-x <span class="token punctuation">[</span>fl<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token punctuation">]</span> <span class="token punctuation">[</span>names<span class="token punctuation">]</span></span>
<span class="line">Defaults <span class="token keyword">in</span> parentheses<span class="token punctuation">;</span> comma-separated <span class="token builtin class-name">set</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> items<span class="token punctuation">;</span> dash-separated ranges.</span>
<span class="line">  -?<span class="token operator">|</span>-h list <span class="token builtin class-name">help</span>          <span class="token parameter variable">-a</span> AND selections <span class="token punctuation">(</span>OR<span class="token punctuation">)</span>     <span class="token parameter variable">-b</span> avoid kernel blocks</span>
<span class="line">  <span class="token parameter variable">-c</span> c  cmd c ^c /c/<span class="token punctuation">[</span>bix<span class="token punctuation">]</span>  +c w  COMMAND width <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>    +d s  <span class="token function">dir</span> s files</span>
<span class="line">  <span class="token parameter variable">-d</span> s  <span class="token keyword">select</span> by FD <span class="token builtin class-name">set</span>   +D D  <span class="token function">dir</span> D tree *SLOW?*   +<span class="token operator">|</span>-e s  exempt s *RISKY*</span>
<span class="line">  <span class="token parameter variable">-i</span> <span class="token keyword">select</span> IPv<span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">]</span> files  <span class="token parameter variable">-K</span> <span class="token punctuation">[</span>i<span class="token punctuation">]</span> list<span class="token operator">|</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>gn tasKs    <span class="token parameter variable">-l</span> list <span class="token environment constant">UID</span> numbers</span>
<span class="line">  <span class="token parameter variable">-n</span> no <span class="token function">host</span> names         <span class="token parameter variable">-N</span> <span class="token keyword">select</span> NFS files        <span class="token parameter variable">-o</span> list <span class="token function">file</span> offset</span>
<span class="line">  <span class="token parameter variable">-O</span> no overhead *RISKY*   <span class="token parameter variable">-P</span> no port names           <span class="token parameter variable">-R</span> list paRent PID</span>
<span class="line">  <span class="token parameter variable">-s</span> list <span class="token function">file</span> size        <span class="token parameter variable">-t</span> terse listing           <span class="token parameter variable">-T</span> disable TCP/TPI info</span>
<span class="line">  <span class="token parameter variable">-U</span> <span class="token keyword">select</span> Unix socket    <span class="token parameter variable">-v</span> list version info       <span class="token parameter variable">-V</span> verbose search</span>
<span class="line">  +<span class="token operator">|</span>-w  Warnings <span class="token punctuation">(</span>+<span class="token punctuation">)</span>       <span class="token parameter variable">-X</span> skip TCP<span class="token operator">&amp;</span>UDP* files     <span class="token parameter variable">-Z</span> Z  context <span class="token punctuation">[</span>Z<span class="token punctuation">]</span></span>
<span class="line">  -- end option scan</span>
<span class="line">  <span class="token parameter variable">-E</span> display endpoint info              +E display endpoint info and files</span>
<span class="line">  +f<span class="token operator">|</span>-f  +filesystem or <span class="token parameter variable">-file</span> names     +<span class="token operator">|</span>-f<span class="token punctuation">[</span>gG<span class="token punctuation">]</span> flaGs</span>
<span class="line">  <span class="token parameter variable">-F</span> <span class="token punctuation">[</span>f<span class="token punctuation">]</span> <span class="token keyword">select</span> fields<span class="token punctuation">;</span> -F? <span class="token keyword">for</span> <span class="token builtin class-name">help</span></span>
<span class="line">  +<span class="token operator">|</span>-L <span class="token punctuation">[</span>l<span class="token punctuation">]</span> list <span class="token punctuation">(</span>+<span class="token punctuation">)</span> suppress <span class="token punctuation">(</span>-<span class="token punctuation">)</span> <span class="token function">link</span> counts <span class="token operator">&lt;</span> l <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">=</span> all<span class="token punctuation">;</span> default <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">                                        +m <span class="token punctuation">[</span>m<span class="token punctuation">]</span> use<span class="token operator">|</span>create <span class="token function">mount</span> supplement</span>
<span class="line">  +<span class="token operator">|</span>-M   portMap registration <span class="token punctuation">(</span>-<span class="token punctuation">)</span>       <span class="token parameter variable">-o</span> o   o 0t offset digits <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token parameter variable">-p</span> s   exclude<span class="token punctuation">(</span>^<span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">select</span> PIDs         <span class="token parameter variable">-S</span> <span class="token punctuation">[</span>t<span class="token punctuation">]</span> t second <span class="token function">stat</span> <span class="token function">timeout</span> <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token parameter variable">-T</span> qs TCP/TPI Q,St <span class="token punctuation">(</span>s<span class="token punctuation">)</span> info</span>
<span class="line">  <span class="token parameter variable">-g</span> <span class="token punctuation">[</span>s<span class="token punctuation">]</span> exclude<span class="token punctuation">(</span>^<span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">select</span> and print process group IDs</span>
<span class="line">  <span class="token parameter variable">-i</span> i   <span class="token keyword">select</span> by IPv<span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">]</span> address: <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">[</span>proto<span class="token punctuation">]</span><span class="token punctuation">[</span>@host<span class="token operator">|</span>addr<span class="token punctuation">]</span><span class="token punctuation">[</span>:svc_list<span class="token operator">|</span>port_list<span class="token punctuation">]</span></span>
<span class="line">  +<span class="token operator">|</span>-r <span class="token punctuation">[</span>t<span class="token punctuation">[</span>m<span class="token operator">&lt;</span>fmt<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> repeat every t seconds <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  + <span class="token keyword">until</span> no files, - forever.</span>
<span class="line">       An optional suffix to t is m<span class="token operator">&lt;</span>fmt<span class="token operator">&gt;</span><span class="token punctuation">;</span> m must separate t from <span class="token operator">&lt;</span>fmt<span class="token operator">&gt;</span> and</span>
<span class="line">      <span class="token operator">&lt;</span>fmt<span class="token operator">&gt;</span> is an strftime<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token function">format</span> <span class="token keyword">for</span> the marker line.</span>
<span class="line">  <span class="token parameter variable">-s</span> p:s  exclude<span class="token punctuation">(</span>^<span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">select</span> protocol <span class="token punctuation">(</span>p <span class="token operator">=</span> TCP<span class="token operator">|</span>UDP<span class="token punctuation">)</span> states by name<span class="token punctuation">(</span>s<span class="token punctuation">)</span>.</span>
<span class="line">  <span class="token parameter variable">-u</span> s   exclude<span class="token punctuation">(</span>^<span class="token punctuation">)</span><span class="token operator">|</span><span class="token keyword">select</span> login<span class="token operator">|</span><span class="token environment constant">UID</span> <span class="token builtin class-name">set</span> s</span>
<span class="line">  <span class="token parameter variable">-x</span> <span class="token punctuation">[</span>fl<span class="token punctuation">]</span> cross over +d<span class="token operator">|</span>+D File systems or symbolic Links</span>
<span class="line">  names  <span class="token keyword">select</span> named files or files on named <span class="token function">file</span> systems</span>
<span class="line">Anyone can list all files<span class="token punctuation">;</span> /dev warnings disabled<span class="token punctuation">;</span> kernel ID check disabled.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果不加任何参数，将输出大一堆看也看不完的信息。所以先按列来捋一捋每列的含义：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">lsof</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">5</span></span>
<span class="line">COMMAND       PID     TID TASKCMD              <span class="token environment constant">USER</span>   FD      TYPE             DEVICE SIZE/OFF       NODE NAME</span>
<span class="line">systemd         <span class="token number">1</span>                              root  cwd       DIR              <span class="token number">252,2</span>     <span class="token number">4096</span>          <span class="token number">2</span> /</span>
<span class="line">systemd         <span class="token number">1</span>                              root  rtd       DIR              <span class="token number">252,2</span>     <span class="token number">4096</span>          <span class="token number">2</span> /</span>
<span class="line">systemd         <span class="token number">1</span>                              root  txt       REG              <span class="token number">252,2</span>  <span class="token number">1620224</span>     <span class="token number">139845</span> /usr/lib/systemd/systemd</span>
<span class="line">systemd         <span class="token number">1</span>                              root  mem       REG              <span class="token number">252,2</span>  <span class="token number">1369384</span>     <span class="token number">140226</span> /usr/lib/x86_64-linux-gnu/libm-2.31.so</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中：</p><ul><li><code>COMMAND</code> 列显示与该进程相关的 UNIX 命令的前九个字符</li><li><code>PID</code> / <code>TID</code> 列显示进程号 / 线程号</li><li><code>TASKCMD</code>：任务命令名，在 Linux 上可以与 <code>COMMAND</code> 不同</li><li><code>USER</code> 列显示进程所属用户</li><li><code>FD</code> 列显示文件描述符编号（普通文件），或： <ul><li><code>cwd</code>：当前工作目录</li><li><code>rtd</code>：根目录</li><li><code>pd</code>：父目录</li><li><code>mem</code>：内存映射文件</li><li><code>mmap</code>：内存映射设备</li><li><code>txt</code>：程序代码或数据</li><li>...</li></ul></li><li><code>TYPE</code> 列显示该文件的类型： <ul><li><code>DIR</code>：目录</li><li><code>REG</code>：普通文件</li><li><code>PIPE</code>：管道</li><li><code>LINK</code>：符号链接</li><li><code>IPv4</code></li><li><code>IPv6</code></li><li>...</li></ul></li><li><code>DEVICE</code> 列显示设备编号</li><li><code>SIZE/OFF</code> 列获取文件的大小或当前偏移（如果可以获取）</li><li><code>NODE</code> 列显示节点编号（不同类型的文件有不同的含义）</li><li><code>NAME</code> 列显示文件所在的文件系统的挂载点</li></ul><h3 id="按进程号过滤" tabindex="-1"><a class="header-anchor" href="#按进程号过滤"><span>按进程号过滤</span></a></h3><p>使用 <code>-p</code> 参数只显示某个进程打开的文件。比如用 <code>vim</code> 打开一个文件 <code>a.txt</code>，然后在另一个窗口通过 <code>ps</code> 找到这个进程的 pid：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">lsof</span> <span class="token parameter variable">-p</span> <span class="token number">2757806</span></span>
<span class="line">COMMAND     PID <span class="token environment constant">USER</span>   FD   TYPE DEVICE SIZE/OFF   NODE NAME</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  cwd    DIR  <span class="token number">252,2</span>     <span class="token number">4096</span>     <span class="token number">19</span> /root</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  rtd    DIR  <span class="token number">252,2</span>     <span class="token number">4096</span>      <span class="token number">2</span> /</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  txt    REG  <span class="token number">252,2</span>  <span class="token number">2906824</span> <span class="token number">131279</span> /usr/bin/vim.basic</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>    <span class="token number">51856</span> <span class="token number">140272</span> /usr/lib/x86_64-linux-gnu/libnss_files-2.31.so</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>  <span class="token number">3035952</span> <span class="token number">131313</span> /usr/lib/locale/locale-archive</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>    <span class="token number">47064</span> <span class="token number">138541</span> /usr/lib/x86_64-linux-gnu/libogg.so.0.8.4</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>   <span class="token number">182344</span> <span class="token number">138629</span> /usr/lib/x86_64-linux-gnu/libvorbis.so.0.4.8</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>    <span class="token number">14880</span> <span class="token number">140397</span> /usr/lib/x86_64-linux-gnu/libutil-2.31.so</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>   <span class="token number">108936</span> <span class="token number">131566</span> /usr/lib/x86_64-linux-gnu/libz.so.1.2.11</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>   <span class="token number">182560</span> <span class="token number">131219</span> /usr/lib/x86_64-linux-gnu/libexpat.so.1.6.11</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>    <span class="token number">39368</span> <span class="token number">138503</span> /usr/lib/x86_64-linux-gnu/libltdl.so.7.3.1</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>   <span class="token number">100520</span> <span class="token number">138577</span> /usr/lib/x86_64-linux-gnu/libtdb.so.1.4.3</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>    <span class="token number">38904</span> <span class="token number">138630</span> /usr/lib/x86_64-linux-gnu/libvorbisfile.so.3.3.7</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>   <span class="token number">584392</span> <span class="token number">138554</span> /usr/lib/x86_64-linux-gnu/libpcre2-8.so.0.9.0</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>  <span class="token number">2029592</span> <span class="token number">131261</span> /usr/lib/x86_64-linux-gnu/libc-2.31.so</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>   <span class="token number">157224</span> <span class="token number">140375</span> /usr/lib/x86_64-linux-gnu/libpthread-2.31.so</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>  <span class="token number">5449112</span> <span class="token number">132283</span> /usr/lib/x86_64-linux-gnu/libpython3.8.so.1.0</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>    <span class="token number">18848</span> <span class="token number">140219</span> /usr/lib/x86_64-linux-gnu/libdl-2.31.so</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>    <span class="token number">22456</span> <span class="token number">138457</span> /usr/lib/x86_64-linux-gnu/libgpm.so.2</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>    <span class="token number">39088</span> <span class="token number">138376</span> /usr/lib/x86_64-linux-gnu/libacl.so.1.1.2253</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>    <span class="token number">71680</span> <span class="token number">138399</span> /usr/lib/x86_64-linux-gnu/libcanberra.so.0.2.5</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>   <span class="token number">163200</span> <span class="token number">138579</span> /usr/lib/x86_64-linux-gnu/libselinux.so.1</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>   <span class="token number">192032</span> <span class="token number">138600</span> /usr/lib/x86_64-linux-gnu/libtinfo.so.6.2</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>  <span class="token number">1369384</span> <span class="token number">140226</span> /usr/lib/x86_64-linux-gnu/libm-2.31.so</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root  mem    REG  <span class="token number">252,2</span>   <span class="token number">191504</span> <span class="token number">130833</span> /usr/lib/x86_64-linux-gnu/ld-2.31.so</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root    0u   CHR  <span class="token number">136,0</span>      0t0      <span class="token number">3</span> /dev/pts/0</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root    1u   CHR  <span class="token number">136,0</span>      0t0      <span class="token number">3</span> /dev/pts/0</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root    2u   CHR  <span class="token number">136,0</span>      0t0      <span class="token number">3</span> /dev/pts/0</span>
<span class="line"><span class="token function">vim</span>     <span class="token number">2757806</span> root    4u   REG  <span class="token number">252,2</span>    <span class="token number">12288</span>     <span class="token number">52</span> /root/.a.txt.swp</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到 <code>vim</code> 进程打开了：</p><ul><li>当前目录和根目录（应该是继承自 shell）</li><li><code>vim.basic</code> 程序</li><li>一大堆共享库（内存映射）</li><li>在字符设备上打开了三个文件，描述符分别为 0、1、2（标准输入、输出、错误流）</li><li>打开了 <code>.a.txt.swp</code> swap 文件</li></ul><h3 id="按进程名过滤" tabindex="-1"><a class="header-anchor" href="#按进程名过滤"><span>按进程名过滤</span></a></h3><p>使用 <code>-c</code> 参数按 <code>COMMAND</code> 列过滤输出。</p><h3 id="按用户过滤" tabindex="-1"><a class="header-anchor" href="#按用户过滤"><span>按用户过滤</span></a></h3><p>使用 <code>-u</code> 参数按 <code>USER</code> 列过滤输出。</p><h3 id="查看网络连接" tabindex="-1"><a class="header-anchor" href="#查看网络连接"><span>查看网络连接</span></a></h3><p>使用 <code>-i</code> 参数可以查看所有网络连接：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">lsof</span> <span class="token parameter variable">-i</span></span>
<span class="line">COMMAND       PID            <span class="token environment constant">USER</span>   FD   TYPE    DEVICE SIZE/OFF NODE NAME</span>
<span class="line">systemd         <span class="token number">1</span>            root   54u  IPv4     <span class="token number">15244</span>      0t0  TCP *:sunrpc <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></span>
<span class="line">systemd         <span class="token number">1</span>            root   55u  IPv4     <span class="token number">15245</span>      0t0  UDP *:sunrpc</span>
<span class="line">systemd         <span class="token number">1</span>            root   56u  IPv6     <span class="token number">15248</span>      0t0  TCP *:sunrpc <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></span>
<span class="line">systemd         <span class="token number">1</span>            root   57u  IPv6     <span class="token number">15251</span>      0t0  UDP *:sunrpc</span>
<span class="line">rpcbind       <span class="token number">706</span>            _rpc    4u  IPv4     <span class="token number">15244</span>      0t0  TCP *:sunrpc <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></span>
<span class="line">rpcbind       <span class="token number">706</span>            _rpc    5u  IPv4     <span class="token number">15245</span>      0t0  UDP *:sunrpc</span>
<span class="line">rpcbind       <span class="token number">706</span>            _rpc    6u  IPv6     <span class="token number">15248</span>      0t0  TCP *:sunrpc <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></span>
<span class="line">rpcbind       <span class="token number">706</span>            _rpc    7u  IPv6     <span class="token number">15251</span>      0t0  UDP *:sunrpc</span>
<span class="line">systemd-n     <span class="token number">744</span> systemd-network   19u  IPv4     <span class="token number">21626</span>      0t0  UDP nat:bootpc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再加上 <code>tcp</code> / <code>udp</code> 可以查看所有的 TCP / UDP 网络连接：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">lsof</span> <span class="token parameter variable">-i</span> tcp <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-n</span> <span class="token number">1</span></span>
<span class="line">sshd      <span class="token number">2757815</span>            root    4u  IPv4 <span class="token number">190764835</span>      0t0  TCP nat:ssh-<span class="token operator">&gt;</span><span class="token number">112.10</span>.217.238:48291 <span class="token punctuation">(</span>ESTABLISHED<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的端口号被翻译为常用端口名称。可以加一个 <code>:</code> 按端口号或端口范围来过滤：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">lsof</span> <span class="token parameter variable">-i</span> tcp:22</span>
<span class="line">COMMAND     PID <span class="token environment constant">USER</span>   FD   TYPE    DEVICE SIZE/OFF NODE NAME</span>
<span class="line">sshd        <span class="token number">867</span> root    3u  IPv4     <span class="token number">24169</span>      0t0  TCP *:ssh <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></span>
<span class="line">sshd        <span class="token number">867</span> root    4u  IPv6     <span class="token number">24180</span>      0t0  TCP *:ssh <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></span>
<span class="line">sshd    <span class="token number">2757815</span> root    4u  IPv4 <span class="token number">190764835</span>      0t0  TCP nat:ssh-<span class="token operator">&gt;</span><span class="token number">112.10</span>.217.238:48291 <span class="token punctuation">(</span>ESTABLISHED<span class="token punctuation">)</span></span>
<span class="line">sshd    <span class="token number">2761102</span> root    4u  IPv4 <span class="token number">190787885</span>      0t0  TCP nat:ssh-<span class="token operator">&gt;</span><span class="token number">112.5</span>.81.26:32966 <span class="token punctuation">(</span>ESTABLISHED<span class="token punctuation">)</span></span>
<span class="line">sshd    <span class="token number">2761103</span> sshd    4u  IPv4 <span class="token number">190787885</span>      0t0  TCP nat:ssh-<span class="token operator">&gt;</span><span class="token number">112.5</span>.81.26:32966 <span class="token punctuation">(</span>ESTABLISHED<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">$ <span class="token function">lsof</span> <span class="token parameter variable">-i</span> tcp:20-23</span>
<span class="line">COMMAND     PID <span class="token environment constant">USER</span>   FD   TYPE    DEVICE SIZE/OFF NODE NAME</span>
<span class="line">sshd        <span class="token number">867</span> root    3u  IPv4     <span class="token number">24169</span>      0t0  TCP *:ssh <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></span>
<span class="line">sshd        <span class="token number">867</span> root    4u  IPv6     <span class="token number">24180</span>      0t0  TCP *:ssh <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></span>
<span class="line">sshd    <span class="token number">2757815</span> root    4u  IPv4 <span class="token number">190764835</span>      0t0  TCP nat:ssh-<span class="token operator">&gt;</span><span class="token number">112.10</span>.217.238:48291 <span class="token punctuation">(</span>ESTABLISHED<span class="token punctuation">)</span></span>
<span class="line">sshd    <span class="token number">2761187</span> root    4u  IPv4 <span class="token number">190788164</span>      0t0  TCP nat:ssh-<span class="token operator">&gt;</span><span class="token number">138.2</span>.152.212:48566 <span class="token punctuation">(</span>ESTABLISHED<span class="token punctuation">)</span></span>
<span class="line">sshd    <span class="token number">2761188</span> sshd    4u  IPv4 <span class="token number">190788164</span>      0t0  TCP nat:ssh-<span class="token operator">&gt;</span><span class="token number">138.2</span>.152.212:48566 <span class="token punctuation">(</span>ESTABLISHED<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="只显示进程号" tabindex="-1"><a class="header-anchor" href="#只显示进程号"><span>只显示进程号</span></a></h3><p><code>-t</code> 参数可以只输出进程号。这个选项可以和 <code>kill</code> 结合使用。比如说干掉某个用户所有已经打开文件的进程：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token variable"><span class="token variable">\`</span><span class="token function">lsof</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-u</span> xxx<span class="token variable">\`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="周期运行-监控" tabindex="-1"><a class="header-anchor" href="#周期运行-监控"><span>周期运行（监控）</span></a></h3><p>使用 <code>-r</code> 参数可以指定间隔运行的秒数。</p><h2 id="references" tabindex="-1"><a class="header-anchor" href="#references"><span>References</span></a></h2><p><a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/lsof.html" target="_blank" rel="noopener noreferrer">lsof 一切皆文件</a></p><p><a href="https://linux.cn/article-4099-1.html" target="_blank" rel="noopener noreferrer">Linux 命令神器：lsof 入门</a></p><p><a href="https://man7.org/linux/man-pages/man8/lsof.8.html" target="_blank" rel="noopener noreferrer">lsof(8) — Linux manual page</a></p>`,39)]))}const i=n(t,[["render",l],["__file","lsof.html.vue"]]),u=JSON.parse('{"path":"/notes/Linux/lsof.html","title":"lsof","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Background","slug":"background","link":"#background","children":[]},{"level":2,"title":"Usage","slug":"usage","link":"#usage","children":[{"level":3,"title":"按进程号过滤","slug":"按进程号过滤","link":"#按进程号过滤","children":[]},{"level":3,"title":"按进程名过滤","slug":"按进程名过滤","link":"#按进程名过滤","children":[]},{"level":3,"title":"按用户过滤","slug":"按用户过滤","link":"#按用户过滤","children":[]},{"level":3,"title":"查看网络连接","slug":"查看网络连接","link":"#查看网络连接","children":[]},{"level":3,"title":"只显示进程号","slug":"只显示进程号","link":"#只显示进程号","children":[]},{"level":3,"title":"周期运行（监控）","slug":"周期运行-监控","link":"#周期运行-监控","children":[]}]},{"level":2,"title":"References","slug":"references","link":"#references","children":[]}],"git":{},"filePathRelative":"notes/Linux/lsof.md"}');export{i as comp,u as data};
