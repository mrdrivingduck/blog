import{_ as s,c as a,a as p,o as t}from"./app-BeHGwf2X.js";const e="/blog/assets/4-10-C5-xecag.png",o="/blog/assets/4-12-CnjqqjRp.png",c={};function l(i,n){return t(),a("div",null,n[0]||(n[0]=[p(`<h1 id="chapter-4-4-deque" tabindex="-1"><a class="header-anchor" href="#chapter-4-4-deque"><span>Chapter 4.4 - deque</span></a></h1><p>Created by : Mr Dk.</p><p>2021 / 04 / 04 14:33 ğŸ€</p><p>Nanjing, Jiangsu, China</p><hr><h2 id="_4-4-1-deque-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_4-4-1-deque-æ¦‚è¿°"><span>4.4.1 deque æ¦‚è¿°</span></a></h2><p>deque æ˜¯ä¸€ç§ <strong>åŒå‘å¼€å£çš„è¿ç»­çº¿æ€§ç©ºé—´</strong>ã€‚vector å½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¤´å°¾ä¸¤ç«¯è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯å¤´éƒ¨æ“ä½œçš„æ•ˆç‡å¥‡å·®ã€‚è€Œ deque å…è®¸ <strong>åœ¨å¸¸æ•°æ—¶é—´å†…å¯¹å¤´å°¾å…ƒç´ è¿›è¡Œæ’å…¥æˆ–ç§»é™¤</strong>ã€‚å¦å¤–ï¼Œdeque ä¹Ÿæ²¡æœ‰å®¹é‡çš„æ¦‚å¿µï¼Œè€Œæ˜¯ä»¥ <strong>åŠ¨æ€çš„åˆ†æ®µè¿ç»­ç©ºé—´</strong> çš„å½¢å¼ç»„åˆè€Œæˆï¼šéšæ—¶å¯ä»¥å¢åŠ ä¸€æ®µæ–°çš„ç©ºé—´å¹¶é“¾æ¥èµ·æ¥ã€‚å› æ­¤ï¼Œdeque ä¹Ÿæ²¡æœ‰ vector çš„ <code>reserve()</code> åŠŸèƒ½ã€‚</p><p>deque ä¹Ÿèƒ½å¤Ÿæä¾› Random Access Iteratorï¼Œä½†æ˜¯è¿­ä»£å™¨è‚¯å®šä¸æ˜¯ç®€å•çš„æŒ‡é’ˆäº†ã€‚è¿­ä»£å™¨çš„å†…éƒ¨å®ç°å±è”½äº† deque æ„é€ çš„å¤æ‚æ€§ï¼Œä½†æ˜¯åœ¨æ€§èƒ½ä¸Šæ˜¾ç„¶ä¼šé€Šäº vector çš„è¿­ä»£å™¨ã€‚å› æ­¤ï¼Œé™¤éå¿…è¦ï¼Œåº”å½“å°½å¯èƒ½ä¼˜å…ˆä½¿ç”¨ vectorã€‚</p><h2 id="_4-4-2-deque-çš„ä¸­æ§å™¨" tabindex="-1"><a class="header-anchor" href="#_4-4-2-deque-çš„ä¸­æ§å™¨"><span>4.4.2 deque çš„ä¸­æ§å™¨</span></a></h2><p>deque ç”±ä¸€æ®µä¸€æ®µçš„è¿ç»­ç©ºé—´ç»„æˆã€‚è¿™äº›ä¸€æ®µä¸€æ®µçš„è¿ç»­ç©ºé—´æœ¬èº«éœ€è¦ç”±æ•°æ®ç»“æ„æ¥ç»´æŠ¤ã€‚è¿™ä¸ªæ•°æ®ç»“æ„å°±æ˜¯ä¸­æ§å™¨ mapã€‚å½“ deque çš„å‰ç«¯æˆ–åç«¯çš„ç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼Œåˆ™åˆ†é…ä¸€æ®µæ–°çš„è¿ç»­ç©ºé—´ï¼Œå¹¶å°†ç©ºé—´ç»´æŠ¤åœ¨ map ä¸­ã€‚map æœ¬èº«ä¹Ÿæ˜¯ä¸€å°å—è¿ç»­ç©ºé—´ï¼Œå¯è¢«è§†ä¸ºæ˜¯ä¸€ä¸ª <strong>æŒ‡é’ˆæ•°ç»„</strong>ï¼Œé‡Œé¢çš„æ¯ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€æ®µç¼“å†²åŒº - ç¼“å†²åŒºæ‰æ˜¯ deque çš„å­˜å‚¨ä¸»ä½“ã€‚SGI STL å…è®¸ç”¨æˆ·æŒ‡å®šç¼“å†²åŒºå¤§å°ï¼Œæˆ–ä½¿ç”¨é»˜è®¤çš„ 512 bytesã€‚</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">_Deque_base</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line"><span class="token keyword">protected</span><span class="token operator">:</span></span>
<span class="line">  _Tp<span class="token operator">*</span><span class="token operator">*</span> _M_map<span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="`+e+`" alt="4-10" style="zoom:50%;"><p>å½“ map æœ¬èº«ä¸å¤Ÿç”¨æ—¶ï¼Œmap è‡ªå·±éœ€è¦è¢«æ‰©å®¹ï¼Œä»¥ä¾¿å®¹çº³æ›´å¤šæŒ‡å‘ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚</p><h2 id="_4-4-3-deque-çš„è¿­ä»£å™¨" tabindex="-1"><a class="header-anchor" href="#_4-4-3-deque-çš„è¿­ä»£å™¨"><span>4.4.3 deque çš„è¿­ä»£å™¨</span></a></h2><p>ç”±äº deque æ—¶åˆ†æ®µè¿ç»­ç©ºé—´ï¼Œè€Œè¿­ä»£å™¨éœ€è¦å®ç°éšæœºå­˜å–ã€‚å› æ­¤ï¼Œdeque çš„è¿­ä»£å™¨éœ€è¦å°½å…¨åŠ› <strong>ç»´æŒæ•´ä½“è¿ç»­çš„å‡è±¡</strong>ã€‚ç”±è¿­ä»£å™¨çš„ <code>operator++</code> å’Œ <code>operator--</code> ä¸¤ä¸ªè¿ç®—ç¬¦æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚</p><p>deque çš„è¿­ä»£å™¨ä¸ä»…éœ€è¦çŸ¥é“è‡ªå·±å½“å½“å‰ç¼“å†²åŒºä¸­æ˜¯å¦å·²ç»åˆ°è¾¾è¾¹ç¼˜ï¼ŒåŒæ—¶è¿˜éœ€è¦çŸ¥é“è‡ªå·±åœ¨å“ªä¸ªç¼“å†²åŒºä¸­ã€‚å½“è¿­ä»£å™¨å‰è¿›æˆ–åé€€æ—¶ï¼Œå¯èƒ½éœ€è¦åˆ‡æ¢ç¼“å†²åŒºã€‚å› æ­¤è¿­ä»£å™¨çš„å®šä¹‰ä¸­æœ‰å‡ ä¸ªé‡è¦çš„æŒ‡é’ˆï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Ref</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Ptr</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">struct</span> <span class="token class-name">_Deque_iterator</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">typedef</span> _Deque_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span> _Tp<span class="token operator">*</span><span class="token operator">&gt;</span>             iterator<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">typedef</span> _Deque_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">static</span> size_t <span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">typedef</span> random_access_iterator_tag iterator_category<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">typedef</span> _Tp value_type<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">typedef</span> _Ptr pointer<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">typedef</span> _Ref reference<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">typedef</span> size_t size_type<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">typedef</span> ptrdiff_t difference_type<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">typedef</span> _Tp<span class="token operator">*</span><span class="token operator">*</span> _Map_pointer<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">typedef</span> _Deque_iterator _Self<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  _Tp<span class="token operator">*</span> _M_cur<span class="token punctuation">;</span>          <span class="token comment">// å½“å‰ç¼“å†²åŒºä¸­çš„å½“å‰ä½ç½®</span></span>
<span class="line">  _Tp<span class="token operator">*</span> _M_first<span class="token punctuation">;</span>        <span class="token comment">// å½“å‰ç¼“å†²åŒºä¸­çš„å¤´</span></span>
<span class="line">  _Tp<span class="token operator">*</span> _M_last<span class="token punctuation">;</span>         <span class="token comment">// å½“å‰ç¼“å†²åŒºä¸­çš„å°¾ (åŒ…æ‹¬æœªä½¿ç”¨çš„ç©ºé—´åœ¨å†…)</span></span>
<span class="line">  _Map_pointer _M_node<span class="token punctuation">;</span> <span class="token comment">// æŒ‡å‘ map</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>deque ç±»å†…ä¹Ÿç»´æŠ¤ç€ä¸¤ä¸ªé‡è¦çš„è¿­ä»£å™¨ <code>start</code> å’Œ <code>finish</code>ï¼š</p><ul><li><code>start</code> è¿­ä»£å™¨çš„ <code>cur</code> æŒ‡é’ˆæŒ‡å‘ deque å†…ç¬¬ä¸€ä¸ªç¼“å†²åŒºçš„ç¬¬ä¸€ä¸ª (å·²è¢«ä½¿ç”¨) çš„ä½ç½®</li><li><code>finish</code> è¿­ä»£å™¨çš„ <code>cur</code> æŒ‡é’ˆæŒ‡å‘ deque å†…æœ€åä¸€ä¸ªç¼“å†²åŒºçš„æœ€åä¸€ä¸ª (å·²è¢«ä½¿ç”¨) çš„ä½ç½®çš„ä¸‹ä¸€ä¸ªä½ç½®</li></ul><p>è¿™ä¸¤ä¸ªè¿­ä»£å™¨çš„ <code>cur</code> æŒ‡é’ˆæ ‡å®šäº† deque çš„æ•°æ®è®¿é—®èŒƒå›´ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p><img src="`+o+`" alt="4-12" style="zoom:50%;"><p>deque è¿­ä»£å™¨çš„å…³é”®è¡Œä¸ºåœ¨äºå¯¹æ‰€æœ‰è¿ç®—ç¬¦çš„æ­£ç¡®é‡è½½ã€‚å°¤å…¶æ˜¯å½“è¿­ä»£å™¨é‡åˆ°ç¼“å†²åŒºè¾¹ç¼˜æ—¶ï¼Œéœ€è¦è°ƒç”¨ <code>set_node()</code> è·³åˆ°å¦ä¸€ä¸ªç¼“å†²åŒºä¸­ã€‚è¯¥å‡½æ•°è´Ÿè´£é‡æ–°è®¾ç½® <code>cur</code>ã€<code>first</code>ã€<code>last</code> æŒ‡é’ˆï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">  <span class="token keyword">void</span> <span class="token function">_M_set_node</span><span class="token punctuation">(</span>_Map_pointer __new_node<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    _M_node <span class="token operator">=</span> __new_node<span class="token punctuation">;</span></span>
<span class="line">    _M_first <span class="token operator">=</span> <span class="token operator">*</span>__new_node<span class="token punctuation">;</span></span>
<span class="line">    _M_last <span class="token operator">=</span> _M_first <span class="token operator">+</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£å¼•ç”¨è¿ç®—ç¬¦ç›´æ¥ä½¿ç”¨ <code>cur</code> æŒ‡é’ˆï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">reference <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">*</span>_M_cur<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">pointer <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_cur<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>operator-</code> è¿ç®—ç¬¦è®¡ç®—ä¸¤ä¸ªè¿­ä»£å™¨ä¹‹é—´çš„è·ç¦»ã€‚è¿™ä¸ªè·ç¦»åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>ä¸¤ä¸ªè¿­ä»£å™¨ä¹‹é—´çš„å®Œæ•´ç¼“å†²åŒºä¸ªæ•° * ç¼“å†²åŒºå¤§å°</li><li>å½“å‰è¿­ä»£å™¨æ‰€åœ¨ç¼“å†²åŒºä¸­ï¼Œ<code>cur</code> ä¸ <code>first</code> ä¹‹é—´çš„è·ç¦»</li><li>å‚æ•°è¿­ä»£å™¨æ‰€åœ¨ç¼“å†²åŒºä¸­ï¼Œ<code>cur</code> ä¸ <code>last</code> ä¹‹é—´çš„è·ç¦»</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">difference_type <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>_M_node <span class="token operator">-</span> __x<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span></span>
<span class="line">        <span class="token punctuation">(</span>_M_cur <span class="token operator">-</span> _M_first<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>__x<span class="token punctuation">.</span>_M_last <span class="token operator">-</span> __x<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>operator++</code> å’Œ <code>operator--</code> è¿ç®—ç¬¦åœ¨ä¿®æ”¹ <code>cur</code> çš„åŒæ—¶ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦åˆ°è¾¾ç¼“å†²åŒºè¾¹ç•Œï¼š</p><ul><li>å¦‚æœåˆ°è¾¾ç¼“å†²åŒºå‰è¾¹ç•Œï¼Œé‚£ä¹ˆè·³åˆ°å‰ä¸€ä¸ªç¼“å†²åŒºï¼Œå¹¶å°† <code>cur</code> è®¾ç½®ä¸ºç¼“å†²åŒºæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®</li><li>å¦‚æœåˆ°è¾¾ç¼“å†²åŒºåè¾¹ç•Œï¼Œé‚£ä¹ˆè·³åˆ°åä¸€ä¸ªç¼“å†²åŒºï¼Œå¹¶å°† <code>cur</code> è®¾ç½®ä¸ºç¼“å†²åŒºçš„ç¬¬ä¸€ä¸ªå…ƒç´ </li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">_Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">++</span>_M_cur<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>_M_cur <span class="token operator">==</span> _M_last<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        _M_cur <span class="token operator">=</span> _M_first<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">_Self <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span></span>
<span class="line">    _Self __tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">++</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> __tmp<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">_Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>_M_cur <span class="token operator">==</span> _M_first<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        _M_cur <span class="token operator">=</span> _M_last<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">--</span>_M_cur<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">_Self <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    _Self __tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">--</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> __tmp<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>operator+=</code> å’Œ <code>operator-=</code> (é™„å¸¦ <code>operator+</code> å’Œ <code>operator-</code>) å®ç°äº†è¿”å›ä¸€ä¸ªéšæœºè®¿é—®è¿­ä»£å™¨ã€‚å¯¹äºç»™å®šçš„å‚æ•°ï¼Œéœ€è¦é€šè¿‡è®¡ç®—ç¡®å®šå…¶è·¨è¶Šäº†å‡ ä¸ªç¼“å†²åŒºï¼Œç„¶åè®¡ç®—ç¡®å®šåœ¨ç›®æ ‡ç¼“å†²åŒºä¸­ <code>cur</code> çš„æœ€ç»ˆä½ç½®ï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">_Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span>difference_type __n<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    difference_type __offset <span class="token operator">=</span> __n <span class="token operator">+</span> <span class="token punctuation">(</span>_M_cur <span class="token operator">-</span> _M_first<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>__offset <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> __offset <span class="token operator">&lt;</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        _M_cur <span class="token operator">+=</span> __n<span class="token punctuation">;</span> <span class="token comment">// ä¸è¶…å‡ºå½“å‰ç¼“å†²åŒº</span></span>
<span class="line">    <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        difference_type __node_offset <span class="token operator">=</span></span>
<span class="line">            __offset <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> __offset <span class="token operator">/</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">:</span> <span class="token operator">-</span><span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span>__offset <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_node <span class="token operator">+</span> __node_offset<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ‡æ¢ç¼“å†²åŒº</span></span>
<span class="line">        _M_cur <span class="token operator">=</span> _M_first <span class="token operator">+</span>  <span class="token comment">// ç¡®å®š cur æŒ‡é’ˆçš„æœ€ç»ˆä½ç½®</span></span>
<span class="line">            <span class="token punctuation">(</span>__offset <span class="token operator">-</span> __node_offset <span class="token operator">*</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">_Self <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span>difference_type __n<span class="token punctuation">)</span> <span class="token keyword">const</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    _Self __tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> __tmp <span class="token operator">+=</span> __n<span class="token punctuation">;</span> <span class="token comment">// å€Ÿç”¨ += çš„å®ç°</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">_Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">-=</span><span class="token punctuation">(</span>difference_type __n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">+=</span> <span class="token operator">-</span>__n<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// å€Ÿç”¨ += çš„å®ç°</span></span>
<span class="line"></span>
<span class="line">_Self <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span>difference_type __n<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span></span>
<span class="line">    _Self __tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> __tmp <span class="token operator">-=</span> __n<span class="token punctuation">;</span> <span class="token comment">// å€Ÿç”¨ -= çš„å®ç°</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>operator[]</code> å¯ä»¥å®ç°å…ƒç´ çš„éšæœºè®¿é—®ï¼Œå†…éƒ¨å®é™…ä¸Šå€Ÿç”¨äº† <code>operator+</code> çš„å®ç°ï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">reference <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>difference_type __n<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">+</span> __n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ‰€æœ‰çš„è¿­ä»£å™¨æ¯”è¾ƒæ“ä½œéƒ½å–å†³äºï¼š</p><ol><li>æ‰€å±ç¼“å†²åŒº</li><li>æ‰€å±ç¼“å†²åŒºç›¸åŒçš„å‰æä¸‹ï¼Œ<code>cur</code> æŒ‡é’ˆçš„ä½ç½®</li></ol><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_cur <span class="token operator">==</span> __x<span class="token punctuation">.</span>_M_cur<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">==</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>_M_node <span class="token operator">==</span> __x<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span> <span class="token operator">?</span></span>
<span class="line">        <span class="token punctuation">(</span>_M_cur <span class="token operator">&lt;</span> __x<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token generic-function"><span class="token function">_M_node</span> <span class="token generic class-name"><span class="token operator">&lt;</span> __x<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token keyword">const</span>  <span class="token punctuation">{</span> <span class="token keyword">return</span> __x <span class="token operator">&lt;</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&lt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span>__x <span class="token operator">&lt;</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&gt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">&lt;</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-4-4-deque-çš„æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_4-4-4-deque-çš„æ•°æ®ç»“æ„"><span>4.4.4 deque çš„æ•°æ®ç»“æ„</span></a></h2><p>deque æœ€é‡è¦çš„æˆå‘˜å˜é‡æ˜¯ä¸€ä¸ªæŒ‡å‘ map çš„æŒ‡é’ˆï¼Œä»¥åŠåˆšæ‰æåˆ°çš„ <code>start</code> å’Œ <code>finish</code> ä¸¤ä¸ªè¿­ä»£å™¨ã€‚å¦å¤–ï¼Œå°†é»˜è®¤çš„ <code>alloc</code> åˆ†é…å™¨å°è£…ä¸ºä¸¤ä¸ªåˆ†é…å™¨ï¼Œä¸€ä¸ªä»¥ç¼“å†²åŒºå¤§å°ä¸ºå•ä½åˆ†é…å†…å­˜ (ç”¨äºåˆ†é…æ–°çš„ç¼“å†²åŒº)ï¼Œä¸€ä¸ªä»¥ç¼“å†²åŒºæŒ‡é’ˆçš„å¤§å°ä¸ºå•ä½åˆ†é…å†…å­˜ (ç”¨äºåˆ†é…æ–°çš„ map ä»¥æ‰©å®¹)ï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">_Deque_base</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">  <span class="token keyword">typedef</span> _Deque_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span>_Tp<span class="token operator">*</span><span class="token operator">&gt;</span>             iterator<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">typedef</span> _Deque_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span><span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span><span class="token keyword">const</span> _Tp<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">typedef</span> _Alloc allocator_type<span class="token punctuation">;</span></span>
<span class="line">  allocator_type <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">allocator_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">_Deque_base</span><span class="token punctuation">(</span><span class="token keyword">const</span> allocator_type<span class="token operator">&amp;</span><span class="token punctuation">,</span> size_t __num_elements<span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">:</span> <span class="token function">_M_map</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_M_map_size</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">_M_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_M_finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">_M_initialize_map</span><span class="token punctuation">(</span>__num_elements<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">_Deque_base</span><span class="token punctuation">(</span><span class="token keyword">const</span> allocator_type<span class="token operator">&amp;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">:</span> <span class="token function">_M_map</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_M_map_size</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">_M_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_M_finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token operator">~</span><span class="token function">_Deque_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">protected</span><span class="token operator">:</span></span>
<span class="line">  <span class="token keyword">void</span> <span class="token function">_M_initialize_map</span><span class="token punctuation">(</span>size_t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">void</span> <span class="token function">_M_create_nodes</span><span class="token punctuation">(</span>_Tp<span class="token operator">*</span><span class="token operator">*</span> __nstart<span class="token punctuation">,</span> _Tp<span class="token operator">*</span><span class="token operator">*</span> __nfinish<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">void</span> <span class="token function">_M_destroy_nodes</span><span class="token punctuation">(</span>_Tp<span class="token operator">*</span><span class="token operator">*</span> __nstart<span class="token punctuation">,</span> _Tp<span class="token operator">*</span><span class="token operator">*</span> __nfinish<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">enum</span> <span class="token punctuation">{</span> _S_initial_map_size <span class="token operator">=</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">protected</span><span class="token operator">:</span></span>
<span class="line">  _Tp<span class="token operator">*</span><span class="token operator">*</span> _M_map<span class="token punctuation">;</span>       <span class="token comment">// æŒ‡å‘ map</span></span>
<span class="line">  size_t _M_map_size<span class="token punctuation">;</span> <span class="token comment">// map çš„å¤§å°</span></span>
<span class="line">  iterator _M_start<span class="token punctuation">;</span>  <span class="token comment">// start è¿­ä»£å™¨</span></span>
<span class="line">  iterator _M_finish<span class="token punctuation">;</span> <span class="token comment">// finish è¿­ä»£å™¨</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">typedef</span> simple_alloc<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">&gt;</span>  _Node_alloc_type<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">typedef</span> simple_alloc<span class="token operator">&lt;</span>_Tp<span class="token operator">*</span><span class="token punctuation">,</span> _Alloc<span class="token operator">&gt;</span> _Map_alloc_type<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  _Tp<span class="token operator">*</span> <span class="token function">_M_allocate_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token keyword">return</span> _Node_alloc_type<span class="token double-colon punctuation">::</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token function">__deque_buf_size</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">void</span> <span class="token function">_M_deallocate_node</span><span class="token punctuation">(</span>_Tp<span class="token operator">*</span> __p<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span> _Node_alloc_type<span class="token double-colon punctuation">::</span><span class="token function">deallocate</span><span class="token punctuation">(</span>__p<span class="token punctuation">,</span> <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">  _Tp<span class="token operator">*</span><span class="token operator">*</span> <span class="token function">_M_allocate_map</span><span class="token punctuation">(</span>size_t __n<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token keyword">return</span> _Map_alloc_type<span class="token double-colon punctuation">::</span><span class="token function">allocate</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">void</span> <span class="token function">_M_deallocate_map</span><span class="token punctuation">(</span>_Tp<span class="token operator">*</span><span class="token operator">*</span> __p<span class="token punctuation">,</span> size_t __n<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span> _Map_alloc_type<span class="token double-colon punctuation">::</span><span class="token function">deallocate</span><span class="token punctuation">(</span>__p<span class="token punctuation">,</span> __n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰äº† <code>start</code> å’Œ <code>finish</code> è¿­ä»£å™¨ï¼Œä»¥åŠè¿­ä»£å™¨é‡è½½çš„æ‰€æœ‰è¿ç®—ç¬¦ï¼Œå¯ä»¥è½»æ¾å®ç°ä»¥ä¸‹æˆå‘˜å‡½æ•°ï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_start<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_finish<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_start<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_finish<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">reference <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_type __n<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_start<span class="token punctuation">[</span><span class="token function">difference_type</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// ä»ç¬¬ä¸€ä¸ªæœ‰æ•ˆå…ƒç´ å¼€å§‹éšæœºè®¿é—®</span></span>
<span class="line">const_reference <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_type __n<span class="token punctuation">)</span> <span class="token keyword">const</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_start<span class="token punctuation">[</span><span class="token function">difference_type</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">reference <span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">*</span>_M_start<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">reference <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    iterator __tmp <span class="token operator">=</span> _M_finish<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">--</span>__tmp<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token operator">*</span>__tmp<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">const_reference <span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">*</span>_M_start<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">const_reference <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span></span>
<span class="line">    const_iterator __tmp <span class="token operator">=</span> _M_finish<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">--</span>__tmp<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token operator">*</span>__tmp<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">size_type <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_finish <span class="token operator">-</span> _M_start<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">size_type <span class="token function">max_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">size_type</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">bool</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _M_finish <span class="token operator">==</span> _M_start<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-4-5-deque-çš„æ„é€ ä¸å†…å­˜ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_4-4-5-deque-çš„æ„é€ ä¸å†…å­˜ç®¡ç†"><span>4.4.5 deque çš„æ„é€ ä¸å†…å­˜ç®¡ç†</span></a></h2><p>deque æœ¬èº«æœ€å¤æ‚çš„åœ°æ–¹åœ¨äºæ’å…¥å’Œåˆ é™¤æ—¶é€ æˆçš„ç¼“å†²åŒºåˆ†é…ä¸å›æ”¶ï¼›å¦å¤–ï¼Œå½“ map æœ¬èº«ä¸å¤Ÿç”¨æ—¶ï¼Œåˆç‰µæ‰¯åˆ° map çš„é‡æ–°åˆ†é…ä¸é‡Šæ”¾ã€‚</p><p>deque çš„æ„é€ å‡½æ•°æ”¯æŒç”¨æˆ·è®¾å®šç¼“å†²åŒºä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œä½†æ˜¯æ˜¾å¼å£°æ˜æ„å‘³ç€è¦æŠŠä¹‹å‰çš„ç¼ºçœå‚æ•°è¡¥é½ã€‚å¦å¤–ï¼Œè¿˜æ”¯æŒä¿ç•™æŒ‡å®šä¸ªæ•°çš„å…ƒç´ ç©ºé—´ã€‚</p><blockquote><p>ï¼Ÿå’‹æ²¡æœ‰ç¬¬ä¸‰ä¸ªæ¨¡æ¿å‚æ•°</p></blockquote><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span> <span class="token operator">=</span> <span class="token function">__STL_DEFAULT_ALLOCATOR</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span> <span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">deque</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">protected</span> <span class="token class-name">_Deque_base</span><span class="token operator">&lt;</span><span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæ ¹æ®è¦ä¿ç•™çš„å…ƒç´ ä¸ªæ•°ï¼Œå†³å®šå¦‚ä½•å¯¹ map è¿›è¡Œåˆå§‹åŒ–ï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token function">_Deque_base</span><span class="token punctuation">(</span><span class="token keyword">const</span> allocator_type<span class="token operator">&amp;</span><span class="token punctuation">,</span> size_t __num_elements<span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">:</span> <span class="token function">_M_map</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_M_map_size</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">_M_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_M_finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">_M_initialize_map</span><span class="token punctuation">(</span>__num_elements<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨ <code>initialize_map()</code> æ¥æ„é€  mapï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">void</span></span>
<span class="line"><span class="token class-name">_Deque_base</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">_M_initialize_map</span><span class="token punctuation">(</span>size_t __num_elements<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  size_t __num_nodes <span class="token operator">=</span></span>
<span class="line">    __num_elements <span class="token operator">/</span> <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// å®¹çº³æŒ‡å®šå…ƒç´ éœ€è¦çš„ç¼“å†²åŒºä¸ªæ•°</span></span>
<span class="line"></span>
<span class="line">  _M_map_size <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">(</span>size_t<span class="token punctuation">)</span> _S_initial_map_size<span class="token punctuation">,</span> __num_nodes <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// map å†…å‰åå„é¢„ç•™ä¸€ä¸ªç©ºæŒ‡é’ˆå¤‡ç”¨</span></span>
<span class="line">  <span class="token comment">// enum { _S_initial_map_size = 8 };</span></span>
<span class="line">  <span class="token comment">// æœ€å°‘è¦æœ‰ 8 ä¸ªç¼“å†²åŒºæŒ‡é’ˆçš„ç©ºé—´</span></span>
<span class="line"></span>
<span class="line">  _M_map <span class="token operator">=</span> <span class="token function">_M_allocate_map</span><span class="token punctuation">(</span>_M_map_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ†é… map å†…å­˜</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// ä» map çš„ä¸­é—´å¼€å§‹å¯ç”¨ (å‰åç•™ç©º)</span></span>
<span class="line">  _Tp<span class="token operator">*</span><span class="token operator">*</span> __nstart <span class="token operator">=</span> _M_map <span class="token operator">+</span> <span class="token punctuation">(</span>_M_map_size <span class="token operator">-</span> __num_nodes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">  _Tp<span class="token operator">*</span><span class="token operator">*</span> __nfinish <span class="token operator">=</span> __nstart <span class="token operator">+</span> __num_nodes<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  __STL_TRY <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">_M_create_nodes</span><span class="token punctuation">(</span>__nstart<span class="token punctuation">,</span> __nfinish<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¾æ¬¡åˆ›å»ºæ¯ä¸€ä¸ªç¼“å†²åŒº</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">__STL_UNWIND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">_M_deallocate_map</span><span class="token punctuation">(</span>_M_map<span class="token punctuation">,</span> _M_map_size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å¤±è´¥æ—¶å›æ»šæ‰€æœ‰å·²åˆ›å»ºç¼“å†²åŒº</span></span>
<span class="line">                _M_map <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> _M_map_size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// è®¾ç½® start å’Œ finish è¿­ä»£å™¨æ‰€åœ¨çš„ç»“ç‚¹å’Œ cur æŒ‡é’ˆ</span></span>
<span class="line">  _M_start<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>__nstart<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  _M_finish<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>__nfinish <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  _M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> _M_start<span class="token punctuation">.</span>_M_first<span class="token punctuation">;</span></span>
<span class="line">  _M_finish<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> _M_finish<span class="token punctuation">.</span>_M_first <span class="token operator">+</span></span>
<span class="line">               __num_elements <span class="token operator">%</span> <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token class-name">_Deque_base</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">_M_create_nodes</span><span class="token punctuation">(</span>_Tp<span class="token operator">*</span><span class="token operator">*</span> __nstart<span class="token punctuation">,</span> _Tp<span class="token operator">*</span><span class="token operator">*</span> __nfinish<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  _Tp<span class="token operator">*</span><span class="token operator">*</span> __cur<span class="token punctuation">;</span></span>
<span class="line">  __STL_TRY <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span>__cur <span class="token operator">=</span> __nstart<span class="token punctuation">;</span> __cur <span class="token operator">&lt;</span> __nfinish<span class="token punctuation">;</span> <span class="token operator">++</span>__cur<span class="token punctuation">)</span></span>
<span class="line">      <span class="token operator">*</span>__cur <span class="token operator">=</span> <span class="token function">_M_allocate_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">__STL_UNWIND</span><span class="token punctuation">(</span><span class="token function">_M_destroy_nodes</span><span class="token punctuation">(</span>__nstart<span class="token punctuation">,</span> __cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ <code>push_back()</code> ä¸ºä¾‹ã€‚å¦‚æœ <code>finish</code> è¿­ä»£å™¨æŒ‡å‘çš„ç¼“å†²åŒº (æœ€åä¸€ä¸ªç¼“å†²åŒº) ä¸­è¿˜æœ‰ä¸¤ä¸ªä»¥ä¸Šçš„å¤‡ç”¨ç©ºé—´ï¼Œé‚£ä¹ˆç›´æ¥åœ¨å¤‡ç”¨ç©ºé—´ä¸Šæ„é€ å…ƒç´ å³å¯ï¼›å¦‚æœåªå‰©ä¸€ä¸ªå¤‡ç”¨ç©ºé—´äº†ï¼Œé‚£ä¹ˆåœ¨æ„é€ å…ƒç´ åï¼Œè¿˜éœ€è¦åˆ†é…æ–°çš„ç¼“å†²åŒºï¼Œå¹¶æŠŠ <code>finish</code> è¿­ä»£å™¨åˆ‡æ¢åˆ°æ–°çš„ç¼“å†²åŒºä¸Šã€‚<code>push_front()</code> çš„æ€è·¯ä¹Ÿç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯æ¢äº†ä¸ªæ–¹å‘ã€‚</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">void</span> <span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __t<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_cur <span class="token operator">!=</span> _M_finish<span class="token punctuation">.</span>_M_last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">construct</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">,</span> __t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token operator">++</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">        <span class="token function">_M_push_back_aux</span><span class="token punctuation">(</span>__t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">push_front</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __t<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">!=</span> _M_start<span class="token punctuation">.</span>_M_first<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">construct</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> __t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token operator">--</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">        <span class="token function">_M_push_front_aux</span><span class="token punctuation">(</span>__t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Called only if _M_finish._M_cur == _M_finish._M_last - 1.</span></span>
<span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">_M_push_back_aux</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __t<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  value_type __t_copy <span class="token operator">=</span> __t<span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">_M_reserve_map_at_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¡®ä¿ map çš„åç«¯æœ‰ç©ºé—²çš„æŒ‡é’ˆç”¨äºåˆ†é…ç¼“å†²åŒº</span></span>
<span class="line">  <span class="token operator">*</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">_M_allocate_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ†é…ç¼“å†²åŒº</span></span>
<span class="line">  __STL_TRY <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">construct</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">,</span> __t_copy<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨ finish è¿­ä»£å™¨çš„ cur æŒ‡é’ˆæ‰€åœ¨ä½ç½®æ„é€ å…ƒç´ </span></span>
<span class="line">    _M_finish<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ‡æ¢ finish è¿­ä»£å™¨åˆ°æ–°åˆ†é…çš„ç¼“å†²åŒº</span></span>
<span class="line">    _M_finish<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> _M_finish<span class="token punctuation">.</span>_M_first<span class="token punctuation">;</span> <span class="token comment">// finish è¿­ä»£å™¨çš„ cur æŒ‡é’ˆæŒ‡å‘æ–°ç¼“å†²åŒºçš„ç¬¬ä¸€ä¸ªä½ç½®</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">__STL_UNWIND</span><span class="token punctuation">(</span><span class="token function">_M_deallocate_node</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å›æ»š</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Called only if _M_start._M_cur == _M_start._M_first.</span></span>
<span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">void</span>  <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">_M_push_front_aux</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __t<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  value_type __t_copy <span class="token operator">=</span> __t<span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">_M_reserve_map_at_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token operator">*</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">_M_allocate_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  __STL_TRY <span class="token punctuation">{</span></span>
<span class="line">    _M_start<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    _M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> _M_start<span class="token punctuation">.</span>_M_last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">construct</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">,</span> __t_copy<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">__STL_UNWIND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">++</span>_M_start<span class="token punctuation">,</span> <span class="token function">_M_deallocate_node</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå¼•å‡ºäº†é—®é¢˜ï¼šå¦‚æœ map ä¸­çš„ç©ºé—´ä¸å¤Ÿç”¨äº†æ€ä¹ˆåŠï¼Ÿä¸å¦¨çœ‹çœ‹ <code>reserve_map_at_back()</code> å’Œ <code>reserve_map_at_front()</code> æ˜¯æ€ä¹ˆå¹²çš„ã€‚è¿™ä¸¤ä¸ªå‡½æ•°ä¸è´Ÿè´£åˆ†é…ç¼“å†²åŒºï¼Œåªè´Ÿè´£é‡æ–°åˆ†é…ä¸€ä¸ªæ›´å¤§çš„ mapï¼Œå¹¶å°†åŸæ¥ map ä¸­çš„ç¼“å†²åŒºæŒ‡é’ˆæ¬è¿åˆ°æ–°çš„ map ä¸­ï¼Œå¹¶ææ„é‡Šæ”¾åŸæ¥çš„ mapã€‚</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token comment">// Makes sure the _M_map has space for new nodes.  Does not actually</span></span>
<span class="line"><span class="token comment">//  add the nodes.  Can invalidate _M_map pointers.  (And consequently,</span></span>
<span class="line"><span class="token comment">//  deque iterators.)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">_M_reserve_map_at_back</span> <span class="token punctuation">(</span>size_type __nodes_to_add <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>__nodes_to_add <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;</span> _M_map_size <span class="token operator">-</span> <span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> _M_map<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">_M_reallocate_map</span><span class="token punctuation">(</span>__nodes_to_add<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">_M_reserve_map_at_front</span> <span class="token punctuation">(</span>size_type __nodes_to_add <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>__nodes_to_add <span class="token operator">&gt;</span> <span class="token function">size_type</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> _M_map<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">_M_reallocate_map</span><span class="token punctuation">(</span>__nodes_to_add<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œå®Œæˆæ ¸å¿ƒåŠŸèƒ½çš„æ˜¯ <code>reallocate_map()</code> å‡½æ•°ï¼Œé€šè¿‡å‚æ•°æ¥å†³å®šå‘å‰æ‰©å®¹è¿˜æ˜¯å‘åæ‰©å®¹ï¼š</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">_M_reallocate_map</span><span class="token punctuation">(</span>size_type __nodes_to_add<span class="token punctuation">,</span></span>
<span class="line">                                          <span class="token keyword">bool</span> __add_at_front<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  size_type __old_num_nodes <span class="token operator">=</span> _M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> _M_start<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// map å†…åŸæœ‰æŒ‡é’ˆæ•°</span></span>
<span class="line">  size_type __new_num_nodes <span class="token operator">=</span> __old_num_nodes <span class="token operator">+</span> __nodes_to_add<span class="token punctuation">;</span> <span class="token comment">// åŸæœ‰æŒ‡é’ˆæ•° + 1 (ç¼ºçœå€¼)</span></span>
<span class="line"></span>
<span class="line">  _Map_pointer __new_nstart<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>_M_map_size <span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">*</span> __new_num_nodes<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ä¸éœ€é‡æ–°åˆ†é…ï¼Œå‰åä¸å‡ç½¢äº†ï¼Œå°†æœ‰æ•ˆæŒ‡é’ˆæ¬è¿åˆ° map ä¸­é—´</span></span>
<span class="line">    __new_nstart <span class="token operator">=</span> _M_map <span class="token operator">+</span> <span class="token punctuation">(</span>_M_map_size <span class="token operator">-</span> __new_num_nodes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span></span>
<span class="line">                     <span class="token operator">+</span> <span class="token punctuation">(</span>__add_at_front <span class="token operator">?</span> __nodes_to_add <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>__new_nstart <span class="token operator">&lt;</span> _M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span></span>
<span class="line">      <span class="token function">copy</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">,</span> _M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> __new_nstart<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">      <span class="token function">copy_backward</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">,</span> _M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">                    __new_nstart <span class="token operator">+</span> __old_num_nodes<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// éœ€è¦é‡æ–°åˆ†é… map</span></span>
<span class="line">    size_type __new_map_size <span class="token operator">=</span></span>
<span class="line">      _M_map_size <span class="token operator">+</span> <span class="token function">max</span><span class="token punctuation">(</span>_M_map_size<span class="token punctuation">,</span> __nodes_to_add<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// æ–°çš„ map å¤§å°</span></span>
<span class="line"></span>
<span class="line">    _Map_pointer __new_map <span class="token operator">=</span> <span class="token function">_M_allocate_map</span><span class="token punctuation">(</span>__new_map_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ†é…</span></span>
<span class="line">    __new_nstart <span class="token operator">=</span> __new_map <span class="token operator">+</span> <span class="token punctuation">(</span>__new_map_size <span class="token operator">-</span> __new_num_nodes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span></span>
<span class="line">                         <span class="token operator">+</span> <span class="token punctuation">(</span>__add_at_front <span class="token operator">?</span> __nodes_to_add <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">copy</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">,</span> _M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> __new_nstart<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†åŸæœ‰æ•ˆæŒ‡é’ˆæ¬è¿åˆ° map ä¸­é—´</span></span>
<span class="line">    <span class="token function">_M_deallocate_map</span><span class="token punctuation">(</span>_M_map<span class="token punctuation">,</span> _M_map_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é‡Šæ”¾åŸæ¥çš„ map</span></span>
<span class="line"></span>
<span class="line">    _M_map <span class="token operator">=</span> __new_map<span class="token punctuation">;</span> <span class="token comment">// æ›´æ”¹ map æŒ‡é’ˆä¸å¤§å°</span></span>
<span class="line">    _M_map_size <span class="token operator">=</span> __new_map_size<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// é‡æ–°è®¾ç½® start å’Œ finish è¿­ä»£å™¨</span></span>
<span class="line">  _M_start<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>__new_nstart<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  _M_finish<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>__new_nstart <span class="token operator">+</span> __old_num_nodes <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-4-6-deque-çš„å…ƒç´ æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_4-4-6-deque-çš„å…ƒç´ æ“ä½œ"><span>4.4.6 deque çš„å…ƒç´ æ“ä½œ</span></a></h2><p><code>pop</code> æ“ä½œéœ€è¦åˆ¤æ–­è¢«åˆ é™¤çš„å…ƒç´ æ˜¯å¦æ˜¯å½“å‰ç¼“å†²åŒºä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼š</p><ul><li>å¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥ææ„å…ƒç´ ï¼Œå¹¶è°ƒæ•´ <code>cur</code> æŒ‡é’ˆ</li><li>å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆåˆ‡æ¢ç¼“å†²åŒºï¼Œé‡æ–°è°ƒæ•´ <code>cur</code> æŒ‡é’ˆï¼Œé”€æ¯å…ƒç´ ï¼Œæ­¤å¤–è¿˜éœ€è¦é‡Šæ”¾ç¼“å†²åŒº</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">void</span> <span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_cur <span class="token operator">!=</span> _M_finish<span class="token punctuation">.</span>_M_first<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">--</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">destroy</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›´æ¥ææ„</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">        <span class="token function">_M_pop_back_aux</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éœ€è¦é‡Šæ”¾ç¼“å†²åŒº</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">!=</span> _M_start<span class="token punctuation">.</span>_M_last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">destroy</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›´æ¥ææ„</span></span>
<span class="line">        <span class="token operator">++</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">        <span class="token function">_M_pop_front_aux</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éœ€è¦é‡Šæ”¾ç¼“å†²åŒº</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Called only if _M_finish._M_cur == _M_finish._M_first.</span></span>
<span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">_M_pop_back_aux</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">_M_deallocate_node</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_first<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é‡Šæ”¾ç¼“å†²åŒº</span></span>
<span class="line">  _M_finish<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ‡æ¢ç¼“å†²åŒº</span></span>
<span class="line">  _M_finish<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> _M_finish<span class="token punctuation">.</span>_M_last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">destroy</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ææ„å…ƒç´ </span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Called only if _M_start._M_cur == _M_start._M_last - 1.  Note that</span></span>
<span class="line"><span class="token comment">// if the deque has at least one element (a precondition for this member</span></span>
<span class="line"><span class="token comment">// function), and if _M_start._M_cur == _M_start._M_last, then the deque</span></span>
<span class="line"><span class="token comment">// must have at least two nodes.</span></span>
<span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">_M_pop_front_aux</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">destroy</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">_M_deallocate_node</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_first<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  _M_start<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  _M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> _M_start<span class="token punctuation">.</span>_M_first<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>clear()</code> æ¸…é™¤æ•´ä¸ª dequeã€‚deque åœ¨æœ€åˆçŠ¶æ€ (æ— ä»»ä½•å…ƒç´ ) æ—¶ä¿æœ‰ä¸€ä¸ªç¼“å†²åŒºã€‚</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span>_Map_pointer __node <span class="token operator">=</span> _M_start<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">       __node <span class="token operator">&lt;</span> _M_finish<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span> <span class="token comment">// é‡Šæ”¾é™¤å¤´å°¾ç¼“å†²åŒºä»¥å¤–çš„ç¼“å†²åŒº</span></span>
<span class="line">       <span class="token operator">++</span>__node<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token operator">*</span>__node<span class="token punctuation">,</span> <span class="token operator">*</span>__node <span class="token operator">+</span> <span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">_M_deallocate_node</span><span class="token punctuation">(</span><span class="token operator">*</span>__node<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_node <span class="token operator">!=</span> _M_finish<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¤´å°¾ç¼“å†²åŒºä¸æ˜¯åŒä¸€ä¸ª</span></span>
<span class="line">    <span class="token function">destroy</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">,</span> _M_start<span class="token punctuation">.</span>_M_last<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ææ„å¤´ç¼“å†²åŒºå†…æ‰€æœ‰å…ƒç´ </span></span>
<span class="line">    <span class="token function">destroy</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_first<span class="token punctuation">,</span> _M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ææ„å°¾ç¼“å†²åŒºå†…æ‰€æœ‰å…ƒç´ </span></span>
<span class="line">    <span class="token function">_M_deallocate_node</span><span class="token punctuation">(</span>_M_finish<span class="token punctuation">.</span>_M_first<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é‡Šæ”¾å°¾ç¼“å†²åŒº (ä¿ç•™å¤´ç¼“å†²åŒº)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">else</span> <span class="token comment">// å¤´å°¾ç¼“å†²åŒºæ˜¯åŒä¸€ä¸ªç¼“å†²åŒº</span></span>
<span class="line">    <span class="token function">destroy</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">,</span> _M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ææ„æ‰€æœ‰å…ƒç´  (ä½†ä¸é‡Šæ”¾ç¼“å†²åŒº)</span></span>
<span class="line"></span>
<span class="line">  _M_finish <span class="token operator">=</span> _M_start<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>erase()</code> æ¸…é™¤æŸä¸€ä¸ªæˆ–æŸä¸ªåŒºé—´å†…çš„å…ƒç´ ã€‚æ¸…é™¤å•ä¸ªå…ƒç´ æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­æ¸…æ¥šä½ç½®ä¹‹å‰ä¸ä¹‹åçš„å…ƒç´ å“ªè¾¹æ›´å¤šï¼Œç§»åŠ¨è¾ƒå°‘é‚£ä¸€ç«¯çš„å…ƒç´ ä»¥å‡å°æ¬è¿ä»£ä»·ã€‚ç§»åŠ¨å®Œæ¯•åï¼Œè°ƒç”¨ <code>pop_back()</code> æˆ– <code>pop_front()</code> ç§»é™¤è¾¹ç•Œå†—ä½™çš„å…ƒç´  (è¿™ä¸¤ä¸ªå‡½æ•°è¿˜ä¼šè‡ªåŠ¨é‡Šæ”¾å†—ä½™ç¼“å†²åŒº)ã€‚</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">iterator <span class="token function">erase</span><span class="token punctuation">(</span>iterator __pos<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    iterator __next <span class="token operator">=</span> __pos<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">++</span>__next<span class="token punctuation">;</span></span>
<span class="line">    difference_type __index <span class="token operator">=</span> __pos <span class="token operator">-</span> _M_start<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">size_type</span><span class="token punctuation">(</span>__index<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">copy_backward</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">,</span> __pos<span class="token punctuation">,</span> __next<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">copy</span><span class="token punctuation">(</span>__next<span class="token punctuation">,</span> _M_finish<span class="token punctuation">,</span> __pos<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> _M_start <span class="token operator">+</span> __index<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦ç§»é™¤çš„æ˜¯ä¸€ä¸ªåŒºé—´ï¼ŒåŒæ ·éœ€è¦åˆ¤æ–­åŒºé—´ä¹‹å‰ä¸åŒºé—´ä¹‹åçš„å…ƒç´ å“ªè¾¹æ›´å¤šï¼Œç§»åŠ¨å‰©ä½™å…ƒç´ è¾ƒå°‘çš„é‚£ä¸€ç«¯ã€‚æ¬è¿å®Œæ¯•åï¼Œå°†å†—ä½™çš„å…ƒç´ å…¨éƒ¨åˆ é™¤ï¼Œå¹¶é‡Šæ”¾å·²ç»å†—ä½™çš„ç¼“å†²åŒºã€‚</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">typename</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator</span>
<span class="line"><span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">erase</span><span class="token punctuation">(</span>iterator __first<span class="token punctuation">,</span> iterator __last<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">==</span> _M_start <span class="token operator">&amp;&amp;</span> __last <span class="token operator">==</span> _M_finish<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> _M_finish<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    difference_type __n <span class="token operator">=</span> __last <span class="token operator">-</span> __first<span class="token punctuation">;</span></span>
<span class="line">    difference_type __elems_before <span class="token operator">=</span> __first <span class="token operator">-</span> _M_start<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>__elems_before <span class="token operator">&lt;</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> __n<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">copy_backward</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">,</span> __first<span class="token punctuation">,</span> __last<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      iterator __new_start <span class="token operator">=</span> _M_start <span class="token operator">+</span> __n<span class="token punctuation">;</span></span>
<span class="line">      <span class="token function">destroy</span><span class="token punctuation">(</span>_M_start<span class="token punctuation">,</span> __new_start<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token function">_M_destroy_nodes</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">,</span> _M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      _M_start <span class="token operator">=</span> __new_start<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">copy</span><span class="token punctuation">(</span>__last<span class="token punctuation">,</span> _M_finish<span class="token punctuation">,</span> __first<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      iterator __new_finish <span class="token operator">=</span> _M_finish <span class="token operator">-</span> __n<span class="token punctuation">;</span></span>
<span class="line">      <span class="token function">destroy</span><span class="token punctuation">(</span>__new_finish<span class="token punctuation">,</span> _M_finish<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token function">_M_destroy_nodes</span><span class="token punctuation">(</span>__new_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> _M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      _M_finish <span class="token operator">=</span> __new_finish<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> _M_start <span class="token operator">+</span> __elems_before<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>insert()</code> åœ¨æŸä¸ªä½ç½® (ä¹‹å‰) æ’å…¥å…ƒç´ ã€‚é¦–å…ˆåˆ¤æ–­æ’å…¥ä½ç½®æ˜¯å¦åœ¨å‰åä¸¤ä¸ªç«¯ç‚¹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ <code>push_back()</code> / <code>push_front()</code> å®ŒæˆåŠŸèƒ½ï¼›å¦åˆ™ï¼Œå°†æœ€å‰ç«¯ / æœ€åæ®µæ’å…¥ä¸ç¬¬ä¸€ä¸ªå…ƒç´  / æœ€åä¸€ä¸ªå…ƒç´ å€¼ç›¸åŒçš„å…ƒç´ ï¼Œå¹¶é€šè¿‡æ¬è¿å…ƒç´ ä½¿å¾—æ’å…¥ä½ç½®ç•™ç©ºï¼Œæœ€ç»ˆå°†æ–°å€¼æ”¾åˆ°æ’å…¥ä½ç½®ä¸Šã€‚</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">typename</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator</span>
<span class="line"><span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">_M_insert_aux</span><span class="token punctuation">(</span>iterator __pos<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  difference_type __index <span class="token operator">=</span> __pos <span class="token operator">-</span> _M_start<span class="token punctuation">;</span></span>
<span class="line">  value_type __x_copy <span class="token operator">=</span> __x<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">size_type</span><span class="token punctuation">(</span>__index<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">push_front</span><span class="token punctuation">(</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯èƒ½å¯¼è‡´æ‰©å®¹ç¼“å†²åŒº</span></span>
<span class="line">    iterator __front1 <span class="token operator">=</span> _M_start<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">++</span>__front1<span class="token punctuation">;</span></span>
<span class="line">    iterator __front2 <span class="token operator">=</span> __front1<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">++</span>__front2<span class="token punctuation">;</span></span>
<span class="line">    __pos <span class="token operator">=</span> _M_start <span class="token operator">+</span> __index<span class="token punctuation">;</span></span>
<span class="line">    iterator __pos1 <span class="token operator">=</span> __pos<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">++</span>__pos1<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">copy</span><span class="token punctuation">(</span>__front2<span class="token punctuation">,</span> __pos1<span class="token punctuation">,</span> __front1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯èƒ½å¯¼è‡´æ‰©å®¹ç¼“å†²åŒº</span></span>
<span class="line">    iterator __back1 <span class="token operator">=</span> _M_finish<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">--</span>__back1<span class="token punctuation">;</span></span>
<span class="line">    iterator __back2 <span class="token operator">=</span> __back1<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">--</span>__back2<span class="token punctuation">;</span></span>
<span class="line">    __pos <span class="token operator">=</span> _M_start <span class="token operator">+</span> __index<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">copy_backward</span><span class="token punctuation">(</span>__pos<span class="token punctuation">,</span> __back2<span class="token punctuation">,</span> __back1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token operator">*</span>__pos <span class="token operator">=</span> __x_copy<span class="token punctuation">;</span> <span class="token comment">// åœ¨ç©ºä½ä¸Šæ’å…¥å…ƒç´ </span></span>
<span class="line">  <span class="token keyword">return</span> __pos<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šï¼Œ<code>erase()</code> å’Œ <code>insert()</code> èƒ½å¤ŸæˆåŠŸå®ç°çš„å‰æéƒ½æ˜¯ <code>copy()</code> å’Œ <code>copy_backward()</code> çš„æ­£ç¡®æ“ä½œã€‚è€Œè¿™ä¸¤ä¸ªæ“ä½œåº”å½“éƒ½æ˜¯ä½¿ç”¨äº† deque è¿­ä»£å™¨å±è”½äº†åº•å±‚ç»†èŠ‚ï¼Œä»è€Œå®ç°äº†å¯èƒ½çš„è·¨ç¼“å†²åŒºçš„é¡ºåˆ©å¤åˆ¶ã€‚</p>`,72)]))}const r=s(c,[["render",l],["__file","Chapter 4.4 - deque.html.vue"]]),k=JSON.parse('{"path":"/the-annotated-stl-sources-notes/Chapter%204%20-%20%E5%BA%8F%E5%88%97%E5%BC%8F%E5%AE%B9%E5%99%A8/Chapter%204.4%20-%20deque.html","title":"Chapter 4.4 - deque","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"4.4.1 deque æ¦‚è¿°","slug":"_4-4-1-deque-æ¦‚è¿°","link":"#_4-4-1-deque-æ¦‚è¿°","children":[]},{"level":2,"title":"4.4.2 deque çš„ä¸­æ§å™¨","slug":"_4-4-2-deque-çš„ä¸­æ§å™¨","link":"#_4-4-2-deque-çš„ä¸­æ§å™¨","children":[]},{"level":2,"title":"4.4.3 deque çš„è¿­ä»£å™¨","slug":"_4-4-3-deque-çš„è¿­ä»£å™¨","link":"#_4-4-3-deque-çš„è¿­ä»£å™¨","children":[]},{"level":2,"title":"4.4.4 deque çš„æ•°æ®ç»“æ„","slug":"_4-4-4-deque-çš„æ•°æ®ç»“æ„","link":"#_4-4-4-deque-çš„æ•°æ®ç»“æ„","children":[]},{"level":2,"title":"4.4.5 deque çš„æ„é€ ä¸å†…å­˜ç®¡ç†","slug":"_4-4-5-deque-çš„æ„é€ ä¸å†…å­˜ç®¡ç†","link":"#_4-4-5-deque-çš„æ„é€ ä¸å†…å­˜ç®¡ç†","children":[]},{"level":2,"title":"4.4.6 deque çš„å…ƒç´ æ“ä½œ","slug":"_4-4-6-deque-çš„å…ƒç´ æ“ä½œ","link":"#_4-4-6-deque-çš„å…ƒç´ æ“ä½œ","children":[]}],"git":{},"filePathRelative":"the-annotated-stl-sources-notes/Chapter 4 - åºåˆ—å¼å®¹å™¨/Chapter 4.4 - deque.md"}');export{r as comp,k as data};
