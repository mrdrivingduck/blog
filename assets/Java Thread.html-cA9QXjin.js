import{_ as s,c as a,a as e,o as t}from"./app-BeHGwf2X.js";const p={};function l(o,n){return t(),a("div",null,n[0]||(n[0]=[e(`<h1 id="java-thread" tabindex="-1"><a class="header-anchor" href="#java-thread"><span>Java - Thread</span></a></h1><p>Created by : Mr Dk.</p><p>2020 / 10 / 29 17:11</p><p>Nanjing, Jiangsu, China</p><hr><h2 id="java-thread-1" tabindex="-1"><a class="header-anchor" href="#java-thread-1"><span>Java Thread</span></a></h2><p>Java ç¨‹åºå¤©ç”Ÿå°±æ˜¯å¤šçº¿ç¨‹ç¨‹åºï¼Œåœ¨å¯åŠ¨ä¸€ä¸ªæ™®é€šçš„ Java ç¨‹åºæ—¶ï¼Œå°†èµ·ç åŒ…å«ä»¥ä¸‹çº¿ç¨‹ï¼š</p><ol><li>Main çº¿ç¨‹ - ç”¨æˆ·ç¨‹åºå…¥å£</li><li>Reference Handler - æ¸…æ¥šå¼•ç”¨çš„çº¿ç¨‹</li><li>Finalizer - è°ƒç”¨å¯¹è±¡ finalize å‡½æ•°çš„çº¿ç¨‹</li><li>Signal Dispatcher - åˆ†å‘å¤„ç†å‘é€ç»™ JVM è¿›ç¨‹ä¿¡å·çš„çº¿ç¨‹</li></ol><h2 id="thread-priority" tabindex="-1"><a class="header-anchor" href="#thread-priority"><span>Thread Priority</span></a></h2><p>åœ¨ Java çº¿ç¨‹ä¸­ï¼Œé€šè¿‡æ•´å½¢æˆå‘˜å˜é‡ <code>priority</code> æ¥æ§åˆ¶çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œå–å€¼èŒƒå›´ä¸º 1 - 10ã€‚åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™å¯ä»¥ä½¿ç”¨ <code>setPriority(int)</code> å‡½æ•°æ¥ä¿®æ”¹é»˜è®¤çš„ä¼˜å…ˆçº§ <code>5</code>ã€‚åœ¨ä¸åŒ JVM å’Œ OS ä¸Šï¼Œçº¿ç¨‹çš„è§„åˆ’ä¼šå­˜åœ¨å·®å¼‚ï¼Œæœ‰äº› OS ç”šè‡³ä¼šå¿½ç•¥å¯¹çº¿ç¨‹ä¼˜å…ˆçº§çš„è®¾å®š - å› æ­¤çº¿ç¨‹ä¼˜å…ˆçº§ <strong>ä¸èƒ½ä½œä¸ºç¨‹åºæ­£ç¡®æ€§çš„ä¾èµ–</strong>ã€‚</p><h2 id="thread-status" tabindex="-1"><a class="header-anchor" href="#thread-status"><span>Thread Status</span></a></h2><p>Java çº¿ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸä¸­åªå¯èƒ½æœ‰å¦‚ä¸‹å‡ ç§çŠ¶æ€ï¼š</p><ul><li><code>NEW</code> - åˆå§‹çŠ¶æ€ï¼Œåˆšåˆšè¢«åˆ›å»ºï¼Œè¿˜æ²¡æœ‰è°ƒç”¨ <code>start()</code> å‡½æ•°</li><li><code>RUNNABLE</code> - è¿è¡ŒçŠ¶æ€ï¼Œç¬¼ç»Ÿåœ°åŒ…å« OS ä¸­çš„ <strong>å°±ç»ª</strong> å’Œ <strong>è¿è¡Œ</strong> ä¸¤ç§çŠ¶æ€</li><li><code>BLOCKED</code> - é˜»å¡çŠ¶æ€ï¼Œçº¿ç¨‹é˜»å¡äºé”</li><li><code>WAITING</code> - ç­‰å¾…çŠ¶æ€ï¼Œéœ€è¦ç­‰å¾…å…¶å®ƒçº¿ç¨‹åšå‡ºä¸€äº›ç‰¹å®šçš„åŠ¨ä½œ (é€šçŸ¥ / ä¸­æ–­)</li><li><code>TIME_WAITING</code> - è¶…æ—¶ç­‰å¾…ï¼Œåœ¨æŒ‡å®šæ—¶é—´å†…è‡ªè¡Œè¿”å›</li><li><code>TERMINATED</code> - ç»ˆæ­¢çŠ¶æ€ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•</li></ul><p>Daemon çº¿ç¨‹å·¥ä½œåœ¨ç¨‹åºåå°è¿›è¡Œè°ƒåº¦å’Œæ”¯æŒå·¥ä½œï¼Œä½†æ˜¯ JVM é€€å‡ºæ—¶ Daemon çº¿ç¨‹ä¸­çš„ <code>finally</code> å—ä¸ä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥ä¸èƒ½ä¾é  <code>finally()</code> æ¥è¿›è¡Œèµ„æºå…³é—­æˆ–æ¸…ç†ã€‚</p><h2 id="start-stop" tabindex="-1"><a class="header-anchor" href="#start-stop"><span>Start / Stop</span></a></h2><h3 id="build" tabindex="-1"><a class="header-anchor" href="#build"><span>Build</span></a></h3><p>çº¿ç¨‹å¯¹è±¡åœ¨æ„é€ æ—¶éœ€è¦æä¾›å±æ€§ï¼š</p><ul><li>æ‰€å±çº¿ç¨‹ç»„</li><li>çº¿ç¨‹ä¼˜å…ˆçº§</li><li>æ˜¯å¦æ˜¯ daemon çº¿ç¨‹</li><li>...</li></ul><p>ä¸€ä¸ªæ–°æ„é€ çš„çº¿ç¨‹å¯¹è±¡ç”±å…¶ parent çº¿ç¨‹è¿›è¡Œç©ºé—´åˆ†é…ï¼Œå¹¶ç»§æ‰¿äº† parent çº¿ç¨‹çš„å¤§éƒ¨åˆ†ä¿¡æ¯ï¼Œä½†æ˜¯ä¼šè·å¾—ä¸€ä¸ªå”¯ä¸€çš„ ID æ¥æ ‡è¯†è¿™ä¸ªçº¿ç¨‹ã€‚è‡³æ­¤ï¼Œçº¿ç¨‹å¯¹è±¡å°±åœ¨å †ä¸Šåˆå§‹åŒ–å®Œæ¯•ç­‰å¾…è¿è¡Œã€‚</p><h3 id="start" tabindex="-1"><a class="header-anchor" href="#start"><span>Start</span></a></h3><p>çº¿ç¨‹å¯¹è±¡åˆå§‹åŒ–å®Œæ¯•åï¼Œè°ƒç”¨ <code>start()</code> å³å¯å¯åŠ¨çº¿ç¨‹ã€‚å…·ä½“å«ä¹‰æ˜¯ parent çº¿ç¨‹ (å³è°ƒç”¨ <code>start()</code> çš„çº¿ç¨‹) å‘ŠçŸ¥ JVM çš„çº¿ç¨‹è°ƒåº¦å™¨å¯ä»¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</p><h3 id="interrupt" tabindex="-1"><a class="header-anchor" href="#interrupt"><span>Interrupt</span></a></h3><p>ä¸­æ–­å¯ä»¥ç†è§£ä¸ºçº¿ç¨‹çš„ä¸€ä¸ª <strong>æ ‡å¿—ä½</strong> å±æ€§ï¼Œè¡¨ç¤ºçº¿ç¨‹æ˜¯å¦è¢«å…¶å®ƒçº¿ç¨‹ä¸­æ–­è¿‡ã€‚å½“å…¶å®ƒçº¿ç¨‹é€šè¿‡è°ƒç”¨è¯¥çº¿ç¨‹çš„ <code>interrupt()</code> å¯ä»¥å°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ç½®ä¸ºã€‚çº¿ç¨‹å¯ä»¥é€šè¿‡ <code>isInterrupted()</code> å‡½æ•°æ£€æŸ¥è‡ªèº«çš„ä¸­æ–­æ ‡å¿—ä½æ¥å¯¹ä¸­æ–­è¿›è¡Œå“åº”ï¼Œè¿˜å¯ä»¥è°ƒç”¨ <code>Thread.interrupted()</code> å¯¹å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½è¿›è¡Œ <strong>å¤ä½</strong>ã€‚</p><h3 id="suspend-resume-stop" tabindex="-1"><a class="header-anchor" href="#suspend-resume-stop"><span>Suspend / Resume / Stop</span></a></h3><p>è¿™äº›æ˜¯ <strong>è¿‡æ—¶</strong> çš„çº¿ç¨‹ APIï¼š</p><ul><li><code>suspend()</code> - æš‚åœçº¿ç¨‹</li><li><code>resume()</code> - çº¿ç¨‹ç»§ç»­å·¥ä½œ</li><li><code>stop()</code> - åœæ­¢çº¿ç¨‹</li></ul><p>è¿™äº› API è¿‡æœŸçš„åŸå› æœ‰ï¼Œå¯¹äº <code>suspend()</code> æ¥è¯´ï¼Œåœ¨è°ƒç”¨åçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å·²ç»å æœ‰çš„èµ„æºï¼Œè€Œæ˜¯å ç€èµ„æºè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œè¿™æ ·å¾ˆå®¹æ˜“å¼•å‘æ­»é”ï¼›ç±»ä¼¼åœ°ï¼Œ<code>stop()</code> ç»ˆç»“çº¿ç¨‹æ—¶ï¼Œæ²¡æœ‰ç»™äºˆçº¿ç¨‹å®Œæˆèµ„æºé‡Šæ”¾å·¥ä½œçš„æœºä¼šï¼Œä»è€Œæ— æ³•ä¿è¯èµ„æºçš„æ­£å¸¸é‡Šæ”¾ã€‚</p><p>ä¸Šé¢æåˆ°çš„ä¸­æ–­å®é™…ä¸Šæ˜¯ä¸€ç§å®‰å…¨è€Œä¼˜é›…çš„åœæ­¢çº¿ç¨‹çš„æ–¹å¼ - çº¿ç¨‹åªéœ€è¦æ£€æŸ¥è‡ªèº«çš„ä¸­æ–­æ ‡å¿—ä½å°±å¯ä»¥å†³å®šæ˜¯å¦åœæ­¢ã€‚</p><h2 id="inter-thread-communication" tabindex="-1"><a class="header-anchor" href="#inter-thread-communication"><span>Inter-Thread Communication</span></a></h2><h3 id="synchronized" tabindex="-1"><a class="header-anchor" href="#synchronized"><span>Synchronized</span></a></h3><p>å¯¹äº <code>synchronized</code> å‡½æ•°å—æ¥è¯´ï¼ŒJVM ä½¿ç”¨ <code>monitorenter</code> å’Œ <code>monitorexit</code> æŒ‡ä»¤å®ç°åŒæ­¥ï¼›å¯¹äº <code>synchronized</code> å‡½æ•°æ¥è¯´ï¼Œåˆ™æ˜¯ä¾é å‡½æ•°ä¿®é¥°ç¬¦ä¸Šçš„ <code>ACC_SYNCHRONIZED</code> å®ç°ã€‚æœ¬è´¨ä¸Šï¼Œæ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„ monitor è¿›è¡Œæ’ä»–è·å–ã€‚ä»»æ„ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„ monitorã€‚åœ¨è¿›å…¥ <code>synchronized</code> ä¿®é¥°çš„ä»£ç æ—¶ï¼Œçº¿ç¨‹éœ€è¦è·å–åˆ°é”å¯¹è±¡çš„ monitor æ‰èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼Œå…¶å®ƒçº¿ç¨‹å°†ä¼šè¢« <strong>é˜»å¡</strong> åœ¨ä¸´ç•ŒåŒºçš„å…¥å£å¤„ï¼Œè¿›å…¥ <code>BLOCKED</code> çŠ¶æ€ã€‚</p><p>å½“çº¿ç¨‹è¿›å…¥ <code>BLOCKED</code> çŠ¶æ€åï¼Œå°†ä¼šè¿›å…¥åˆ°ç›¸åº”å¯¹è±¡çš„ <strong>åŒæ­¥é˜Ÿåˆ— (Synchronized Queue)</strong> ä¸­ã€‚å½“é”å¯¹è±¡è¢«çº¿ç¨‹é‡Šæ”¾åï¼Œé‡Šæ”¾æ“ä½œå°†ä¼šå”¤é†’é˜»å¡åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œä½¿è¿™äº›çº¿ç¨‹é‡æ–°å°è¯•å¯¹é”å¯¹è±¡çš„ monitor è¿›è¡Œè·å–ã€‚</p><h3 id="wait-notify" tabindex="-1"><a class="header-anchor" href="#wait-notify"><span>Wait / Notify</span></a></h3><p>çº¿ç¨‹ A è°ƒç”¨äº†å¯¹è±¡ O çš„ <code>wait()</code> å‡½æ•°åè¿›å…¥ <code>WAITING</code> çŠ¶æ€ï¼Œçº¿ç¨‹ B è°ƒç”¨å¯¹è±¡ O çš„ <code>notify()</code> / <code>notifyAll()</code> å‡½æ•°åï¼Œçº¿ç¨‹ A å°†ä» <code>wait()</code> å‡½æ•°è¿”å›è¿›è¡Œåç»­å·¥ä½œã€‚ä½¿ç”¨ç»†èŠ‚ï¼š</p><ol><li>ä½¿ç”¨ <code>wait()</code> / <code>notify()</code> / <code>notifyAll()</code> æ—¶ <strong>éœ€è¦å¯¹è°ƒç”¨å¯¹è±¡åŠ é”</strong></li><li>è°ƒç”¨ <code>wait()</code> åï¼Œçº¿ç¨‹çŠ¶æ€ç”± <code>RUNNING</code> å˜ä¸º <code>WAITING</code>ï¼Œ<strong>æ”¾å¼ƒé”</strong> å¹¶è¿›å…¥ <strong>ç­‰å¾…é˜Ÿåˆ— (Wait Queue)</strong></li><li>è°ƒç”¨ <code>notify()</code> / <code>notifyAll()</code> åï¼Œç­‰å¾…çº¿ç¨‹æš‚æ—¶ä¸ä¼šä» <code>wait()</code> è¿”å› (å› ä¸ºé”è¿˜åœ¨è°ƒç”¨ <code>notify()</code> çš„çº¿ç¨‹æ‰‹ä¸Š)</li><li><code>notify()</code> å‡½æ•°å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ç§»å…¥åŒæ­¥é˜Ÿåˆ—ï¼›<code>notifyAll()</code> å‡½æ•°å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å…¨éƒ¨çº¿ç¨‹éƒ½ç§»å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œè¢«ç§»åŠ¨çš„çº¿ç¨‹çŠ¶æ€ç”± <code>WAITING</code> å˜ä¸º <code>BLOCKED</code></li><li>è°ƒç”¨ <code>notify()</code> çš„çº¿ç¨‹é‡Šæ”¾é”åï¼ŒæŸä¸ªä¹‹å‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹é‡æ–°è·å¾—äº†é”ï¼Œæ­¤æ—¶æ‰ä¼šä» <code>wait()</code> è¿”å›å¹¶ç»§ç»­å‘ä¸‹è¿›è¡Œ</li></ol><p>ç­‰å¾…æ–¹çš„ç¼–ç¨‹èŒƒå¼ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è·å–å¯¹è±¡é”</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// æ¡ä»¶ä¸æ»¡è¶³ï¼Œæ¯è½®ç­‰å¾…è¦é‡æ–°æ£€æŸ¥ç­‰å¾…æ¡ä»¶</span></span>
<span class="line">        lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// lock TO DO ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šçŸ¥æ–¹çš„ç¼–ç¨‹èŒƒå¼ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// condition TO DO ...</span></span>
<span class="line">    lock<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pipe" tabindex="-1"><a class="header-anchor" href="#pipe"><span>Pipe</span></a></h3><p>å¦å¤–ï¼Œçº¿ç¨‹é—´è¿˜å¯ä»¥é€šè¿‡ <code>PipedOutputStream</code> / <code>PipedInputStream</code> / <code>PipedReader</code> / <code>PipedWriter</code> æ¥åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„ç®¡é“è¿›è¡Œé€šä¿¡ã€‚è¿™ç±»æµéƒ½éœ€è¦è°ƒç”¨ <code>connect()</code> å‡½æ•°å°†è¾“å…¥æµå’Œè¾“å‡ºæµç»‘å®šï¼Œå¦åˆ™å°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><h3 id="thread-join" tabindex="-1"><a class="header-anchor" href="#thread-join"><span>Thread.join()</span></a></h3><p>å¦‚æœçº¿ç¨‹ A ä¸­æ‰§è¡Œäº† <code>thread.join()</code>ï¼Œä»£è¡¨çº¿ç¨‹ A å°†ç­‰å¾… <code>thread</code> çº¿ç¨‹ç»ˆæ­¢åï¼Œæ‰ä¼šä»è¿™ä¸ªå‡½æ•°è¿”å›ï¼›å¦å¤–ï¼Œè¿™ä¸ªå‡½æ•°è¿˜æœ‰è¶…æ—¶ç‰ˆæœ¬ã€‚é€šè¿‡çº¿ç¨‹ A è°ƒç”¨çš„ <code>thread.join()</code> çš„æºä»£ç æ¥çœ‹çœ‹çº¿ç¨‹ A æ˜¯å¦‚ä½•ç­‰å¾…çš„ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line">  * Waits at most <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">millis</span></span><span class="token punctuation">}</span> milliseconds for this thread to</span>
<span class="line">  * die. A timeout of <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token number">0</span></span></span><span class="token punctuation">}</span> means to wait forever.</span>
<span class="line">  *</span>
<span class="line">  * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span> This implementation uses a loop of <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">this</span><span class="token punctuation">.</span>wait</span></span><span class="token punctuation">}</span> calls</span>
<span class="line">  * conditioned on <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">this</span><span class="token punctuation">.</span>isAlive</span></span><span class="token punctuation">}</span>. As a thread terminates the</span>
<span class="line">  * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">this</span><span class="token punctuation">.</span>notifyAll</span></span><span class="token punctuation">}</span> method is invoked. It is recommended that</span>
<span class="line">  * applications not use <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">wait</span></span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">notify</span></span><span class="token punctuation">}</span>, or</span>
<span class="line">  * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">notifyAll</span></span><span class="token punctuation">}</span> on <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Thread</span></span></span><span class="token punctuation">}</span> instances.</span>
<span class="line">  *</span>
<span class="line">  * <span class="token keyword">@param</span>  <span class="token parameter">millis</span></span>
<span class="line">  *         the time to wait in milliseconds</span>
<span class="line">  *</span>
<span class="line">  * <span class="token keyword">@throws</span>  <span class="token reference"><span class="token class-name">IllegalArgumentException</span></span></span>
<span class="line">  *          if the value of <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">millis</span></span><span class="token punctuation">}</span> is negative</span>
<span class="line">  *</span>
<span class="line">  * <span class="token keyword">@throws</span>  <span class="token reference"><span class="token class-name">InterruptedException</span></span></span>
<span class="line">  *          if any thread has interrupted the current thread. The</span>
<span class="line">  *          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span>interrupted status<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> of the current thread is</span>
<span class="line">  *          cleared when this exception is thrown.</span>
<span class="line">  */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;timeout value is negative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">long</span> delay <span class="token operator">=</span> millis <span class="token operator">-</span> now<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token function">wait</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> base<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºéå®šæ—¶ç‰ˆæœ¬æ¥è¯´ï¼Œ<code>millis</code> å‚æ•°ä¼šä¼ å…¥ <code>0L</code>ï¼Œé‚£ä¹ˆå‡½æ•°å®é™…æœ‰æ•ˆçš„é€»è¾‘åªæœ‰ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯ä¸æ–­åˆ¤æ–­ <code>thread</code> çº¿ç¨‹æ˜¯å¦è¿˜å­˜æ´»ï¼Œå¦‚æœè¿˜å­˜æ´»ï¼Œå°±ç»§ç»­ç­‰å¾…ã€‚å½“ <code>thread</code> çº¿ç¨‹è‡ªèº«ç»ˆæ­¢æ—¶ï¼Œå°†ä¼šè°ƒç”¨è‡ªèº«çš„ <code>notifyAll()</code> å‡½æ•°ï¼Œä»è€Œé€šçŸ¥æ‰€æœ‰ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢çš„çº¿ç¨‹ (åŒ…æ‹¬çº¿ç¨‹ A)ã€‚</p><h3 id="threadlocal" tabindex="-1"><a class="header-anchor" href="#threadlocal"><span>ThreadLocal</span></a></h3><blockquote><p>ä¸‹æ¬¡å•ç‹¬ç ”ç©¶ ğŸ‘¶</p></blockquote><h2 id="timeout-waiting" tabindex="-1"><a class="header-anchor" href="#timeout-waiting"><span>Timeout Waiting</span></a></h2><p>å¦‚ä½•åœ¨ wait / notify ç¼–ç¨‹èŒƒå¼ä¸­åŠ å…¥è¶…æ—¶ç­‰å¾…çš„åŠŸèƒ½ï¼Ÿå®šä¹‰å˜é‡ï¼š</p><ul><li>å‰©ä½™ç­‰å¾…æ—¶é—´ <code>remaining = T</code> (åˆå§‹åŒ–)</li><li>è¶…æ—¶æ—¶é—´ <code>future = now + T</code></li></ul><p>é‚£ä¹ˆåªéœ€è¦å¯¹ç­‰å¾… <code>remaining</code> çš„æ—¶é—´å³å¯ã€‚å¦‚æœä¸­é€”çº¿ç¨‹è¢«å”¤é†’ï¼Œé‚£ä¹ˆéœ€è¦é‡æ–°è®¡ç®—ä¸€ä¸‹å‰©ä½™ç­‰å¾…æ—¶é—´ï¼š</p><ul><li>å¦‚æœå‰©ä½™ç­‰å¾…æ—¶é—´è¿˜æœ‰ï¼Œé‚£ä¹ˆç»§ç»­ wait</li><li>å¦‚æœå‰©ä½™ç­‰å¾…æ—¶é—´å·²è¿‡ï¼Œé‚£ä¹ˆé€€å‡º</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">long</span> mills<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// éšå¼å¯¹å½“å‰å¯¹è±¡åŠ é”</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">long</span> future <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> mills<span class="token punctuation">;</span> <span class="token comment">// è¶…æ—¶æ—¶é—´</span></span>
<span class="line">    <span class="token keyword">long</span> remaining <span class="token operator">=</span> mills<span class="token punctuation">;</span> <span class="token comment">// å‰©ä½™æ—¶é—´</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ç»“æœè¿˜æœªæ»¡è¶³ï¼Œä¸”è¿˜æœ‰å‰©ä½™æ—¶é—´</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> remaining <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">wait</span><span class="token punctuation">(</span>remaining<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…</span></span>
<span class="line">        remaining <span class="token operator">=</span> future <span class="token operator">-</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¢«å”¤é†’åé‡æ–°è®¡ç®—å‰©ä½™æ—¶é—´</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ç»“æœå·²æ»¡è¶³ OR å‰©ä½™æ—¶é—´å·²ç»è€—å°½</span></span>
<span class="line">    <span class="token comment">// è¿”å›ç»“æœ</span></span>
<span class="line">    <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>`,56)]))}const c=s(p,[["render",l],["__file","Java Thread.html.vue"]]),d=JSON.parse('{"path":"/notes/Java/Java%20Thread.html","title":"Java - Thread","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Java Thread","slug":"java-thread-1","link":"#java-thread-1","children":[]},{"level":2,"title":"Thread Priority","slug":"thread-priority","link":"#thread-priority","children":[]},{"level":2,"title":"Thread Status","slug":"thread-status","link":"#thread-status","children":[]},{"level":2,"title":"Start / Stop","slug":"start-stop","link":"#start-stop","children":[{"level":3,"title":"Build","slug":"build","link":"#build","children":[]},{"level":3,"title":"Start","slug":"start","link":"#start","children":[]},{"level":3,"title":"Interrupt","slug":"interrupt","link":"#interrupt","children":[]},{"level":3,"title":"Suspend / Resume / Stop","slug":"suspend-resume-stop","link":"#suspend-resume-stop","children":[]}]},{"level":2,"title":"Inter-Thread Communication","slug":"inter-thread-communication","link":"#inter-thread-communication","children":[{"level":3,"title":"Synchronized","slug":"synchronized","link":"#synchronized","children":[]},{"level":3,"title":"Wait / Notify","slug":"wait-notify","link":"#wait-notify","children":[]},{"level":3,"title":"Pipe","slug":"pipe","link":"#pipe","children":[]},{"level":3,"title":"Thread.join()","slug":"thread-join","link":"#thread-join","children":[]},{"level":3,"title":"ThreadLocal","slug":"threadlocal","link":"#threadlocal","children":[]}]},{"level":2,"title":"Timeout Waiting","slug":"timeout-waiting","link":"#timeout-waiting","children":[]}],"git":{},"filePathRelative":"notes/Java/Java Thread.md"}');export{c as comp,d as data};
