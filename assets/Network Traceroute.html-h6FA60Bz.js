import{_ as t,c as o,a,o as r}from"./app-BeHGwf2X.js";const n="/blog/assets/traceroute-windows-YNUrm0w1.png",l="/blog/assets/traceroute-icmp-tj7682Zi.png",c="/blog/assets/traceroute-udp-CqrxvQoY.png",i={};function d(s,e){return r(),o("div",null,e[0]||(e[0]=[a('<h1 id="network-traceroute" tabindex="-1"><a class="header-anchor" href="#network-traceroute"><span>Network - Traceroute</span></a></h1><p>Created by : Mr Dk.</p><p>2018 / 12 / 26 11:24</p><p>Nanjing, Jiangsu, China</p><hr><h2 id="about" tabindex="-1"><a class="header-anchor" href="#about"><span>About</span></a></h2><p><em>Traceroute</em> 是用来检测从 <strong>发出数据包的主机</strong> 到 <strong>目标主机</strong> 之间所经过的网关数量的工具。在 <em>Windows</em> 下叫做 <em>tracert</em>，可以定位从发送主机到目标主机之间的所有路由器。主要原理：操纵数据包中的 <code>TTL</code> 字段进行步步试探。</p><p><img src="'+n+'" alt="traceroute-windows"></p><p><em>Windows</em> 下的 <em>tracert</em>：</p><ul><li>当前主机 IP 地址为 <code>[153.3.101.244]</code>，尝试对 <em>Baidu</em> 进行 traceroute</li><li>默认参数最大 TTL 为 30</li><li>默认参数对每个 TTL 发出 3 个探测包</li></ul><h2 id="ttl" tabindex="-1"><a class="header-anchor" href="#ttl"><span>TTL</span></a></h2><p><em>TTL (Time-To-Live)</em> 是 IP 数据包中的一个字段，指定了数据包最多能经过几次路由器：</p><ul><li>IP 数据包每经过一次路由器，<code>TTL</code> 的值就会被减掉 <code>1</code></li><li><code>TTL</code> 被减至 <code>0</code> 时，该数据包将被路由器丢弃，不再继续转发，同时路由器向源地址发送一个超时报文</li></ul><h2 id="theory" tabindex="-1"><a class="header-anchor" href="#theory"><span>Theory</span></a></h2><p><em>Traceroute</em> 的原理是，向目的地址发送 <code>TTL</code> 从 <code>1</code> 开始逐渐增大的数据包：</p><ul><li><code>TTL == 1</code> 时，第一跳路由器将会返回超时报文</li><li><code>TTL == 2</code> 时，第二跳路由器将会返回超时报文</li><li>......</li><li>直到 <code>TTL</code> 的值能够到达目的地址，目的地址返回一个确认信号（可能是不同形式的）</li><li>或者到达最大 <code>TTL</code> 限制，也没有到达目的地址</li></ul><h2 id="implementation-based-on-icmp" tabindex="-1"><a class="header-anchor" href="#implementation-based-on-icmp"><span>Implementation Based on ICMP</span></a></h2><p>发送 ICMP echo request，实际上就是 <em>ping</em> 命令。如果 TTL 超时，将会返回 <code>ICMP-TTL-Exceeded</code> 报文；如果到达目的地址，将会返回 <code>ICMP echo reply</code> 报文，暗示 traceroute 结束。</p><p><img src="'+l+'" alt="traceroute-icmp"></p><p>可能出现的问题：</p><ul><li>有些服务器或防火墙会因为安全原因不回复 <code>ICMP echo reply</code></li><li>有些路由器会 <strong>安静</strong> 地丢掉 TTL 减小到 0 的数据包，即不返回 TTL 超时报文</li></ul><h2 id="implementation-based-on-udp" tabindex="-1"><a class="header-anchor" href="#implementation-based-on-udp"><span>Implementation Based on UDP</span></a></h2><p>发送 UDP 数据包，使用一个大于 <code>30000</code> 的端口号。如果 TTL 超时，将返回 <code>ICMP-TTL-Exceeded</code>；如果到达目的地址，由于服务器通常不会使用大于 <code>30000</code> 的端口号，将返回 <code>ICMP-port-unreachable</code>，暗示 traceroute 结束。</p><p><img src="'+c+'" alt="traceroute-udp"></p><p>可能出现的问题：</p><ul><li>UDP 由于经常被用来做网络攻击 (无需连接，没有状态约束)，因此 ISP 出于安全考虑会采用端口白名单，只有在白名单端口中的数据包才能通过</li><li>服务器可能出于安全原因不提供 UDP 服务</li><li>可能被防火墙过滤</li></ul><h2 id="references" tabindex="-1"><a class="header-anchor" href="#references"><span>References</span></a></h2><p>图片来自 <a href="https://www.jianshu.com/p/75a5822d0eec" target="_blank" rel="noopener noreferrer">简书</a>。</p><hr>',29)]))}const m=t(i,[["render",d],["__file","Network Traceroute.html.vue"]]),h=JSON.parse('{"path":"/notes/Network/Network%20Traceroute.html","title":"Network - Traceroute","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"About","slug":"about","link":"#about","children":[]},{"level":2,"title":"TTL","slug":"ttl","link":"#ttl","children":[]},{"level":2,"title":"Theory","slug":"theory","link":"#theory","children":[]},{"level":2,"title":"Implementation Based on ICMP","slug":"implementation-based-on-icmp","link":"#implementation-based-on-icmp","children":[]},{"level":2,"title":"Implementation Based on UDP","slug":"implementation-based-on-udp","link":"#implementation-based-on-udp","children":[]},{"level":2,"title":"References","slug":"references","link":"#references","children":[]}],"git":{},"filePathRelative":"notes/Network/Network Traceroute.md"}');export{m as comp,h as data};
