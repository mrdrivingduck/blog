import{_ as n,c as s,a,o as l}from"./app-BeHGwf2X.js";const r="/blog/assets/wsl-centos-zip-YoUAS2t9.png",i={};function t(d,e){return l(),s("div",null,e[0]||(e[0]=[a('<h1 id="wsl-centos-8" tabindex="-1"><a class="header-anchor" href="#wsl-centos-8"><span>WSL: CentOS 8</span></a></h1><p>Created by : Mr Dk.</p><p>2021 / 09 / 09 10:46</p><p>Ningbo, Zhejiang, China</p><hr><h2 id="background" tabindex="-1"><a class="header-anchor" href="#background"><span>Background</span></a></h2><p>最近两天参加 <em>PolarDB</em> <a href="https://github.com/Apsara/PolarDB-for-PostgreSQL" target="_blank" rel="noopener noreferrer">开源</a> 相关的开发，需要配置一个 CentOS 的环境 (果然，离开公司就没有 <em>Alibaba Linux</em> 可以用了)。手边只有一台 Surface 的我当然还是选择 WSL2 啦~</p><p>发现 CentOS 系列在 <em>Microsoft Store</em> 中并没有可以下载的 distribution。经过了解，网上说需要付费 (我咋连付费的都没发现)，要么就用开源版本手动安装。所以记录一次手动安装的过程。</p><h2 id="download-and-install" tabindex="-1"><a class="header-anchor" href="#download-and-install"><span>Download and Install</span></a></h2><p>首先可以在 GitHub 上 <a href="https://github.com/mishamosher/CentOS-WSL" target="_blank" rel="noopener noreferrer">CentOS-WSL</a> 项目的 <a href="https://github.com/mishamosher/CentOS-WSL/releases" target="_blank" rel="noopener noreferrer">release</a> 中下载压缩包并解压。</p><p><img src="'+r+`" alt="wsl-centos-zip"></p><p>双击 <code>CentOS8.exe</code> 即可开始安装并注册到 WSL 中。安装完毕后，再次双击 <code>CentOS8.exe</code>，就能以 root 用户登录进入系统。</p><h2 id="uninstall" tabindex="-1"><a class="header-anchor" href="#uninstall"><span>Uninstall</span></a></h2><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell" data-title="powershell"><pre><code><span class="line"><span class="token punctuation">.</span>\\CentOS8<span class="token punctuation">.</span>exe clean</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="add-new-user" tabindex="-1"><a class="header-anchor" href="#add-new-user"><span>Add New User</span></a></h2><p>一直用 root 用户进行操作终究是不太好。最好是能够创建一个可登录的个人用户，偶尔 <code>sudo</code> 才对。创建新用户并设置密码：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">useradd</span> mrdrivingduck</span>
<span class="line"><span class="token function">passwd</span> mrdrivingduck</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>后续发现新用户执行 <code>sudo</code> 命令时会有报错：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">mrdrivingduck not in the sudoers file. This incident will be reported.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>因此，还需要把新创建的用户加入到 <code>/etc/sudoers</code> 文件中。这个文件是只读的，所以暂时将这个文件的权限设置为可写，写完以后再重置回去：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> u+w /etc/sudoers</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> u-w /etc/sudoers</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述两条命令的中间，<code>/etc/sudoers</code> 是可以被编辑的。在最后加上下面的任意一行：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">mrdrivingduck ALL=(ALL) ALL</span>
<span class="line">%mrdrivingduck ALL=(ALL) ALL</span>
<span class="line">mrdrivingduck ALL=(ALL) NOPASSWD: ALL</span>
<span class="line">%mrdrivingduck ALL=(ALL) NOPASSWD: ALL</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>mrdrivingduck</code> 和 <code>%mrdrivingduck</code> 的区别是，是用户还是用户组；<code>NOPASSWD</code> 的含义为，执行 sudo 命令时是否需要输入密码。</p><p>接下来，可以把 CentOS 的默认登录用户直接设置为新用户：</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell" data-title="powershell"><pre><code><span class="line"><span class="token punctuation">.</span>\\CentOS8<span class="token punctuation">.</span>exe config <span class="token operator">--</span>default-user mrdrivingduck</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>通过 WSL 命令也可以看到，目前两个 distribution 都启动了：</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell" data-title="powershell"><pre><code><span class="line"><span class="token function">PS</span> C:\\Users\\mrdrivingduck&gt; wsl <span class="token operator">-</span>l <span class="token operator">-</span>v</span>
<span class="line">  NAME            STATE           VERSION</span>
<span class="line"><span class="token operator">*</span> Ubuntu-20<span class="token punctuation">.</span>04    Running         2</span>
<span class="line">  CentOS8         Running         2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="migration" tabindex="-1"><a class="header-anchor" href="#migration"><span>Migration</span></a></h2><p>很尴尬的一件事，刚才的 CentOS8 的文件夹解压在桌面了。想把它挪到 C 盘的某个位置去。所以先让 WSL 停止：</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell" data-title="powershell"><pre><code><span class="line">wsl <span class="token operator">--</span>shutdown CentOS8</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>接下来，直接移动文件肯定是不对的。因为 WSL 并不知道虚拟机的新位置。根据 stackoverflow 上的一个回答，发现 GitHub 上有一个非官方的迁移工具 <a href="https://github.com/DDoSolitary/LxRunOffline" target="_blank" rel="noopener noreferrer">LxRunOffline</a>。使用 Windows 下的软件包管理工具 <a href="https://chocolatey.org/" target="_blank" rel="noopener noreferrer">Chocolatey</a> 安装后，直接使用以下命令就可以无缝完成迁移，体验非常不错：</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell" data-title="powershell"><pre><code><span class="line">lxrunoffline <span class="token function">move</span> <span class="token operator">-</span>n CentOS8 <span class="token operator">-</span>d &lt;dest_folder&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>其中 <code>CentOS8</code> 可以替换为任意 distribution 的名称。</p><hr><h2 id="references" tabindex="-1"><a class="header-anchor" href="#references"><span>References</span></a></h2><p><a href="https://zhuanlan.zhihu.com/p/272735470" target="_blank" rel="noopener noreferrer">ZhiHu - 在 Windows 10 上使用 WSL 安装 CentOS</a></p><p><a href="https://blog.csdn.net/sinat_36118270/article/details/62899093" target="_blank" rel="noopener noreferrer">CSDN - 解决 Linux 下 sudo 更改文件权限报错</a></p><p><a href="https://stackoverflow.com/questions/64185560/where-are-the-files-inside-wsl2-physically-stored" target="_blank" rel="noopener noreferrer">stackoverflow - Where are the files inside wsl2 physically stored?</a></p><p><a href="https://www.cnblogs.com/microestc/articles/13042072.html" target="_blank" rel="noopener noreferrer">博客园 - WSL2 Linux 设置默认用户</a></p>`,40)]))}const p=n(i,[["render",t],["__file","WSL CentOS8.html.vue"]]),c=JSON.parse('{"path":"/notes/Operating%20System/WSL%20CentOS8.html","title":"WSL: CentOS 8","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Background","slug":"background","link":"#background","children":[]},{"level":2,"title":"Download and Install","slug":"download-and-install","link":"#download-and-install","children":[]},{"level":2,"title":"Uninstall","slug":"uninstall","link":"#uninstall","children":[]},{"level":2,"title":"Add New User","slug":"add-new-user","link":"#add-new-user","children":[]},{"level":2,"title":"Migration","slug":"migration","link":"#migration","children":[]},{"level":2,"title":"References","slug":"references","link":"#references","children":[]}],"git":{},"filePathRelative":"notes/Operating System/WSL CentOS8.md"}');export{p as comp,c as data};
